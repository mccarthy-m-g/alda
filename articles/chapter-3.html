<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="alda">
<title>Chapter 3: Introducing the multilevel model for change • alda</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 3: Introducing the multilevel model for change">
<meta property="og:description" content="alda">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">alda</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tips-amp-tricks">Tips &amp; Tricks</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tips-amp-tricks">
    <a class="dropdown-item" href="../articles/longitudinal-data-organization.html">Longitudinal data organization</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-textbook-examples">Textbook examples</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-textbook-examples">
    <h6 class="dropdown-header" data-toc-skip>Longitudinal mixed effects modelling</h6>
    <a class="dropdown-item" href="../articles/chapter-2.html">Chapter 2</a>
    <a class="dropdown-item" href="../articles/chapter-3.html">Chapter 3</a>
    <a class="dropdown-item" href="../articles/chapter-4.html">Chapter 4</a>
    <a class="dropdown-item" href="../articles/chapter-5.html">Chapter 5</a>
    <a class="dropdown-item" href="../articles/chapter-6.html">Chapter 6</a>
    <a class="dropdown-item" href="../articles/chapter-7.html">Chapter 7</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Longitudinal structural equation modelling</h6>
    <a class="dropdown-item" href="../articles/chapter-8.html">Chapter 8</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Survival analysis</h6>
    <a class="dropdown-item" href="../articles/chapter-9.html">Chapter 9</a>
    <a class="dropdown-item" href="../articles/chapter-10.html">Chapter 10</a>
    <a class="dropdown-item" href="../articles/chapter-11.html">Chapter 11</a>
    <a class="dropdown-item" href="../articles/chapter-12.html">Chapter 12</a>
    <a class="dropdown-item" href="../articles/chapter-13.html">Chapter 13</a>
    <a class="dropdown-item" href="../articles/chapter-14.html">Chapter 14</a>
    <a class="dropdown-item" href="../articles/chapter-15.html">Chapter 15</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mccarthy-m-g/alda/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Chapter 3: Introducing the multilevel model for change</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mccarthy-m-g/alda/blob/HEAD/vignettes/articles/chapter-3.Rmd" class="external-link"><code>vignettes/articles/chapter-3.Rmd</code></a></small>
      <div class="d-none name"><code>chapter-3.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mccarthy-m-g.github.io/alda/">alda</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbolker/broom.mixed" class="external-link">broom.mixed</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="what-is-the-purpose-of-the-multilevel-model-for-change">3.1 What Is the Purpose of the Multilevel Model for Change?<a class="anchor" aria-label="anchor" href="#what-is-the-purpose-of-the-multilevel-model-for-change"></a>
</h2>
<p>In Chapter 3 Singer and Willet (2003) develop and explain the
<strong>multilevel model for change</strong> using a subset of data from
Burchinal, Campbell, Bryant, Wasik, and Ramey (1997), who measured the
effect of early educational intervention on cognitive performance in a
sample of African-American children at ages 12, 18, and 24 months (i.e.,
1.0, 1.5, and 2.0 years).</p>
<p>For this example we use the <code>early_intervention</code> data set,
a person-period data frame with 309 rows and 4 columns:</p>
<ul>
<li>
<code>id</code>: Child ID.</li>
<li>
<code>age</code>: Age in years at time of measurement.</li>
<li>
<code>treatment</code>: Treatment condition (control = 0,
intervention = 1).</li>
<li>
<code>cognitive_score</code>: Cognitive performance score on one of
two standardized intelligence tests: the Bayley Scales of Infant
Development (Bayley, 1969) at 12 and 18 months, and the the Stanford
Binet (Terman &amp; Merrill, 1972) at 24 months.</li>
</ul>
<p>Note that for reasons of participant privacy the
<code>early_intervention</code> data set uses <em>simulated</em> data
rather than the real data used by Singer and Willet (2003), so the
examples presented in this article will have similar but not identical
results to those presented in the text.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Table 3.1, page 48:</span></span>
<span><span class="va">early_intervention</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 309 × 4</span></span></span>
<span><span class="co">#&gt;    id      age treatment cognitive_score</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1       1           1           106. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1       1.5         1            91.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1       2           1            74.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2       1           1           112. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2       1.5         1           114. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2       2           1           119. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 3       1           0            90.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 3       1.5         0            94.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 3       2           0            80.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 4       1           1           103. </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 299 more rows</span></span></span></code></pre></div>
<p>To motivate the need for the multilevel model for change, we begin
with some basic exploration and description of the
<code>early_intervention</code> data.</p>
<p>Starting with the <code>age</code> variable, we can see that each
child’s cognitive performance was measured on the same three occasions
at ages 1.0, 1.5, and 2.0 years, and thus the
<code>early_intervention</code> data uses a <strong>time-structured
design</strong>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">measurement_occasions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">early_intervention</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></span>
<span><span class="va">measurement_occasions</span></span>
<span><span class="co">#&gt; [1] 1.0 1.5 2.0</span></span>
<span></span>
<span><span class="va">early_intervention</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>all_occasions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">measurement_occasions</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">all_occasions</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Next we’ll look at the time-invariant <code>treatment</code>
variable. Because we’re summarizing a time-invariant predictor, we’ll
transform the data to person-level format with the
<code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider()</a></code> function from the <strong>tidyr</strong>
package before summarizing.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">early_intervention_pl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>  <span class="va">early_intervention</span>,</span>
<span>  names_from <span class="op">=</span> <span class="va">age</span>,</span>
<span>  names_prefix <span class="op">=</span> <span class="st">"age_"</span>,</span>
<span>  values_from <span class="op">=</span> <span class="va">cognitive_score</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">early_intervention_pl</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 103 × 5</span></span></span>
<span><span class="co">#&gt;    id    treatment age_1 age_1.5 age_2</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1             1 106.     91.7  74.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2             1 112.    114.  119. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 3             0  90.4    94.7  80.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 4             1 103.    101.   93.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 5             1 103.     75.0  71.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 6             0 106.     96.8  93.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 7             1 136.    117.  119. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 8             0  79.8    69.3  67.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 9             1 113.    105.  108. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 10            1  88.2    87.5  85.3</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 93 more rows</span></span></span></code></pre></div>
<p>A total of 58 children (56.3%) were assigned to participate in the
early educational intervention, with the remaining 45 children (43.7%)
participating in the control group.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">early_intervention_pl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>proportion <span class="op">=</span> <span class="va">count</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 3</span></span></span>
<span><span class="co">#&gt;   treatment count proportion</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         0    45      0.437</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>         1    58      0.563</span></span></code></pre></div>
<p>As Singer and Willet (2003) discuss, the kind of statistical model
needed to represent change processes in longitudinal data like this must
include components at two levels:</p>
<ol style="list-style-type: decimal">
<li>A <strong>level-1 submodel</strong> that describes how individuals
change over time, which can address questions about
<strong>within-person</strong> change.</li>
<li>A <strong>level-2 submodel</strong> that describes how these changes
vary across individuals, which can address questions about
<strong>between-person</strong> differences in change.</li>
</ol>
<p>Together, these two components form a <strong>multilevel
model</strong> (also known as a <strong>linear mixed-effects
model</strong> or <strong>mixed model</strong>) for change.</p>
</div>
<div class="section level2">
<h2 id="the-level-1-submodel-for-individual-change">3.2 The Level-1 Submodel for Individual Change<a class="anchor" aria-label="anchor" href="#the-level-1-submodel-for-individual-change"></a>
</h2>
<p>In Section 3.2 Singer and Willet (2003) introduce the level-1
component of the multilevel model for change: The <strong>submodel for
individual change</strong>—also known as the <strong>individual growth
model</strong>—which represents the individual change in the outcome
variable that we expect will occur during each time period under
study.</p>
<p>Because the individual growth model specifies a common functional
form for the individual trajectories, Singer and Willet (2003) suggest
preceding level-1 submodel specification with visual inspection of
empirical growth plots in order to select the most <em>parsimonious</em>
functional form that the observed data could reasonably have come
from.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">567</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Figure 3.1, page 50:</span></span>
<span><span class="va">early_intervention</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cognitive_score</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">150</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">4</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span></span></code></pre></div>
<p><img src="chapter-3_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Singer and Willet (2003) identify several questions that are helpful
to answer when examining empirical growth plots to aid model
specification:</p>
<ul>
<li>What type of population individual growth model could have generated
the observed data?</li>
<li>Should the population individual growth model be linear or
curvilinear with time? Smooth or jagged? Continuous or disjoint?</li>
<li>Are any nonlinearities in the observed data consistent across
individuals? Might they be due to measurement error or random
error?</li>
<li>How many measurement occasions are there? Few or many?</li>
</ul>
<p>Because the <code>early_intervention</code> data only has three
measurement occasions for each individual, and any nonlinearities in the
observed data are most likely due to measurement error or random error,
Singer and Willet (2003) specify a simple linear model for the level-1
submodel:</p>
<p><span class="math display">\[
\text{cognitive_score}_{ij} = \pi_{0i} + \pi_{1i} (\text{age}_{ij} - 1)
+ \epsilon_{ij},
\]</span></p>
<p>which asserts that <span class="math inline">\(\text{cognitive_score}_{ij}\)</span>—the true
value of <code>cognitive_score</code> for the <span class="math inline">\(i\)</span>th child at the <span class="math inline">\(j\)</span>th time—is a linear function of their
age on that measurement occasion, <span class="math inline">\(\text{age}_{ij}\)</span>, and that any deviations
from linearity in the observed data over time are a result of random
error, <span class="math inline">\(\epsilon_{ij}\)</span>.</p>
<p>Here <span class="math inline">\(\text{age}\)</span> has been
<strong>centred</strong> to <span class="math inline">\((\text{age} -
1)\)</span> so that the model intercept, <span class="math inline">\(\pi_{0i}\)</span>, represents the <span class="math inline">\(i\)</span>th child’s true <strong>initial
status</strong>—that is, their true <span class="math inline">\(\text{cognitive_score}\)</span> value at age 1.
This is preferable to using <span class="math inline">\(\text{age}\)</span> with no centring, as the
intercept in such a model would instead represent the <span class="math inline">\(i\)</span>th child’s true value of
<code>cognitive_score</code> at age 0, meaning: (1) the uncentred <span class="math inline">\(\text{age}\)</span> model must predict beyond the
temporal limits of the <code>early_intervention</code> data; and (2)
assume the individual trajectories extend back in time to birth linearly
with age.</p>
<p>Finally, the model slope, <span class="math inline">\(\pi_{1i}\)</span>, represents the true
<strong>rate of change</strong> in the <span class="math inline">\(i\)</span>th child’s true <span class="math inline">\(\text{cognitive_score}\)</span> over time—in this
case, their true <em>annual</em> rate of change.</p>
<div class="section level3">
<h3 id="relating-the-level-1-submodel-to-the-exploratory-methods-of-chapter-2">Relating the Level-1 Submodel to the Exploratory Methods of Chapter
2<a class="anchor" aria-label="anchor" href="#relating-the-level-1-submodel-to-the-exploratory-methods-of-chapter-2"></a>
</h3>
<p>Before fitting this model, we find it helpful to introduce Gelman and
Hill’s (2006) concepts of complete pooling, no pooling, and partial
pooling in relation to the exploratory linear models we fit in Chapter 2
to summarize both average and individual patterns of change over
time.</p>
<p>In a <strong>complete pooling</strong> model, group indicators for
individuals are not included in the model, and a single average
trajectory using the information from all individuals is fitted. By
definition, a complete pooling model ignores variation between
individuals, making it unsuitable for analyzing individual change over
time. This corresponds to the average trajectory in the group trajectory
plot from Section 2.3.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">early_intervention_fit_cp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span></span>
<span>  <span class="va">cognitive_score</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">early_intervention</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In a <strong>no pooling</strong> model, separate within-person models
are fit to each person’s data, resulting in an individual trajectory for
each individual. However, because each individual’s fitted trajectory
ignores information from all other individuals, the no pooling models
tend to <em>overfit</em> the data within each individual—potentially
overstating the variation between individuals, and making
interindividual differences in initial status and rate of change look
more different than they actually are. This corresponds to the
individual trajectories in the group trajectory plot from Section
2.3.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">early_intervention_fit_np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmList.html" class="external-link">lmList</a></span><span class="op">(</span></span>
<span>  <span class="va">cognitive_score</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|</span> <span class="va">id</span>,</span>
<span>  pool <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  data <span class="op">=</span> <span class="va">early_intervention</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <strong>partial pooling</strong> model represents a compromise
between the two extremes of complete pooling and partial pooling,
wherein we fit a single model—here the individual growth model—that
takes into account information from each individual, on one hand, and
the average of all the individuals, on the other, to determine each
individual’s fitted trajectory. By doing this, the partial pooling
approach <em>regularizes</em> each individual’s fitted
trajectory—pulling more extreme initial statuses and rates of change
towards the overall average.</p>
<p>We can fit the level-1 submodel for individual change using the
<code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer()</a></code> function from the <strong>lme4</strong> package. The
model formula for the <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer()</a></code> function takes the form
<code>response ~ fixed_effects + random_effects</code>. Here each random
effects term takes the form <code>(varying_effects | group)</code>, with
the left side of the vertical bar defining the variable(s) that are
allowed to vary across groups, and the right side their grouping
variable. Note that, in order to match the maximum likelihood method
used by Singer and Willett (2003) in this chapter, we also set the
<code>REML</code> argument to <code>FALSE</code> so the model is fit
using <em>full</em> maximum likelihood (FML) estimation rather than
<em>restricted</em> maximum likelihood (REML).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">early_intervention_fit_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span></span>
<span>  <span class="va">cognitive_score</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">early_intervention</span>,</span>
<span>  REML <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">early_intervention_fit_1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linear mixed model fit by maximum likelihood  ['lmerMod']</span></span>
<span><span class="co">#&gt; Formula: cognitive_score ~ I(age - 1) + (1 + I(age - 1) | id)</span></span>
<span><span class="co">#&gt;    Data: early_intervention</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span></span>
<span><span class="co">#&gt;   2412.7   2435.1  -1200.4   2400.7      303 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Scaled residuals: </span></span>
<span><span class="co">#&gt;      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">#&gt; -2.08234 -0.50220  0.04103  0.53133  2.40849 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Groups   Name        Variance Std.Dev. Corr </span></span>
<span><span class="co">#&gt;  id       (Intercept) 137.02   11.706        </span></span>
<span><span class="co">#&gt;           I(age - 1)   53.60    7.321   -0.46</span></span>
<span><span class="co">#&gt;  Residual              69.24    8.321        </span></span>
<span><span class="co">#&gt; Number of obs: 309, groups:  id, 103</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value</span></span>
<span><span class="co">#&gt; (Intercept)  109.881      1.375   79.92</span></span>
<span><span class="co">#&gt; I(age - 1)   -16.913      1.366  -12.38</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Correlation of Fixed Effects:</span></span>
<span><span class="co">#&gt;            (Intr)</span></span>
<span><span class="co">#&gt; I(age - 1) -0.561</span></span></code></pre></div>
<p>We can visualize the differences between complete pooling, no
pooling, and partial pooling by adding the fitted trajectory from each
model to the empirical growth plots of a random sample of children in
the <code>early_intervention</code> data.</p>
<p>To do so, we’ll first use the <code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code> function from
the <strong>broom</strong> and <strong>broom.mixed</strong> packages to
get the predicted values for each child’s fitted trajectory from the
complete pooling, no pooling, and partial pooling models. Note that
<code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code> is a generic function, whose methods for linear
and multilevel models are available in the broom broom.mixed packages,
respectively.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Because the complete pooling model does not have a group indicator for</span></span>
<span><span class="co"># individuals, we need to manually add the IDs to the predicted values.</span></span>
<span><span class="va">early_intervention_pred_cp</span> <span class="op">&lt;-</span> <span class="va">early_intervention_fit_cp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"complete_pooling"</span>, id <span class="op">=</span> <span class="va">early_intervention</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="va">early_intervention_pred_cp</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 309 × 10</span></span></span>
<span><span class="co">#&gt;    cognitive_score `I(age - 1)` .fitted .resid    .hat .sigma .cooksd .std.resid</span></span>
<span><span class="co">#&gt;              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;I&lt;dbl&gt;&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>           106.           0     110.   -<span style="color: #BB0000;">4.04</span> 0.008<span style="text-decoration: underline;">09</span>   13.8 3.52<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>     -<span style="color: #BB0000;">0.294</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>            91.7          0.5   101.   -<span style="color: #BB0000;">9.74</span> 0.003<span style="text-decoration: underline;">24</span>   13.8 8.11<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>     -<span style="color: #BB0000;">0.707</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>            74.2          1      93.0 -<span style="color: #BB0000;">18.7</span>  0.008<span style="text-decoration: underline;">09</span>   13.8 7.58<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span>     -<span style="color: #BB0000;">1.36</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>           112.           0     110.    2.33 0.008<span style="text-decoration: underline;">09</span>   13.8 1.17<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>      0.169</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>           114.           0.5   101.   12.5  0.003<span style="text-decoration: underline;">24</span>   13.8 1.33<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span>      0.905</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>           119.           1      93.0  26.3  0.008<span style="text-decoration: underline;">09</span>   13.7 1.49<span style="color: #949494;">e</span><span style="color: #BB0000;">-2</span>      1.91 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>            90.4          0     110.  -<span style="color: #BB0000;">19.5</span>  0.008<span style="text-decoration: underline;">09</span>   13.8 8.19<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span>     -<span style="color: #BB0000;">1.42</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>            94.7          0.5   101.   -<span style="color: #BB0000;">6.69</span> 0.003<span style="text-decoration: underline;">24</span>   13.8 3.82<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>     -<span style="color: #BB0000;">0.485</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>            80.4          1      93.0 -<span style="color: #BB0000;">12.6</span>  0.008<span style="text-decoration: underline;">09</span>   13.8 3.42<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span>     -<span style="color: #BB0000;">0.916</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>           103.           0     110.   -<span style="color: #BB0000;">6.77</span> 0.008<span style="text-decoration: underline;">09</span>   13.8 9.88<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>     -<span style="color: #BB0000;">0.492</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 299 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: model &lt;chr&gt;, id &lt;fct&gt;</span></span></span>
<span></span>
<span><span class="co"># Because the no pooling models are separate linear models stored in a list, we</span></span>
<span><span class="co"># need to apply the augment() call to each model, then bind the predicted values</span></span>
<span><span class="co"># from each model into a single data set. Here the individual ID for each model</span></span>
<span><span class="co"># is stored in the name of list entry, which we add to the data frame using the</span></span>
<span><span class="co"># `names_to` argument of list_rbind().</span></span>
<span><span class="va">early_intervention_pred_np</span> <span class="op">&lt;-</span> <span class="va">early_intervention_fit_np</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">augment</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"no_pooling"</span><span class="op">)</span></span>
<span><span class="va">early_intervention_pred_np</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 309 × 10</span></span></span>
<span><span class="co">#&gt;    id    cognitive_score `I(age - 1)` .fitted .resid  .hat .sigma .cooksd</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;I&lt;dbl&gt;&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1               106.           0     106.  -<span style="color: #BB0000;">0.551</span> 0.833    <span style="color: #BB0000;">NaN</span>    2.50</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1                91.7          0.5    90.6  1.10  0.333    <span style="color: #BB0000;">NaN</span>    0.25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1                74.2          1      74.8 -<span style="color: #BB0000;">0.551</span> 0.833    <span style="color: #BB0000;">Inf</span>    2.50</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2               112.           0     112.   0.610 0.833    <span style="color: #BB0000;">NaN</span>    2.50</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2               114.           0.5   115.  -<span style="color: #BB0000;">1.22</span>  0.333    <span style="color: #BB0000;">NaN</span>    0.25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2               119.           1     119.   0.610 0.833    <span style="color: #BB0000;">Inf</span>    2.50</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 3                90.4          0      93.5 -<span style="color: #BB0000;">3.12</span>  0.833    <span style="color: #BB0000;">NaN</span>    2.50</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 3                94.7          0.5    88.5  6.23  0.333    <span style="color: #BB0000;">NaN</span>    0.25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 3                80.4          1      83.5 -<span style="color: #BB0000;">3.12</span>  0.833    <span style="color: #BB0000;">Inf</span>    2.50</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 4               103.           0     104.  -<span style="color: #BB0000;">0.686</span> 0.833    <span style="color: #BB0000;">NaN</span>    2.50</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 299 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: .std.resid &lt;dbl&gt;, model &lt;chr&gt;</span></span></span>
<span></span>
<span><span class="co"># Nothing special needs to be done for the partial pooling model, aside from</span></span>
<span><span class="co"># having the broom.mixed package loaded.</span></span>
<span><span class="va">early_intervention_pred_pp</span> <span class="op">&lt;-</span> <span class="va">early_intervention_fit_1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"partial_pooling"</span><span class="op">)</span></span>
<span><span class="va">early_intervention_pred_pp</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 309 × 15</span></span></span>
<span><span class="co">#&gt;    cognitive_score `I(age - 1)` id    .fitted .resid  .hat .cooksd .fixed   .mu</span></span>
<span><span class="co">#&gt;              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;I&lt;dbl&gt;&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>           106.           0   1       103.   3.11  0.439 0.097<span style="text-decoration: underline;">4</span>   110.  103. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>            91.7          0.5 1        92.6 -<span style="color: #BB0000;">0.939</span> 0.276 0.003<span style="text-decoration: underline;">36</span>  101.   92.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>            74.2          1   1        82.5 -<span style="color: #BB0000;">8.29</span>  0.395 0.535     93.0  82.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>           112.           0   2       118.  -<span style="color: #BB0000;">5.90</span>  0.439 0.352    110.  118. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>           114.           0.5 2       112.   1.42  0.276 0.007<span style="text-decoration: underline;">65</span>  101.  112. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>           119.           1   2       107.  12.4   0.395 1.20      93.0 107. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>            90.4          0   3        97.7 -<span style="color: #BB0000;">7.34</span>  0.439 0.543    110.   97.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>            94.7          0.5 3        90.7  4.07  0.276 0.063<span style="text-decoration: underline;">2</span>   101.   90.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>            80.4          1   3        83.6 -<span style="color: #BB0000;">3.21</span>  0.395 0.080<span style="text-decoration: underline;">3</span>    93.0  83.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>           103.           0   4       107.  -<span style="color: #BB0000;">3.71</span>  0.439 0.139    110.  107. </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 299 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: .offset &lt;dbl&gt;, .sqrtXwt &lt;dbl&gt;, .sqrtrwt &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   .weights &lt;dbl&gt;, .wtres &lt;dbl&gt;, model &lt;chr&gt;</span></span></span>
<span></span>
<span><span class="co"># Finally, we can bind the predicted values from the models into a single data</span></span>
<span><span class="co"># frame.</span></span>
<span><span class="va">early_intervention_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">early_intervention_pred_cp</span>,</span>
<span>  <span class="va">early_intervention_pred_np</span>,</span>
<span>  <span class="va">early_intervention_pred_pp</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Next, we’ll tidy and sample the predicted values data.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">333</span><span class="op">)</span></span>
<span><span class="va">early_intervention_preds_tidy</span> <span class="op">&lt;-</span> <span class="va">early_intervention_preds</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">id</span>, <span class="va">cognitive_score</span>, age <span class="op">=</span> <span class="va">`I(age - 1)`</span>, <span class="va">.fitted</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">id</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">age</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">early_intervention_preds_tidy</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 72 × 5</span></span></span>
<span><span class="co">#&gt;    model            id    cognitive_score   age .fitted</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> complete_pooling 2               112.    1     110. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> complete_pooling 2               114.    1.5   101. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> complete_pooling 2               119.    2      93.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> complete_pooling 6               106.    1     110. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> complete_pooling 6                96.8   1.5   101. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> complete_pooling 6                93.5   2      93.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> complete_pooling 14               88.7   1     110. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> complete_pooling 14               97.6   1.5   101. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> complete_pooling 14               81.3   2      93.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> complete_pooling 39              111.    1     110. </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 62 more rows</span></span></span></code></pre></div>
<p>Finally, we can plot the empirical growth plots of the randomly
sampled children, along with their fitted trajectory from the complete
pooling, no pooling, and partial pooling models.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">early_intervention_preds_tidy</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, group <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">cognitive_score</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.fitted</span>, colour <span class="op">=</span> <span class="va">model</span>, group <span class="op">=</span> <span class="va">model</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_colour_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">150</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span></span></code></pre></div>
<p><img src="chapter-3_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>Examining these plots, the differences between complete pooling, no
pooling, and partial pooling become apparent:</p>
<ul>
<li>The complete pooling model estimates a single average trajectory,
ignoring variation between individuals, so that each child is predicted
to have the exact same trajectory.</li>
<li>The no pooling model estimates a unique trajectory for each
individual that closely follows their observed data.</li>
<li>The partial pooling model estimates a unique trajectory for each
individual, which sometimes closely follows their observed data, and
other times lies somewhere in-between the complete pooling and no
pooling trajectories.</li>
</ul>
<p>Conceptually, the partial pooling model is similar to the no pooling
model: Both approaches model the individual change in the outcome
variable that we expect will occur during each time period under study,
allowing individuals to vary in their initial status and rate of change.
However, because the partial pooling model takes into account the
relative amount of information from each individual <em>and</em> the
average of all the individuals, its trajectories are pulled towards the
overall average—with a stronger pull the more extreme an individual’s
observed data.</p>
<p>In the case of the <code>early_intervention</code> data, most
children’s cognitive performance declined over time, which is apparent
from both the average trajectory of the complete pooling model, and the
entire set of trajectories from the no pooling model together. Although
the rate of decline varied across children, few showed any
improvement.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Figure 3.3, page 57:</span></span>
<span><span class="va">early_intervention</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cognitive_score</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="st">"no_pooling"</span>, group <span class="op">=</span> <span class="va">id</span><span class="op">)</span>,</span>
<span>      method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, span <span class="op">=</span> <span class="fl">.9</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="st">"complete_pooling"</span><span class="op">)</span>,</span>
<span>      method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, span <span class="op">=</span> <span class="fl">.9</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linewidth_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">.25</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">150</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="st">"model"</span><span class="op">)</span></span></code></pre></div>
<p><img src="chapter-3_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>Given this, those few cases that did show improvement are given less
weight in the partial pooling model, and their estimates are pulled
strongly towards the group average. The full extent of this effect can
be seen by plotting the entire set of fitted trajectories from the
partial pooling model together, along with the model’s population
average trajectory.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">early_intervention_fit_1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">cognitive_score</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>cognitive_score <span class="op">=</span> <span class="va">.fitted</span>, age <span class="op">=</span> <span class="va">`I(age - 1)`</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">age</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cognitive_score</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="st">"individual"</span>, group <span class="op">=</span> <span class="va">id</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"#3366FF"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># We'll use predict() rather than augment() to get the population-level</span></span>
<span>    <span class="co"># predictions, due to some currently bad behaviour in augment() when making</span></span>
<span>    <span class="co"># predictions on new data: https://github.com/bbolker/broom.mixed/issues/141</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span>,</span>
<span>      data <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>        age <span class="op">=</span> <span class="va">measurement_occasions</span>,</span>
<span>        cognitive_score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>          <span class="va">early_intervention_fit_1</span>,</span>
<span>          <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>age <span class="op">=</span> <span class="va">measurement_occasions</span><span class="op">)</span>,</span>
<span>          re.form <span class="op">=</span> <span class="cn">NA</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      colour <span class="op">=</span> <span class="st">"#3366FF"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linewidth_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">.25</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">150</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="st">"trajectory"</span><span class="op">)</span></span></code></pre></div>
<p><img src="chapter-3_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="the-level-2-submodel-for-systematic-interindividual-differences-in-change">3.3 The Level-2 Submodel for Systematic Interindividual Differences
in Change<a class="anchor" aria-label="anchor" href="#the-level-2-submodel-for-systematic-interindividual-differences-in-change"></a>
</h2>
<p>In Section 3.3 Singer and Willet (2003) introduce the level-2
component of the multilevel model for change—the <strong>submodel for
systematic interindividual differences in change</strong>—which is
defined by four specific features:</p>
<ol style="list-style-type: decimal">
<li>Its outcomes must be the individual growth parameters of the level-1
submodel, <span class="math inline">\(\pi_{0i}\)</span> and <span class="math inline">\(\pi_{1i}\)</span>.</li>
<li>It must have one level-2 submodel for each level-1 individual growth
parameter, which must be written in separate parts.</li>
<li>Each level-2 submodel must specify a relationship between an
individual growth parameter and the level-2 time-invariant
predictors.</li>
<li>Each level-2 submodel must allow individuals who share common
predictor values to vary in their individual change trajectories.</li>
</ol>
<p>Because the level-2 submodel must simultaneously account for both
between-group differences in individual growth parameters <em>and</em>
within-group differences in change, Singer and Willet (2003) suggest
preceding level-2 submodel specification with visual inspection of
individual growth trajectories stratified by levels of the
time-invariant predictor(s), in order to identify what kind of
population model could give rise to the observed patterns.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Figure 3.4, page 59:</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">early_intervention</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cognitive_score</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="st">"individual"</span>, group <span class="op">=</span> <span class="va">id</span><span class="op">)</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, span <span class="op">=</span> <span class="fl">.9</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, span <span class="op">=</span> <span class="fl">.9</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linewidth_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">.25</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">150</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="st">"trajectory"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="chapter-3_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># TODO: Decide whether or not to do the bottom plots.</span></span></code></pre></div>
<p>For the <code>early_intervention</code> data, which only has a single
time-invariant predictor, Singer and Willet (2003) specify the following
level-2 submodel:</p>
<p><span class="math display">\[
\begin{align}
\pi_{0i} &amp;= \gamma_{00} + \gamma_{01} \text{treatment}_i +
\zeta_{0i} \\
\pi_{1i} &amp;= \gamma_{10} + \gamma_{11} \text{treatment}_i +
\zeta_{1i},
\end{align}
\]</span></p>
<p>which asserts that the individual growth parameters of the level-1
submodel, <span class="math inline">\(\pi_{0i}\)</span> and <span class="math inline">\(\pi_{1i}\)</span>, should be treated as level-2
outcomes that are a linear function of the <span class="math inline">\(i\)</span>th child’s treatment status, <span class="math inline">\(\text{treatment}_i\)</span>. Here the parameters
<span class="math inline">\(\gamma_{00}\)</span> and <span class="math inline">\(\gamma_{10}\)</span> are <strong>level-2
intercepts</strong>; and the parameters <span class="math inline">\(\gamma_{01}\)</span> and <span class="math inline">\(\gamma_{11}\)</span> are <strong>level-2
slopes</strong>. Collectively, these four level-2 parameters are known
as <strong>fixed effects</strong>. Finally, the parameters <span class="math inline">\(\zeta_{0i}\)</span> and <span class="math inline">\(\zeta_{1i}\)</span> are <strong>level-2</strong>
residuals that allow the value of each individual’s growth parameters to
be scattered around the respective population averages. Collectively,
these two level-2 parameters are known as <strong>random
effects</strong>, which we assume are bivariate normally distributed
with mean 0, unknown variances, <span class="math inline">\(\sigma_0^2\)</span> and <span class="math inline">\(\sigma_1^2\)</span>, and unknown covariance, <span class="math inline">\(\sigma_{01}\)</span>:</p>
<p><span class="math display">\[
\begin{align}
\begin{bmatrix} \zeta_{0i} \\ \zeta_{1i} \end{bmatrix} &amp;
\sim \operatorname{N}
\begin{pmatrix}
\begin{bmatrix} 0 \\ 0 \end{bmatrix},  
\begin{bmatrix} \sigma_0^2 &amp; \sigma_{01}\\ \sigma_{01} &amp;
\sigma_1^2 \end{bmatrix}
\end{pmatrix}.
\end{align}
\]</span></p>
</div>
<div class="section level2">
<h2 id="fitting-the-multilevel-model-for-change-to-data">3.4 Fitting the Multilevel Model for Change to Data<a class="anchor" aria-label="anchor" href="#fitting-the-multilevel-model-for-change-to-data"></a>
</h2>
<p>Putting the level-1 and level-2 submodels together, our multilevel
model for change for the <code>early_intervention</code> data looks
like:</p>
<p><span class="math display">\[
\begin{alignat}{3}
&amp; \text{Level 1:} \qquad &amp;
  \text{cognitive_score}_{ij} &amp;=
  \pi_{0i} + \pi_{1i} (\text{age}_{ij} - 1) + \epsilon_{ij} \\
&amp; \text{Level 2:} \qquad &amp;
  \pi_{0i} &amp;=
  \gamma_{00} + \gamma_{01} \text{treatment}_i + \zeta_{0i} \\
&amp;                        &amp;
  \pi_{1i} &amp;=
  \gamma_{10} + \gamma_{11} \text{treatment}_i + \zeta_{1i}.
\end{alignat}
\]</span></p>
<p>Before fitting this model, we find it helpful to substitute the
level-2 equations into level-1, yielding a single reduced equation.
Although this mixed model equation is mathematically identical to the
multilevel model equation above, substituting the equations is helpful
in practice for two reasons:</p>
<ul>
<li>It makes the parameters of the model easier to identify,
particularly in the case of interactions between level-1 and level-2
predictors.</li>
<li>It is the format most mixed-effects modelling packages in R use to
specify the model formula.</li>
<li>It clarifies which statistical model is actually being fit to the
data by the software.</li>
</ul>
<p><span class="math display">\[
\begin{align}
\text{cog}_{ij} &amp;=
  \pi_{0i} + \pi_{1i} (\text{age}_{ij} - 1) + \epsilon_{ij} \\
&amp;=
  \gamma_{00} + \gamma_{01} \text{trt}_i
  + \pi_{1i} (\text{age}_{ij} - 1) + \epsilon_{ij} + \zeta_{0i} \\
&amp;=
  \gamma_{00} + \gamma_{01} \text{trt}_i
  + (\gamma_{10} + \gamma_{11} \text{trt}_i +
\zeta_{1i})(\text{age}_{ij} - 1)
  + \epsilon_{ij} + \zeta_{0i} \\
&amp;=
  \underbrace{
    \gamma_{00} + \gamma_{01} \text{trt}_i
    + \gamma_{10}(\text{age}_{ij} - 1)
    + \gamma_{11} \text{trt}_i(\text{age}_{ij} - 1)
  }_{\text{Fixed Effects}}
  + \underbrace{
    \epsilon_{ij} + \zeta_{0i} + \zeta_{1i}(\text{age}_{ij} - 1).
  }_{\text{Random Effects}}
\end{align}
\]</span></p>
<p>We can now fit our multilevel model for change for the
<code>early_intervention</code> data. Based on the equation above, all
we need to do is update our level-1 submodel to include predictors for
<code>treatment</code>, and the interaction between
<code>treatment</code> and <code>age</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span></span>
<span>  <span class="va">early_intervention_fit_1</span>,</span>
<span>  <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">treatment</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Linear mixed model fit by maximum likelihood  ['lmerMod']</span></span>
<span><span class="co">#&gt; Formula: cognitive_score ~ I(age - 1) + (1 + I(age - 1) | id) + treatment +  </span></span>
<span><span class="co">#&gt;     I(age - 1):treatment</span></span>
<span><span class="co">#&gt;    Data: early_intervention</span></span>
<span><span class="co">#&gt;       AIC       BIC    logLik  deviance  df.resid </span></span>
<span><span class="co">#&gt;  2402.540  2432.407 -1193.270  2386.540       301 </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Groups   Name        Std.Dev. Corr </span></span>
<span><span class="co">#&gt;  id       (Intercept) 11.564        </span></span>
<span><span class="co">#&gt;           I(age - 1)   6.754   -0.57</span></span>
<span><span class="co">#&gt;  Residual              8.321        </span></span>
<span><span class="co">#&gt; Number of obs: 309, groups:  id, 103</span></span>
<span><span class="co">#&gt; Fixed Effects:</span></span>
<span><span class="co">#&gt;          (Intercept)            I(age - 1)             treatment  </span></span>
<span><span class="co">#&gt;              107.822               -20.123                 3.657  </span></span>
<span><span class="co">#&gt; I(age - 1):treatment  </span></span>
<span><span class="co">#&gt;                5.702</span></span></code></pre></div>
<p>Alternatively, were we to start from scratch, we can specify our
final multilevel model for change like so.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">early_intervention_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span></span>
<span>  <span class="va">cognitive_score</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">treatment</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">early_intervention</span>,</span>
<span>  REML <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Table 3.3, page 69:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">early_intervention_fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linear mixed model fit by maximum likelihood  ['lmerMod']</span></span>
<span><span class="co">#&gt; Formula: cognitive_score ~ I(age - 1) * treatment + (1 + I(age - 1) |      id)</span></span>
<span><span class="co">#&gt;    Data: early_intervention</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span></span>
<span><span class="co">#&gt;   2402.5   2432.4  -1193.3   2386.5      301 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Scaled residuals: </span></span>
<span><span class="co">#&gt;      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">#&gt; -2.04567 -0.48714  0.04639  0.53367  2.32828 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Groups   Name        Variance Std.Dev. Corr </span></span>
<span><span class="co">#&gt;  id       (Intercept) 133.74   11.564        </span></span>
<span><span class="co">#&gt;           I(age - 1)   45.61    6.754   -0.57</span></span>
<span><span class="co">#&gt;  Residual              69.24    8.321        </span></span>
<span><span class="co">#&gt; Number of obs: 309, groups:  id, 103</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;                      Estimate Std. Error t value</span></span>
<span><span class="co">#&gt; (Intercept)           107.822      2.063  52.276</span></span>
<span><span class="co">#&gt; I(age - 1)            -20.123      2.023  -9.949</span></span>
<span><span class="co">#&gt; treatment               3.657      2.749   1.330</span></span>
<span><span class="co">#&gt; I(age - 1):treatment    5.702      2.695   2.116</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Correlation of Fixed Effects:</span></span>
<span><span class="co">#&gt;             (Intr) I(g-1) trtmnt</span></span>
<span><span class="co">#&gt; I(age - 1)  -0.605              </span></span>
<span><span class="co">#&gt; treatment   -0.750  0.454       </span></span>
<span><span class="co">#&gt; I(g-1):trtm  0.454 -0.750 -0.605</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examining-estimated-fixed-effects">3.5 Examining Estimated Fixed Effects<a class="anchor" aria-label="anchor" href="#examining-estimated-fixed-effects"></a>
</h2>
<p>In Section 3.5 Singer and Willet (2003) explain two ways to interpret
the fixed effects estimates of the multilevel model for change:</p>
<ol style="list-style-type: decimal">
<li>Interpreting fixed effects coefficients directly.</li>
<li>Plotting fitted change trajectories for prototypical
individuals.</li>
</ol>
<div class="section level3">
<h3 id="interpreting-fixed-effects-coefficients-directly">Interpreting fixed effects coefficients directly<a class="anchor" aria-label="anchor" href="#interpreting-fixed-effects-coefficients-directly"></a>
</h3>
<p>The fixed effects estimates of the multilevel model for change can be
interpreted directly in the same way as we do for any regression
coefficient. Thus, for our multilevel model for change for the
<code>early_intervention</code> data, the fixed effects estimates would
be interpreted as follows:</p>
<ul>
<li>
<span class="math inline">\(\gamma_{00}\)</span>: The model
intercept. This parameter estimates the population average true initial
status for children in the control group.</li>
<li>
<span class="math inline">\(\gamma_{01}\)</span>: The coefficient
for <code>treatment</code>. This parameter estimates the difference in
population average true initial status between children in the treatment
group and children in the control group.</li>
<li>
<span class="math inline">\(\gamma_{10}\)</span>: The coefficient
for <code>age</code>. This parameter estimates the population average
annual rate of true change for children in the control group.</li>
<li>
<span class="math inline">\(\gamma_{11}\)</span>: The coefficient
for the interaction between <code>age</code> and <code>treatment</code>.
This parameter estimates the difference in population average annual
rate of true change between children in the treatment group and children
in the control group.</li>
</ul>
<p>As with any model, we can view these estimates with the
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">early_intervention_fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linear mixed model fit by maximum likelihood  ['lmerMod']</span></span>
<span><span class="co">#&gt; Formula: cognitive_score ~ I(age - 1) * treatment + (1 + I(age - 1) |      id)</span></span>
<span><span class="co">#&gt;    Data: early_intervention</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span></span>
<span><span class="co">#&gt;   2402.5   2432.4  -1193.3   2386.5      301 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Scaled residuals: </span></span>
<span><span class="co">#&gt;      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">#&gt; -2.04567 -0.48714  0.04639  0.53367  2.32828 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Groups   Name        Variance Std.Dev. Corr </span></span>
<span><span class="co">#&gt;  id       (Intercept) 133.74   11.564        </span></span>
<span><span class="co">#&gt;           I(age - 1)   45.61    6.754   -0.57</span></span>
<span><span class="co">#&gt;  Residual              69.24    8.321        </span></span>
<span><span class="co">#&gt; Number of obs: 309, groups:  id, 103</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;                      Estimate Std. Error t value</span></span>
<span><span class="co">#&gt; (Intercept)           107.822      2.063  52.276</span></span>
<span><span class="co">#&gt; I(age - 1)            -20.123      2.023  -9.949</span></span>
<span><span class="co">#&gt; treatment               3.657      2.749   1.330</span></span>
<span><span class="co">#&gt; I(age - 1):treatment    5.702      2.695   2.116</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Correlation of Fixed Effects:</span></span>
<span><span class="co">#&gt;             (Intr) I(g-1) trtmnt</span></span>
<span><span class="co">#&gt; I(age - 1)  -0.605              </span></span>
<span><span class="co">#&gt; treatment   -0.750  0.454       </span></span>
<span><span class="co">#&gt; I(g-1):trtm  0.454 -0.750 -0.605</span></span></code></pre></div>
<p>We can also access these estimates programmatically using either the
generic <code><a href="https://rdrr.io/pkg/nlme/man/fixed.effects.html" class="external-link">fixef()</a></code> function to return a vector of the
estimates, or the <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code> function from the broom.mixed
package to return a tibble.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/fixed.effects.html" class="external-link">fixef</a></span><span class="op">(</span><span class="va">early_intervention_fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;          (Intercept)           I(age - 1)            treatment </span></span>
<span><span class="co">#&gt;           107.821683           -20.123396             3.656602 </span></span>
<span><span class="co">#&gt; I(age - 1):treatment </span></span>
<span><span class="co">#&gt;             5.702077</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">early_intervention_fit</span>, effects <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 5</span></span></span>
<span><span class="co">#&gt;   effect term                 estimate std.error statistic</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> fixed  (Intercept)            108.        2.06     52.3 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> fixed  I(age - 1)             -<span style="color: #BB0000;">20.1</span>       2.02     -<span style="color: #BB0000;">9.95</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> fixed  treatment                3.66      2.75      1.33</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> fixed  I(age - 1):treatment     5.70      2.70      2.12</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plotting-fitted-change-trajectories-for-prototypical-individuals">Plotting fitted change trajectories for prototypical
individuals<a class="anchor" aria-label="anchor" href="#plotting-fitted-change-trajectories-for-prototypical-individuals"></a>
</h3>
<p>Another way of interpreting fixed effects is to plot fitted change
trajectories for prototypical individuals, using only fixed effects
estimates to make predictions. We can do this using the following
three-step process:</p>
<ol style="list-style-type: decimal">
<li>Construct a data set for prototypical individuals.</li>
<li>Predict the fitted change trajectories for these prototypical
individuals using the fixed effects estimates.</li>
<li>Plot the fitted change trajectories.</li>
</ol>
<p>Depending on the complexity of your multilevel model for change, and
the number of prototypical individuals you wish to examine, there are a
number of ways to construct a data set for prototypical individuals. The
simplest way is to construct the data set by hand using, for example,
the <code><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble()</a></code> or <code><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble()</a></code> functions from the
<strong>tibble</strong> package. However, because it is often the case
that prototypical individuals simply represent unique combinations of
different predictor values, it is often more convenient to construct the
data set using the <code><a href="https://tidyr.tidyverse.org/reference/expand_grid.html" class="external-link">expand_grid()</a></code> or <code><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing()</a></code>
functions from the tidyr package, which both expand a data frame to
include all possible combinations of values. The difference between
these functions is that <code><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing()</a></code> is a wrapper around
<code><a href="https://tidyr.tidyverse.org/reference/expand_grid.html" class="external-link">expand_grid()</a></code> that de-duplicates and sorts its inputs.</p>
<p>For the <code>early_intervention</code> multilevel model for change,
only two prototypical individuals are possible: A child in the treatment
group (<code>treatment</code> = 1) and a child in the control group
(<code>treatment</code> = 0).</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prototypical_children</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">prototypical_children</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   treatment   age</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>         0   1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>         0   1.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>         0   2  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>         1   1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>         1   1.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>         1   2</span></span></code></pre></div>
<p>To make predictions using only the fixed effects estimates, we set
the <code>re.form</code> argument in the <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> function
to <code>NA</code>. As we noted in an earlier code comment, we use
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> rather than <code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code> here to get
our predictions, due to some <a href="https://github.com/bbolker/broom.mixed/issues/141" class="external-link">currently bad
behaviour</a> in <code>augment.merMod()</code> when making predictions
on new data for models (although in this specific example the
<code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code> approach would have worked as well).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prototypical_children</span> <span class="op">&lt;-</span> <span class="va">prototypical_children</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span>,</span>
<span>    cognitive_score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>      <span class="va">early_intervention_fit</span>, newdata <span class="op">=</span> <span class="va">prototypical_children</span>, re.form <span class="op">=</span> <span class="cn">NA</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">prototypical_children</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   treatment   age cognitive_score</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0           1             108. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0           1.5            97.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 0           2              87.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1           1             111. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1           1.5           104. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1           2              97.1</span></span></code></pre></div>
<p>Finally, we can plot the fitted change trajectories as usual.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Figure 3.5, page 71:</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">prototypical_children</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">cognitive_score</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="va">treatment</span>, group <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">150</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="chapter-3_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael McCarthy.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
