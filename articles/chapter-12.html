<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 12: Extending the discrete-time hazard model • alda</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 12: Extending the discrete-time hazard model">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">alda</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tips-tricks" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tips &amp; Tricks</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tips-tricks">
<li><a class="dropdown-item" href="../articles/longitudinal-data-organization.html">Longitudinal data organization</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-textbook-examples" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Textbook examples</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-textbook-examples">
<li><h6 class="dropdown-header" data-toc-skip>Longitudinal mixed effects modelling</h6></li>
    <li><a class="dropdown-item" href="../articles/chapter-2.html">Chapter 2</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-3.html">Chapter 3</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-4.html">Chapter 4</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-5.html">Chapter 5</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-6.html">Chapter 6</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-7.html">Chapter 7</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Longitudinal structural equation modelling</h6></li>
    <li><a class="dropdown-item" href="../articles/chapter-8.html">Chapter 8</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Survival analysis</h6></li>
    <li><a class="dropdown-item" href="../articles/chapter-9.html">Chapter 9</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-10.html">Chapter 10</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-11.html">Chapter 11</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-12.html">Chapter 12</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-13.html">Chapter 13</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-14.html">Chapter 14</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-15.html">Chapter 15</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mccarthy-m-g/alda/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Chapter 12: Extending the discrete-time hazard model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mccarthy-m-g/alda/blob/main/vignettes/articles/chapter-12.Rmd" class="external-link"><code>vignettes/articles/chapter-12.Rmd</code></a></small>
      <div class="d-none name"><code>chapter-12.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mccarthy-m-g.github.io/alda/">alda</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/glmmTMB/glmmTMB" class="external-link">glmmTMB</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/" class="external-link">broom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbolker/broom.mixed" class="external-link">broom.mixed</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modelsummary.com" class="external-link">modelsummary</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gt.rstudio.com" class="external-link">gt</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="alternative-specifications-for-the-main-effect-of-time">12.1 Alternative specifications for the “main effect” of
<code>time</code><a class="anchor" aria-label="anchor" href="#alternative-specifications-for-the-main-effect-of-time"></a>
</h2>
<p>In Section 12.1 Singer and Willett (2003) discuss alternative
functional forms for the shape of the discrete-time hazard function
using data from Gamse and Conger (1997), who measured the number of
years to receiving tenure in a sample of 260 semifinalists and
fellowship recipients in the National Academy of Education–Spencer
Foundation Post-Doctoral Fellowship Program who took an academic job
after earning a doctorate. Academics were followed for up to nine years
or until they received tenure.</p>
<p>For this example we use the <code>tenure</code> data set, a
person-level data frame with 260 rows and 3 columns:</p>
<ul>
<li>
<code>id</code>: Participant ID.</li>
<li>
<code>years</code>: Number of years to receiving tenure.</li>
<li>
<code>censor</code>: Censoring status.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tenure</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 260 × 3</span></span></span>
<span><span class="co">#&gt;    id    years censor</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 111       5      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 211       6      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 311       8      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 411       9      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 511       3      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 611       6      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 711       5      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 811       5      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 911       7      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1011      8      0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 250 more rows</span></span></span></code></pre></div>
<p>When introducing the basic discrete-time hazard model in Chapter 11,
Singer and Willett (2003) suggested beginning with a model that placed
no constraints on the shape of the hazard function over time (i.e., a
completely general functional form). This resulted in a model that was
easily interpretable, informative about the temporal shape of hazard,
and consistent with life table estimates. However, use of a completely
general functional form for <code>time</code> is not an integral feature
of the model—any <code>time</code> predictor can be treated as a
continuous variable, allowing any number of alternative functional forms
for the shape of the discrete-time hazard function.</p>
<p>As Singer and Willett (2003) discuss, specification for
<code>time</code> in the discrete-time hazard model should be motivated
by a combination of theory, previous research, and exploratory analysis,
and serious consideration of alternative functional forms should be
given when:</p>
<ul>
<li>A study involves many discrete time periods.</li>
<li>Hazard is expected to be near zero in some time periods.</li>
<li>Some time periods have small risk sets.</li>
</ul>
<p>As in choosing the functional form of an individual growth model, the
specification for <code>time</code> in the discrete-time hazard model
can take on any number of functional forms, including (but not limited
to):</p>
<ul>
<li>Discontinuities (Section 6.1).</li>
<li>Transformations in the ladder of powers (Section 6.2).</li>
<li>Polynomial forms (Section 6.3).</li>
<li>Truly nonlinear trajectories (Section 6.4).</li>
</ul>
<p>Following Singer and Willett (2003), here we will explore the use of
an ordered set of polynomials as the specification for <code>time</code>
in the discrete-time hazard model—with a focus on choosing a “final”
polynomial trajectory. Before fitting these models, we first need to
convert the person-level <code>tenure</code> data set to a person-period
data set.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tenure_pp</span> <span class="op">&lt;-</span> <span class="va">tenure</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html" class="external-link">reframe</a></span><span class="op">(</span></span>
<span>    year <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">years</span><span class="op">)</span>,</span>
<span>    event <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="va">years</span> <span class="op">&amp;</span> <span class="va">censor</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">tenure_pp</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,474 × 3</span></span></span>
<span><span class="co">#&gt;    id     year event</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 111       1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 111       2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 111       3     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 111       4     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 111       5     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 211       1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 211       2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 211       3     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 211       4     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 211       5     0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,464 more rows</span></span></span></code></pre></div>
<p>Here will fit seven discrete-time hazard models to the
<code>tenure_pp</code> person-period data set: six models of increasing
polynomial order (starting from a zero-order polynomial), and a model
with a completely general functional form for the “main effect” of
<code>time</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tenure_fit_constant</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">event</span> <span class="op">~</span> <span class="fl">1</span>, family <span class="op">=</span> <span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">tenure_pp</span><span class="op">)</span></span>
<span><span class="va">tenure_fit_linear</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">tenure_fit_constant</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">year</span><span class="op">)</span></span>
<span><span class="va">tenure_fit_quadratic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">tenure_fit_linear</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">year</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tenure_fit_cubic</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">tenure_fit_quadratic</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">year</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tenure_fit_order_4</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">tenure_fit_cubic</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">year</span><span class="op">^</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tenure_fit_order_5</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">tenure_fit_order_4</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">year</span><span class="op">^</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tenure_fit_general</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">tenure_fit_constant</span>, <span class="va">.</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tenure_fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Constant"</span> <span class="op">=</span> <span class="va">tenure_fit_constant</span>,</span>
<span>  <span class="st">"Linear"</span> <span class="op">=</span> <span class="va">tenure_fit_linear</span>,</span>
<span>  <span class="st">"Quadratic"</span> <span class="op">=</span> <span class="va">tenure_fit_quadratic</span>,</span>
<span>  <span class="st">"Cubic"</span> <span class="op">=</span> <span class="va">tenure_fit_cubic</span>,</span>
<span>  <span class="st">"Fourth order"</span> <span class="op">=</span> <span class="va">tenure_fit_order_4</span>,</span>
<span>  <span class="st">"Fifth order"</span> <span class="op">=</span> <span class="va">tenure_fit_order_5</span>,</span>
<span>  <span class="st">"General"</span> <span class="op">=</span> <span class="va">tenure_fit_general</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="comparing-alternative-specifications-for-the-main-effect-of-time">Comparing alternative specifications for the “main effect” of
<code>time</code><a class="anchor" aria-label="anchor" href="#comparing-alternative-specifications-for-the-main-effect-of-time"></a>
</h3>
<p>To select a “final” model among these alternatives, Singer and
Willett (2003) recommend comparing the fit of competing specifications
with the following approach:</p>
<ul>
<li>Compare the models graphically by plotting their fitted logit hazard
functions together. Models based on alternative specifications for
<code>time</code> should be compared against the completely general
specification, identifying whether and which of these models can
suitably reproduce the general functional form parsimoniously.</li>
<li>Compare deviance statistics across models of increasing temporal
complexity, identifying the most parsimonious alternative specifications
for <code>time</code>.</li>
<li>Compare deviance statistics for each alternative specification to
the completely general specification, identifying which of the most
parsimonious alternative specifications for <code>time</code> fit better
than the completely general specification.</li>
<li>Examine AIC and BIC statistics to supplement the comparisons of
deviance statistics.</li>
</ul>
<p>Working through this process, if you identify an alternative
specification for <code>time</code> that fits nearly as well as the
completely general one, appreciably better than all simpler ones, and no
worse than all more complex ones, consider selecting it as your “final”
model. However, if none of the alternative specifications for
<code>time</code> meet these criteria, consider retaining the completely
general specification as your “final” model.</p>
<p>We begin by plotting the fitted logit hazard functions together.
Following Singer and Willett (2003), we omit the fitted functions for
the fourth order and fifth order polynomials because their deviance
statistics suggest we cannot distinguish them from the cubic
polynomial.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tenure_preds</span> <span class="op">&lt;-</span> <span class="va">tenure_fits</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/keep_at.html" class="external-link">discard_at</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Fourth order"</span>, <span class="st">"Fifth order"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">.fit</span><span class="op">)</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">.fit</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"time"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>      <span class="va">time</span>,</span>
<span>      levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep_at.html" class="external-link">discard_at</a></span><span class="op">(</span><span class="va">tenure_fits</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Fourth order"</span>, <span class="st">"Fifth order"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Figure 12.1, page 414 (top):</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">tenure_preds</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">.fitted</span>, colour <span class="op">=</span> <span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span></span></code></pre></div>
<p><img src="chapter-12_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Next we compare goodness-of-fit statistics of the alternative and
completely general models.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare models --------------------------------------------------------------</span></span>
<span><span class="va">tenure_anovas_poly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span></span>
<span>  <span class="va">tenure_fits</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">anova</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tenure_fits</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span>, <span class="va">as.name</span><span class="op">)</span>, test <span class="op">=</span> <span class="st">"LRT"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tenure_anovas_general</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>  <span class="va">tenure_fits</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>,</span>
<span>  \<span class="op">(</span><span class="va">.fit</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">.fit</span>, <span class="va">tenure_fit_general</span>, test <span class="op">=</span> <span class="st">"LRT"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make table ------------------------------------------------------------------</span></span>
<span><span class="va">tenure_anovas_poly_tidy</span> <span class="op">&lt;-</span> <span class="va">tenure_anovas_poly</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    deviance <span class="op">=</span> <span class="va">residual.deviance</span>,</span>
<span>    previous_model <span class="op">=</span> <span class="va">deviance</span>,</span>
<span>    p.previous <span class="op">=</span> <span class="va">p.value</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tenure_fits</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span>, .before <span class="op">=</span> <span class="va">deviance</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tenure_anovas_general_tidy</span> <span class="op">&lt;-</span> <span class="va">tenure_anovas_general</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">tidy</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"time"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">time</span>, general_model <span class="op">=</span> <span class="va">deviance</span>, p.general <span class="op">=</span> <span class="va">p.value</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Table 12.2, page 413:</span></span>
<span><span class="va">tenure_anovas_poly_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">tenure_anovas_general_tidy</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html" class="external-link">add_row</a></span><span class="op">(</span>time <span class="op">=</span> <span class="st">"General"</span>, deviance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html" class="external-link">deviance</a></span><span class="op">(</span><span class="va">tenure_fit_general</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    AIC <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">tenure_fits</span>, <span class="va">AIC</span><span class="op">)</span>,</span>
<span>    BIC <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">tenure_fits</span>, <span class="va">BIC</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, \<span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">.x</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 8</span></span></span>
<span><span class="co">#&gt;   time    deviance previous_model p.previous general_model p.general   AIC   BIC</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Consta…    <span style="text-decoration: underline;">1</span>038.          <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>           206.        0    <span style="text-decoration: underline;">1</span>040. <span style="text-decoration: underline;">1</span>045.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Linear      867.         170.         0            36.3       0     871.  882.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Quadra…     836.          31.2        0             5.1       0.53  842.  858.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Cubic       833.           3.13       0.08          1.97      0.85  841.  862.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Fourth…     833.           0.43       0.51          1.54      0.82  843.  869.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Fifth …     833.           0.01       0.92          1.53      0.68  845.  877.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> General     831.          <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span>     849.  897.</span></span></code></pre></div>
<p>Following the approach recommended by Singer and Willett (2003), we
would select the quadratic polynomial model as our “final” model. We can
see that this model has a similar but more parsimonious functional form
by comparing the fitted hazard and survival functions of the quadratic
polynomial model to the completely general model.</p>
<p>First we will get the fitted hazard and survival functions for both
models.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tenure_preds_final</span> <span class="op">&lt;-</span> <span class="va">tenure_preds</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">time</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Quadratic"</span>, <span class="st">"General"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    haz.fitted <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">.fitted</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    surv.fitted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumprod</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">haz.fitted</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_map.html" class="external-link">group_modify</a></span><span class="op">(</span></span>
<span>    \<span class="op">(</span><span class="va">.group</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html" class="external-link">add_row</a></span><span class="op">(</span><span class="va">.group</span>, year <span class="op">=</span> <span class="fl">0</span>, surv.fitted <span class="op">=</span> <span class="fl">1</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">tenure_preds_final</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 × 5</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   time [2]</span></span></span>
<span><span class="co">#&gt;    time       year .fitted haz.fitted surv.fitted</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Quadratic     0  <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>             1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Quadratic     1  -<span style="color: #BB0000;">5.86</span>     0.002<span style="text-decoration: underline;">86</span>       0.997</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Quadratic     2  -<span style="color: #BB0000;">4.37</span>     0.012<span style="text-decoration: underline;">5</span>        0.985</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Quadratic     3  -<span style="color: #BB0000;">3.13</span>     0.041<span style="text-decoration: underline;">9</span>        0.943</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Quadratic     4  -<span style="color: #BB0000;">2.15</span>     0.105         0.845</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Quadratic     5  -<span style="color: #BB0000;">1.41</span>     0.196         0.679</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Quadratic     6  -<span style="color: #BB0000;">0.927</span>    0.283         0.486</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Quadratic     7  -<span style="color: #BB0000;">0.695</span>    0.333         0.325</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Quadratic     8  -<span style="color: #BB0000;">0.714</span>    0.329         0.218</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Quadratic     9  -<span style="color: #BB0000;">0.984</span>    0.272         0.159</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> General       0  <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>             1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> General       1  -<span style="color: #BB0000;">4.86</span>     0.007<span style="text-decoration: underline;">69</span>       0.992</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> General       2  -<span style="color: #BB0000;">4.13</span>     0.015<span style="text-decoration: underline;">8</span>        0.977</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> General       3  -<span style="color: #BB0000;">3.38</span>     0.032<span style="text-decoration: underline;">8</span>        0.945</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> General       4  -<span style="color: #BB0000;">2.28</span>     0.092<span style="text-decoration: underline;">5</span>        0.857</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> General       5  -<span style="color: #BB0000;">1.47</span>     0.187         0.697</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> General       6  -<span style="color: #BB0000;">0.693</span>    0.333         0.465</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> General       7  -<span style="color: #BB0000;">0.785</span>    0.313         0.319</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> General       8  -<span style="color: #BB0000;">0.633</span>    0.347         0.208</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> General       9  -<span style="color: #BB0000;">1.34</span>     0.208         0.165</span></span></code></pre></div>
<p>Then we can plot them.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tenure_fits_final_haz</span> <span class="op">&lt;-</span> <span class="va">tenure_preds_final</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">haz.fitted</span>, colour <span class="op">=</span> <span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/pal_brewer.html" class="external-link">pal_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tenure_fits_final_surv</span> <span class="op">&lt;-</span> <span class="va">tenure_fits_final_haz</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">surv.fitted</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Figure 12.1, page 414 (bottom):</span></span>
<span><span class="va">tenure_fits_final_haz</span> <span class="op">+</span> <span class="va">tenure_fits_final_surv</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span></span></code></pre></div>
<p><img src="chapter-12_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="using-the-complementary-log-log-link-to-specify-a-discrete-time-hazard-model">12.2 Using the complementary log-log link to specify a discrete-time
hazard model<a class="anchor" aria-label="anchor" href="#using-the-complementary-log-log-link-to-specify-a-discrete-time-hazard-model"></a>
</h2>
<p>In Section 12.2 Singer and Willett (2003) discuss the
<strong>complementary log-log</strong> (aka <strong>clog-log</strong>)
transformation as an alternative link function for the discrete-time
hazard model using a subset of data from Capaldi, Crosby, and
Stoolmiller (1996), who measured the grade year of first sexual
intercourse in a sample of 180 at-risk heterosexual adolescent males.
Adolescent males were followed from Grade 7 up to Grade 12 or until they
reported having had sexual intercourse for the first time.</p>
<p>For this example we return to the <code>first_sex</code> data set
introduced in Chapter 10, a person-level data frame with 180 rows and 5
columns:</p>
<ul>
<li>
<code>id</code>: Participant ID.</li>
<li>
<code>grade</code>: Grade year of first sexual intercourse.</li>
<li>
<code>censor</code>: Censoring status.</li>
<li>
<code>parental_transition</code>: Binary indicator for whether the
adolescent experienced a parental transition (where their parents
separated or repartnered).</li>
<li>
<code>parental_antisociality</code>: Composite score across four
indicators measuring parents’ level of antisocial behaviour during the
child’s formative years.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_sex</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 180 × 5</span></span></span>
<span><span class="co">#&gt;    id    grade censor parental_transition parental_antisociality</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1         9      0                   0                  1.98 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2        12      1                   1                 -<span style="color: #BB0000;">0.545</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 3        12      1                   0                 -<span style="color: #BB0000;">1.40</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 5        12      0                   1                  0.974</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 6        11      0                   0                 -<span style="color: #BB0000;">0.636</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 7         9      0                   1                 -<span style="color: #BB0000;">0.243</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 9        12      1                   0                 -<span style="color: #BB0000;">0.869</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 10       11      0                   0                  0.454</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 11       12      1                   1                  0.802</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 12       11      0                   1                 -<span style="color: #BB0000;">0.746</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 170 more rows</span></span></span></code></pre></div>
<p>As usual, we begin by converting the person-level
<code>first_sex</code> data set to a person-period data set to
facilitate subsequent exploratory analysis and model fitting.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_sex_pp</span> <span class="op">&lt;-</span> <span class="va">first_sex</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>grades <span class="op">=</span> <span class="va">grade</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html" class="external-link">reframe</a></span><span class="op">(</span></span>
<span>    grade <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">grades</span><span class="op">)</span>,</span>
<span>    event <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">grade</span> <span class="op">==</span> <span class="va">grades</span> <span class="op">&amp;</span> <span class="va">censor</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    <span class="va">parental_transition</span>,</span>
<span>    <span class="va">parental_antisociality</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">first_sex_pp</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 822 × 5</span></span></span>
<span><span class="co">#&gt;    id    grade event parental_transition parental_antisociality</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1         7     0                   0                  1.98 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1         8     0                   0                  1.98 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1         9     1                   0                  1.98 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2         7     0                   1                 -<span style="color: #BB0000;">0.545</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2         8     0                   1                 -<span style="color: #BB0000;">0.545</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2         9     0                   1                 -<span style="color: #BB0000;">0.545</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2        10     0                   1                 -<span style="color: #BB0000;">0.545</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2        11     0                   1                 -<span style="color: #BB0000;">0.545</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2        12     0                   1                 -<span style="color: #BB0000;">0.545</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 3         7     0                   0                 -<span style="color: #BB0000;">1.40</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 812 more rows</span></span></span></code></pre></div>
<p>Next, we will explore sample hazard functions for the
<code>first_sex</code> data using life table methods on the
<em>logit</em> and <em>complementary log-log</em> scales. Following from
the Chapter 11 examples for the <code>first_sex</code> data, our
research question again centres on modelling the relationship between
hazard and the time-invariant <code>parental_transition</code>
predictor—therefore, we will create a life table stratified by values of
<code>parental_transition</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_sex_lifetable</span> <span class="op">&lt;-</span> <span class="va">first_sex_pp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">parental_transition</span>, <span class="va">grade</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    n.risk <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    n.event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">event</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    n.censor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">event</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    haz.estimate <span class="op">=</span> <span class="va">n.event</span> <span class="op">/</span> <span class="va">n.risk</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">first_sex_lifetable</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 6</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   parental_transition [2]</span></span></span>
<span><span class="co">#&gt;    parental_transition grade n.risk n.event n.censor haz.estimate</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>                   0     7     72       2       70       0.027<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>                   0     8     70       2       68       0.028<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>                   0     9     68       8       60       0.118 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>                   0    10     60       8       52       0.133 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>                   0    11     52      10       42       0.192 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>                   0    12     42       8       34       0.190 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>                   1     7    108      13       95       0.120 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>                   1     8     95       5       90       0.052<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>                   1     9     90      16       74       0.178 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>                   1    10     74      21       53       0.284 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>                   1    11     53      15       38       0.283 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>                   1    12     38      18       20       0.474</span></span></code></pre></div>
<p>We can define functions for each of these transformations to
transform the estimated hazard probabilities in the
<code>first_sex</code> life table to different scales.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">odds</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="va">log_odds</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu">odds</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cloglog</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">first_sex_lifetable</span> <span class="op">&lt;-</span> <span class="va">first_sex_lifetable</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    logit.estimate <span class="op">=</span> <span class="fu">log_odds</span><span class="op">(</span><span class="va">haz.estimate</span><span class="op">)</span>,</span>
<span>    cloglog.estimate <span class="op">=</span> <span class="fu">cloglog</span><span class="op">(</span><span class="va">haz.estimate</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">first_sex_lifetable</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 8</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   parental_transition [2]</span></span></span>
<span><span class="co">#&gt;    parental_transition grade n.risk n.event n.censor haz.estimate logit.estimate</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>                   0     7     72       2       70       0.027<span style="text-decoration: underline;">8</span>         -<span style="color: #BB0000;">3.56</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>                   0     8     70       2       68       0.028<span style="text-decoration: underline;">6</span>         -<span style="color: #BB0000;">3.53</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>                   0     9     68       8       60       0.118          -<span style="color: #BB0000;">2.01</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>                   0    10     60       8       52       0.133          -<span style="color: #BB0000;">1.87</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>                   0    11     52      10       42       0.192          -<span style="color: #BB0000;">1.44</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>                   0    12     42       8       34       0.190          -<span style="color: #BB0000;">1.45</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>                   1     7    108      13       95       0.120          -<span style="color: #BB0000;">1.99</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>                   1     8     95       5       90       0.052<span style="text-decoration: underline;">6</span>         -<span style="color: #BB0000;">2.89</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>                   1     9     90      16       74       0.178          -<span style="color: #BB0000;">1.53</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>                   1    10     74      21       53       0.284          -<span style="color: #BB0000;">0.926</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>                   1    11     53      15       38       0.283          -<span style="color: #BB0000;">0.930</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>                   1    12     38      18       20       0.474          -<span style="color: #BB0000;">0.105</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: cloglog.estimate &lt;dbl&gt;</span></span></span></code></pre></div>
<p>As Singer and Willett (2003) discuss, like the logit transformation,
the complementary log-log transformation maps probabilities onto a scale
with no upper or lower bounds. However, they differ in that:</p>
<ul>
<li>The logit transformation yields the logarithm of the <em>odds of
event occurrence</em>.</li>
<li>The complementary log-log transformation yields the logarithm of the
negated logarithm of the <em>probability of event
nonoccurrence</em>.</li>
<li>The logit transformation is <em>symmetric</em> on either side of the
“median” hazard probability of 0.5, whereas the complementary log-log
transformation is <em>asymmetric</em>.</li>
</ul>
<p>The practical consequence of these differences is that the two
transformations provide similar estimates when hazard is small, but
consistently diverge as hazard increases, which we can see by sample
hazard functions for the <code>first_sex</code> data.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Figure 12.3, page 423:</span></span>
<span><span class="va">first_sex_lifetable</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">parental_transition</span>, <span class="va">grade</span>, <span class="va">logit.estimate</span>, <span class="va">cloglog.estimate</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">logit.estimate</span>, <span class="va">cloglog.estimate</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"transform"</span>,</span>
<span>    names_pattern <span class="op">=</span> <span class="st">"(.*)\\.estimate"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"haz.estimate"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>parental_transition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="va">parental_transition</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">grade</span>, y <span class="op">=</span> <span class="va">haz.estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">parental_transition</span>, linetype <span class="op">=</span> <span class="va">transform</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_colour_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span></span></code></pre></div>
<p><img src="chapter-12_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>Fitting the discrete-time hazard model using a complementary log-log
link proceeds in the same way as when a logit link is used, invoking the
same assumptions about the behaviour of complementary log-log hazard as
we would about logit hazard. However, they differ in their
<strong>proportionality assumptions</strong>:</p>
<ul>
<li>The discrete-time hazard model with logit link is a
<strong>proportional odds model</strong> whose antilogged slope
parameter estimates are <strong>odds ratios</strong>, which we assume
are proportional over time across all possible values of the predictor
(or combinations of predictors).</li>
<li>The discrete-time hazard model with complementary log-log link is a
<strong>proportional hazards model</strong> whose antilogged slope
parameter estimates are <strong>hazard ratios</strong>, which we assume
are proportional over time across all possible values of the predictor
(or combinations of predictors).</li>
</ul>
<p>The significance of this difference is that the proportional hazards
assumption invoked by the complementary log-log link yields a
discrete-time hazard model that is directly analogous to the
continuous-time hazard model. Given this, Singer and Willett (2003)
recommend the following when choosing a link function for the
discrete-time hazard model:</p>
<ul>
<li>When data are collected in truly discrete time, the complementary
log-log link has no particular advantage over the logit link. Parameter
estimates and goodness-of-fit statistics tend to be similar when fitting
identical models with alternate link functions, and the primary
difference between these two specifications is the effect size metric
for the antilogged slope parameter estimates (odds ratios or hazard
ratios).</li>
<li>When underlying metric for time is truly continuous—but the data are
collected in discrete time due to measurement difficulties—the
complementary log-log link is preferable to the logit link. This is the
case when analyzing <strong>interval-censored data</strong>, wherein
events unfold in continuous time, but information about event occurrence
is restricted to <strong>discrete-time intervals</strong>.</li>
</ul>
<p>Here we will fit two discrete-time hazard models to the
<code>first_sex_pp</code> person-period data set: one with a
complementary log-log link, and another with a logit link.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define inverse transformation functions -------------------------------------</span></span>
<span><span class="va">log_odds_inv</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cloglog_inv</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit models ------------------------------------------------------------------</span></span>
<span><span class="va">first_sex_fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cloglog <span class="op">=</span> <span class="st">"cloglog"</span>, logit <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>  \<span class="op">(</span><span class="va">.link</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span></span>
<span>      <span class="va">event</span> <span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">grade</span><span class="op">)</span> <span class="op">+</span> <span class="va">parental_transition</span>,</span>
<span>      family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="va">.link</span><span class="op">)</span>,</span>
<span>      data <span class="op">=</span> <span class="va">first_sex_pp</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make table ------------------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># Table 12.3, page 424:</span></span>
<span><span class="va">first_sex_fits</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">tidy</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_cbind</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html" class="external-link">unnest_wider</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cloglog</span>, <span class="va">logit</span><span class="op">)</span>, names_sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>term <span class="op">=</span> <span class="va">cloglog.term</span>, <span class="va">cloglog.estimate</span>, <span class="va">logit.estimate</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    term <span class="op">=</span> <span class="fu"><a href="https://modelsummary.com/man/coef_rename.html" class="external-link">coef_rename</a></span><span class="op">(</span><span class="va">term</span>, factor_name <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    cloglog.haz <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span></span>
<span>      <span class="va">term</span> <span class="op">!=</span> <span class="st">"parental_transition"</span>, <span class="fu">cloglog_inv</span><span class="op">(</span><span class="va">cloglog.estimate</span><span class="op">)</span>, <span class="cn">NA</span></span>
<span>    <span class="op">)</span>,</span>
<span>    logit.haz <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span></span>
<span>      <span class="va">term</span> <span class="op">!=</span> <span class="st">"parental_transition"</span>, <span class="fu">log_odds_inv</span><span class="op">(</span><span class="va">logit.estimate</span><span class="op">)</span>, <span class="cn">NA</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html" class="external-link">add_row</a></span><span class="op">(</span></span>
<span>    term <span class="op">=</span> <span class="st">"Deviance"</span>,</span>
<span>    cloglog.estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html" class="external-link">deviance</a></span><span class="op">(</span><span class="va">first_sex_fits</span><span class="op">$</span><span class="va">cloglog</span><span class="op">)</span>,</span>
<span>    logit.estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html" class="external-link">deviance</a></span><span class="op">(</span><span class="va">first_sex_fits</span><span class="op">$</span><span class="va">logit</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 5</span></span></span>
<span><span class="co">#&gt;   term                cloglog.estimate logit.estimate cloglog.haz logit.haz</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Grade 7                       -<span style="color: #BB0000;">2.97</span>          -<span style="color: #BB0000;">2.99</span>       0.049<span style="text-decoration: underline;">8</span>    0.047<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Grade 8                       -<span style="color: #BB0000;">3.66</span>          -<span style="color: #BB0000;">3.70</span>       0.025<span style="text-decoration: underline;">4</span>    0.024<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Grade 9                       -<span style="color: #BB0000;">2.32</span>          -<span style="color: #BB0000;">2.28</span>       0.094<span style="text-decoration: underline;">0</span>    0.092<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Grade 10                      -<span style="color: #BB0000;">1.90</span>          -<span style="color: #BB0000;">1.82</span>       0.139     0.139 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Grade 11                      -<span style="color: #BB0000;">1.76</span>          -<span style="color: #BB0000;">1.65</span>       0.158     0.161 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Grade 12                      -<span style="color: #BB0000;">1.34</span>          -<span style="color: #BB0000;">1.18</span>       0.230     0.235 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> Parental Transition            0.785          0.874      0.888     0.705 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> Deviance                     635.           635.        <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="time-varying-predictors">12.3 Time-varying predictors<a class="anchor" aria-label="anchor" href="#time-varying-predictors"></a>
</h2>
<p>In Section 12.3 Singer and Willett (2003) demonstrate how to fit the
discrete-time hazard model for data with <strong>time-varying
predictors</strong> using a subset of data from Wheaton, Rozell, and
Hall (1997), who measured the relation between age of first depressive
episode and several childhood and adult traumatic stressors in a random
sample of 1393 adults living in metropolitan Toronto, Ontario. Age of
first depressive episode and traumatic stressors was determined through
a structured interview.</p>
<p>For this example we use the <code>first_depression_1</code> data set,
a person-period data frame with 36997 rows and 7 columns:</p>
<ul>
<li>
<code>id</code>: Participant ID.</li>
<li>
<code>age</code>: Age each record corresponds to.</li>
<li>
<code>event</code>: Binary indicator for whether and when the adult
experienced a depressive episode.</li>
<li>
<code>censor</code>: Censoring status.</li>
<li>
<code>parental_divorce</code>: Binary indicator for whether the
adult’s parents divorced at this or any previous age.</li>
<li>
<code>female</code>: Binary indicator for whether the adult is a
female.</li>
<li>
<code>siblings</code>: Number of siblings.</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_depression_1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 36,997 × 7</span></span></span>
<span><span class="co">#&gt;    id      age event censor parental_divorce female siblings</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1         4     0      1                0      1        6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1         5     0      1                0      1        6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1         6     0      1                0      1        6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1         7     0      1                0      1        6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1         8     0      1                0      1        6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1         9     0      1                0      1        6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1        10     0      1                0      1        6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1        11     0      1                0      1        6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1        12     0      1                0      1        6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1        13     0      1                0      1        6</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 36,987 more rows</span></span></span></code></pre></div>
<p>No special strategies are needed to fit the discrete-time hazard
model with time-varying predictors. However, as Singer and Willett
(2003) discuss, the inclusion of time-varying predictors in a model
requires restatements of the three assumptions inherent to basic
discrete-time hazard models presented in Chapter 11. We now assume
that:</p>
<ul>
<li>There is a postulated value of logit hazard for each value of the
time-varying predictor (or for each combination of predictor values for
models with more than one predictor) <em>at each point in time</em>.
Therefore, the effect of a time-varying predictor compares different
groups of people at different times, rather than static groups of people
at different times.</li>
<li>Joining consecutive postulated values of logit hazard will yield
hazard functions that have an identical shape <em>for constant values of
the time-varying predictor(s)</em>. Similar to time-varying predictors
for the multilevel model for change (Section 5.3), the most extreme
lower and upper constant values of the time-varying predictor(s) can be
thought of as an envelope representing the complete set of population
logit hazard functions for all possible temporal patterns of the
time-varying predictor.</li>
<li>The distance between each of these logit hazard functions is
identical in every time period. Therefore, the effect of a time-varying
predictor is identical over time.</li>
</ul>
<p>To clarify these assumptions, here we will fit and plot a model with
a cubic polynomial form for <code>age</code> and the time-varying
predictor <code>parental_divorce</code> to the
<code>first_depression_1</code> data, along with sample (logit) hazard
functions from the life table.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make life table -------------------------------------------------------------</span></span>
<span><span class="va">first_depression_lifetable</span> <span class="op">&lt;-</span> <span class="va">first_depression_1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>parental_divorce <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="va">parental_divorce</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">parental_divorce</span>, <span class="va">age</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    n.risk <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    n.event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">event</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    n.censor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">event</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    haz.estimate <span class="op">=</span> <span class="va">n.event</span> <span class="op">/</span> <span class="va">n.risk</span>,</span>
<span>    haz.estimate <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">haz.estimate</span> <span class="op">==</span> <span class="fl">0</span>, <span class="cn">NA</span>, <span class="va">haz.estimate</span><span class="op">)</span>,</span>
<span>    log_odds.estimate <span class="op">=</span> <span class="fu">log_odds</span><span class="op">(</span><span class="va">haz.estimate</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop_last"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit model -------------------------------------------------------------------</span></span>
<span><span class="va">first_depression_fit_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span></span>
<span>  <span class="va">event</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span> <span class="op">-</span> <span class="fl">18</span><span class="op">)</span>, <span class="fl">3</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="va">parental_divorce</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">first_depression_1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># When a predictor enters the model as part of a matrix of covariates, such as</span></span>
<span><span class="co"># with stats::poly(), it is represented in augment() as a matrix column. A simple</span></span>
<span><span class="co"># workaround to get the predictor on its original scale as a vector is to pass</span></span>
<span><span class="co"># the original data to augment().</span></span>
<span><span class="va">first_depression_preds_1</span> <span class="op">&lt;-</span> <span class="va">first_depression_fit_1</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">first_depression_1</span>, type.predict <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>haz.estimate <span class="op">=</span> <span class="va">.fitted</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    log_odds.estimate <span class="op">=</span> <span class="fu">log_odds</span><span class="op">(</span><span class="va">haz.estimate</span><span class="op">)</span>,</span>
<span>    parental_divorce <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="va">parental_divorce</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot ------------------------------------------------------------------------</span></span>
<span><span class="va">first_depression_fit_1_haz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">haz.estimate</span>, colour <span class="op">=</span> <span class="va">parental_divorce</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">first_depression_lifetable</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">first_depression_preds_1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_colour_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.06</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">first_depression_fit_1_logit</span> <span class="op">&lt;-</span> <span class="va">first_depression_fit_1_haz</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">log_odds.estimate</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8</span>, <span class="op">-</span><span class="fl">2</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8</span>, <span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Figure 12.4, page 432:</span></span>
<span><span class="va">first_depression_fit_1_haz</span> <span class="op">/</span> <span class="va">first_depression_fit_1_logit</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span>, axes <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span></span></code></pre></div>
<p><img src="chapter-12_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="section level3">
<h3 id="plotting-the-effects-of-time-varying-predictors">Plotting the effects of time-varying predictors<a class="anchor" aria-label="anchor" href="#plotting-the-effects-of-time-varying-predictors"></a>
</h3>
<p>When plotting fitted hazard and survivor functions for prototypical
individuals, Singer and Willett (2003) suggest the following strategies
for selecting prototypical values for time-varying predictors:</p>
<ul>
<li>For time-varying predictors whose values can remain constant over
time, choose time-invariant values that represent an envelope of all
possible temporal patterns of the time-varying predictor.</li>
<li>For time-varying predictors whose values cannot remain constant over
time, choose time-varying values that reflect substantively interesting
temporal patterns.</li>
</ul>
<p>Here here we will demonstrate the first of these strategies using an
updated version of the <code>first_depression_fit_1</code> model that
includes a predictor for sex.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit model -------------------------------------------------------------------</span></span>
<span><span class="va">first_depression_fit_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">first_depression_fit_1</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">female</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make predictions ------------------------------------------------------------</span></span>
<span><span class="va">first_depression_preds_2</span> <span class="op">&lt;-</span> <span class="va">first_depression_fit_2</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span></span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span></span>
<span>      age <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">39</span>, parental_divorce <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, female <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    type.predict <span class="op">=</span> <span class="st">"response"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>haz.estimate <span class="op">=</span> <span class="va">.fitted</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">parental_divorce</span>, <span class="va">female</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    parental_divorce <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="va">parental_divorce</span><span class="op">)</span>,</span>
<span>    female <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="va">female</span><span class="op">)</span>,</span>
<span>    surv.estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumprod</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">haz.estimate</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_map.html" class="external-link">group_modify</a></span><span class="op">(</span></span>
<span>    \<span class="op">(</span><span class="va">.group</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html" class="external-link">add_row</a></span><span class="op">(</span><span class="va">.group</span>, age <span class="op">=</span> <span class="fl">3</span>, surv.estimate <span class="op">=</span> <span class="fl">1</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot ------------------------------------------------------------------------</span></span>
<span><span class="va">first_depression_fit_2_haz</span> <span class="op">&lt;-</span> <span class="va">first_depression_preds_2</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">haz.estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="va">parental_divorce</span>, colour <span class="op">=</span> <span class="va">female</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_colour_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.04</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">first_depression_fit_2_surv</span> <span class="op">&lt;-</span> <span class="va">first_depression_fit_2_haz</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">surv.estimate</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Figure 12.5, page 437:</span></span>
<span><span class="va">first_depression_fit_2_haz</span> <span class="op">/</span> <span class="va">first_depression_fit_2_surv</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span>, axes <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span></span></code></pre></div>
<p><img src="chapter-12_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="the-linear-additivity-assumption-uncovering-violations-and-simple-solutions">12.4 The linear additivity assumption: Uncovering violations and
simple solutions<a class="anchor" aria-label="anchor" href="#the-linear-additivity-assumption-uncovering-violations-and-simple-solutions"></a>
</h2>
<p>In Section 12.4 Singer and Willett (2003) introduce practical
strategies for diagnosing and correcting violations of the discrete-time
hazard model’s <strong>linear additivity assumption</strong>, which
stipulates that unit differences in the value of a (time-invariant or
time-varying) predictor correspond to fixed differences in logit hazard.
In other words, we postulate that a predictor’s effect is:</p>
<ul>
<li>
<strong>Additive</strong>: It does not depend upon the values of
other predictors in the model (i.e., there are no interactions between
substantive predictors).</li>
<li>
<strong>Linear</strong>: It does not depend upon the position of the
unit difference along its scale (i.e., there are no nonlinear
effects).</li>
</ul>
<div class="section level3">
<h3 id="interactions-between-substantive-predictors">Interactions between substantive predictors<a class="anchor" aria-label="anchor" href="#interactions-between-substantive-predictors"></a>
</h3>
<p>Singer and Willett (2003) illustrate strategies for identifying
possible interactions between substantive predictors using data from
Keiley and Martin (2002), who measured the effect of child abuse on the
risk of first juvenile arrest in a sample of 1553 adolescents aged 8 to
18. Adolescents were followed up to age 18 or until they were
arrested.</p>
<p>For this example we use the <code>first_arrest</code> data set, a
person-period data frame with 15834 rows and 5 columns:</p>
<ul>
<li>
<code>id</code>: Participant ID.</li>
<li>
<code>age</code>: Age each record corresponds to.</li>
<li>
<code>event</code>: Binary indicator for whether the adolescent was
arrested.- <code>censor</code>: Censoring status.</li>
<li>
<code>abused</code>: Binary indicator for whether the adolescent was
abused.</li>
<li>
<code>black</code>: Binary indicator for whether the adolescent is
black.</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_arrest</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15,834 × 6</span></span></span>
<span><span class="co">#&gt;    id      age event censor abused black</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1         8     0      0      0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1         9     0      0      0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1        10     0      0      0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1        11     0      0      0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1        12     0      0      0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1        13     0      0      0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1        14     0      0      0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1        15     1      0      0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2         8     0      1      1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2         9     0      1      1     0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 15,824 more rows</span></span></span></code></pre></div>
<p>Singer and Willett (2003) recommend using two strategies to identify
possible interactions between substantive predictors:</p>
<ul>
<li>Examine plots of sample (logit) hazard functions for evidence that
the magnitude of the differential in hazard varies across groups.</li>
<li>Compare goodness-of-fit statistics of nested models that include and
exclude an interaction term.</li>
</ul>
<p>To demonstrate the first strategy, we begin by constructing a life
table for the <code>first_arrest</code>, which we will use to explore
the possibility of an interaction between the <code>abused</code> and
<code>black</code> predictors.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_arrest_lifetable</span> <span class="op">&lt;-</span> <span class="va">first_arrest</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">abused</span>, <span class="va">black</span><span class="op">)</span>, <span class="va">as.logical</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">abused</span>, <span class="va">black</span>, <span class="va">age</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    n.risk <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    n.event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">event</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    n.censor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">event</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    haz.estimate <span class="op">=</span> <span class="va">n.event</span> <span class="op">/</span> <span class="va">n.risk</span>,</span>
<span>    haz.estimate <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">haz.estimate</span> <span class="op">==</span> <span class="fl">0</span>, <span class="cn">NA</span>, <span class="va">haz.estimate</span><span class="op">)</span>,</span>
<span>    log_odds.estimate <span class="op">=</span> <span class="fu">log_odds</span><span class="op">(</span><span class="va">haz.estimate</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop_last"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">first_arrest_lifetable</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 39 × 8</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   abused, black [4]</span></span></span>
<span><span class="co">#&gt;    abused black   age n.risk n.event n.censor haz.estimate log_odds.estimate</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> FALSE  FALSE     8    434       1      433      0.002<span style="text-decoration: underline;">30</span>             -<span style="color: #BB0000;">6.07</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> FALSE  FALSE    10    433       2      431      0.004<span style="text-decoration: underline;">62</span>             -<span style="color: #BB0000;">5.37</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> FALSE  FALSE    11    431       5      426      0.011<span style="text-decoration: underline;">6</span>              -<span style="color: #BB0000;">4.45</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> FALSE  FALSE    13    426       7      419      0.016<span style="text-decoration: underline;">4</span>              -<span style="color: #BB0000;">4.09</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> FALSE  FALSE    14    419       9      410      0.021<span style="text-decoration: underline;">5</span>              -<span style="color: #BB0000;">3.82</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> FALSE  FALSE    15    410      19      391      0.046<span style="text-decoration: underline;">3</span>              -<span style="color: #BB0000;">3.02</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> FALSE  FALSE    16    391      10      381      0.025<span style="text-decoration: underline;">6</span>              -<span style="color: #BB0000;">3.64</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> FALSE  FALSE    17    381      10      371      0.026<span style="text-decoration: underline;">2</span>              -<span style="color: #BB0000;">3.61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> FALSE  FALSE    18    368       3      365      0.008<span style="text-decoration: underline;">15</span>             -<span style="color: #BB0000;">4.80</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> FALSE  TRUE      9    232       1      231      0.004<span style="text-decoration: underline;">31</span>             -<span style="color: #BB0000;">5.44</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 29 more rows</span></span></span></code></pre></div>
<p>Now we can plot the sample (logit) hazard functions. Notice that the
magnitude of the differential in (logit) hazard associated with abuse is
visibly larger for black adolescents compared to white adolescents.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Figure 12.6, page 445 (top):</span></span>
<span><span class="va">first_arrest_lifetable</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">log_odds.estimate</span>, colour <span class="op">=</span> <span class="va">black</span>, linetype <span class="op">=</span> <span class="va">abused</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_colour_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">19</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">7</span>, <span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">black</span><span class="op">)</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Sample (logit) hazard functions"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="chapter-12_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>We can test for this interaction by comparing goodness-of-fit
statistics of nested models that include and exclude an interaction
term. Equivalently, as we demonstrate here, we can also examine a
sequential analysis of deviance table for the model that includes an
interaction term, rather than fitting two models (so long as the
interaction is the final term in the model formula).</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_arrest_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span></span>
<span>  <span class="va">event</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op">+</span> <span class="va">abused</span> <span class="op">+</span> <span class="va">black</span> <span class="op">+</span> <span class="va">abused</span><span class="op">:</span><span class="va">black</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">first_arrest</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">first_arrest_fit</span>, test <span class="op">=</span> <span class="st">"LRT"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Deviance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model: binomial, link: logit</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Response: event</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Terms added sequentially (first to last)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;              Df Deviance Resid. Df Resid. Dev  Pr(&gt;Chi)    </span></span>
<span><span class="co">#&gt; NULL                         15834    21950.6              </span></span>
<span><span class="co">#&gt; factor(age)  11  18850.0     15823     3100.6 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; abused        1     22.0     15822     3078.6 2.774e-06 ***</span></span>
<span><span class="co">#&gt; black         1     25.2     15821     3053.4 5.287e-07 ***</span></span>
<span><span class="co">#&gt; abused:black  1      4.0     15820     3049.4   0.04421 *  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>As usual, we can interpret interaction effects by examining combined
parameter estimates or fitted hazard (and survivor) functions for
prototypical individuals.</p>
<p>First the combined parameter estimates. A simple way to obtain these
estimates is to use the <code>type.predict = "terms"</code> argument in
the <code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code> function, which returns a matrix giving the
value of each coefficient multiplied by the prototypical values. Summing
each row of the matrix and antilogging the totals results in an odds
ratio for each prototypical individual.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_arrest_fit</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span></span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span>age <span class="op">=</span> <span class="cn">NA</span>, abused <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, black <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    type.predict <span class="op">=</span> <span class="st">"terms"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>.fitted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">.fitted</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">abused</span>, <span class="va">black</span>, odds_ratio <span class="op">=</span> <span class="va">.fitted</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   abused black odds_ratio</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      0     0       1   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      0     1       1.28</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      1     0       1.43</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>      1     1       2.96</span></span></code></pre></div>
<p>Then plots of fitted hazard functions.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_arrest_preds</span> <span class="op">&lt;-</span> <span class="va">first_arrest_fit</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span></span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fl">8</span><span class="op">:</span><span class="fl">18</span>, abused <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, black <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    type.predict <span class="op">=</span> <span class="st">"link"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>log_odds.estimate <span class="op">=</span> <span class="va">.fitted</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">abused</span>, <span class="va">black</span><span class="op">)</span>, <span class="va">as.logical</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Figure 12.6, page 445 (bottom):</span></span>
<span><span class="va">first_arrest_preds</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">log_odds.estimate</span>, colour <span class="op">=</span> <span class="va">black</span>, linetype <span class="op">=</span> <span class="va">abused</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_colour_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">19</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">7</span>, <span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Fitted (logit) hazard functions"</span><span class="op">)</span></span></code></pre></div>
<p><img src="chapter-12_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="nonlinear-effects">Nonlinear effects<a class="anchor" aria-label="anchor" href="#nonlinear-effects"></a>
</h3>
<p>Singer and Willett (2003) suggest two general strategies for
exploring the linearity assumption and identifying an appropriate
nonlinear functional form for any predictors:</p>
<ul>
<li>Transform predictors so that relationships become linear on the
transformed scale, but nonlinear on the raw scale (a la Section
6.2).</li>
<li>Categorize each continuous predictor into a small number of groups
represented by dummy variables, then examine the pattern of parameter
estimates for consecutive dummy variables to deduce the appropriate
(nonlinear) functional form. Equally spaced parameter estimates suggest
a linear effect, and unequally spaced parameter estimates suggest a
nonlinear effect.</li>
</ul>
<p>We return to the <code>first_depression_fit_2</code> model from
Section 12.3 to demonstrate the second strategy, examining the effect of
a third predictor, <code>siblings</code>. Here we will fit three
discrete-time hazard models to the <code>first_depression_1</code> data:
A model that adds <code>siblings</code> in its raw form (Model A), a
model that categorizes <code>siblings</code> into a system of dummy
variables (Model B), a model that splits <code>siblings</code> into two
groups based on the pattern of parameter estimates in Model B (Model C),
and a model that gives a cubic <code>siblings</code> specification
(Model D).</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit models ------------------------------------------------------------------</span></span>
<span><span class="va">first_depression_fit_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">first_depression_fit_2</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">siblings</span><span class="op">)</span></span>
<span><span class="va">first_depression_fit_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span></span>
<span>  <span class="va">first_depression_fit_2</span>, </span>
<span>  <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">siblings</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">siblings</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">siblings</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">siblings</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">siblings</span>, <span class="fl">9</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">first_depression_fit_C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">first_depression_fit_2</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">siblings</span> <span class="op">&gt;=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">first_depression_fit_D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span></span>
<span>  <span class="va">first_depression_fit_2</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">siblings</span>, <span class="fl">3</span>, raw <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">first_depression_fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Model A"</span> <span class="op">=</span> <span class="va">first_depression_fit_A</span>,</span>
<span>  <span class="st">"Model B"</span> <span class="op">=</span> <span class="va">first_depression_fit_B</span>,</span>
<span>  <span class="st">"Model C"</span> <span class="op">=</span> <span class="va">first_depression_fit_C</span>,</span>
<span>  <span class="st">"Model D"</span> <span class="op">=</span> <span class="va">first_depression_fit_D</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make table ------------------------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>modelsummary_get <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Table 12.4, page 449:</span></span>
<span><span class="va">first_depression_fits</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://modelsummary.com/man/modelsummary.html" class="external-link">modelsummary</a></span><span class="op">(</span></span>
<span>    fmt <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    coef_rename <span class="op">=</span> <span class="va">coef_rename</span>,</span>
<span>    gof_map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"deviance"</span>, <span class="st">"AIC"</span><span class="op">)</span>,</span>
<span>    output <span class="op">=</span> <span class="st">"gt"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div id="mwlefoodfi" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#mwlefoodfi table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#mwlefoodfi thead, #mwlefoodfi tbody, #mwlefoodfi tfoot, #mwlefoodfi tr, #mwlefoodfi td, #mwlefoodfi th {
  border-style: none;
}

#mwlefoodfi p {
  margin: 0;
  padding: 0;
}

#mwlefoodfi .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mwlefoodfi .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#mwlefoodfi .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mwlefoodfi .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mwlefoodfi .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mwlefoodfi .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mwlefoodfi .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mwlefoodfi .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mwlefoodfi .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mwlefoodfi .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mwlefoodfi .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mwlefoodfi .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mwlefoodfi .gt_spanner_row {
  border-bottom-style: hidden;
}

#mwlefoodfi .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#mwlefoodfi .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mwlefoodfi .gt_from_md > :first-child {
  margin-top: 0;
}

#mwlefoodfi .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mwlefoodfi .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mwlefoodfi .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#mwlefoodfi .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#mwlefoodfi .gt_row_group_first td {
  border-top-width: 2px;
}

#mwlefoodfi .gt_row_group_first th {
  border-top-width: 2px;
}

#mwlefoodfi .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwlefoodfi .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#mwlefoodfi .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#mwlefoodfi .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mwlefoodfi .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwlefoodfi .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mwlefoodfi .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#mwlefoodfi .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mwlefoodfi .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mwlefoodfi .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mwlefoodfi .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwlefoodfi .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mwlefoodfi .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwlefoodfi .gt_left {
  text-align: left;
}

#mwlefoodfi .gt_center {
  text-align: center;
}

#mwlefoodfi .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mwlefoodfi .gt_font_normal {
  font-weight: normal;
}

#mwlefoodfi .gt_font_bold {
  font-weight: bold;
}

#mwlefoodfi .gt_font_italic {
  font-style: italic;
}

#mwlefoodfi .gt_super {
  font-size: 65%;
}

#mwlefoodfi .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#mwlefoodfi .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#mwlefoodfi .gt_indent_1 {
  text-indent: 5px;
}

#mwlefoodfi .gt_indent_2 {
  text-indent: 10px;
}

#mwlefoodfi .gt_indent_3 {
  text-indent: 15px;
}

#mwlefoodfi .gt_indent_4 {
  text-indent: 20px;
}

#mwlefoodfi .gt_indent_5 {
  text-indent: 25px;
}

#mwlefoodfi .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#mwlefoodfi div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="table gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=" "> </th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Model A">Model A</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Model B">Model B</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Model C">Model C</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Model D">Model D</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td headers=" " class="gt_row gt_left">(Intercept)</td>
<td headers="Model A" class="gt_row gt_center">-4.3587</td>
<td headers="Model B" class="gt_row gt_center">-4.5001</td>
<td headers="Model C" class="gt_row gt_center">-4.4828</td>
<td headers="Model D" class="gt_row gt_center">-4.3943</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center">(0.1216)</td>
<td headers="Model B" class="gt_row gt_center">(0.2067)</td>
<td headers="Model C" class="gt_row gt_center">(0.1087)</td>
<td headers="Model D" class="gt_row gt_center">(0.1513)</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Poly((Age - 18), 3, Raw = TRUE)1</td>
<td headers="Model A" class="gt_row gt_center">0.0611</td>
<td headers="Model B" class="gt_row gt_center">0.0615</td>
<td headers="Model C" class="gt_row gt_center">0.0614</td>
<td headers="Model D" class="gt_row gt_center">0.0613</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center">(0.0117)</td>
<td headers="Model B" class="gt_row gt_center">(0.0117)</td>
<td headers="Model C" class="gt_row gt_center">(0.0117)</td>
<td headers="Model D" class="gt_row gt_center">(0.0117)</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Poly((Age - 18), 3, Raw = TRUE)2</td>
<td headers="Model A" class="gt_row gt_center">-0.0073</td>
<td headers="Model B" class="gt_row gt_center">-0.0073</td>
<td headers="Model C" class="gt_row gt_center">-0.0073</td>
<td headers="Model D" class="gt_row gt_center">-0.0073</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center">(0.0012)</td>
<td headers="Model B" class="gt_row gt_center">(0.0012)</td>
<td headers="Model C" class="gt_row gt_center">(0.0012)</td>
<td headers="Model D" class="gt_row gt_center">(0.0012)</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Poly((Age - 18), 3, Raw = TRUE)3</td>
<td headers="Model A" class="gt_row gt_center">0.0002</td>
<td headers="Model B" class="gt_row gt_center">0.0002</td>
<td headers="Model C" class="gt_row gt_center">0.0002</td>
<td headers="Model D" class="gt_row gt_center">0.0002</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center">(0.0001)</td>
<td headers="Model B" class="gt_row gt_center">(0.0001)</td>
<td headers="Model C" class="gt_row gt_center">(0.0001)</td>
<td headers="Model D" class="gt_row gt_center">(0.0001)</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Parental Divorce</td>
<td headers="Model A" class="gt_row gt_center">0.3726</td>
<td headers="Model B" class="gt_row gt_center">0.3727</td>
<td headers="Model C" class="gt_row gt_center">0.3710</td>
<td headers="Model D" class="gt_row gt_center">0.3731</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center">(0.1624)</td>
<td headers="Model B" class="gt_row gt_center">(0.1625)</td>
<td headers="Model C" class="gt_row gt_center">(0.1623)</td>
<td headers="Model D" class="gt_row gt_center">(0.1624)</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Female</td>
<td headers="Model A" class="gt_row gt_center">0.5587</td>
<td headers="Model B" class="gt_row gt_center">0.5596</td>
<td headers="Model C" class="gt_row gt_center">0.5581</td>
<td headers="Model D" class="gt_row gt_center">0.5655</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center">(0.1095)</td>
<td headers="Model B" class="gt_row gt_center">(0.1095)</td>
<td headers="Model C" class="gt_row gt_center">(0.1095)</td>
<td headers="Model D" class="gt_row gt_center">(0.1097)</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Siblings</td>
<td headers="Model A" class="gt_row gt_center">-0.0814</td>
<td headers="Model B" class="gt_row gt_center"></td>
<td headers="Model C" class="gt_row gt_center"></td>
<td headers="Model D" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center">(0.0223)</td>
<td headers="Model B" class="gt_row gt_center"></td>
<td headers="Model C" class="gt_row gt_center"></td>
<td headers="Model D" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Between(Siblings, 1, 2)TRUE</td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center">0.0209</td>
<td headers="Model C" class="gt_row gt_center"></td>
<td headers="Model D" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center">(0.1976)</td>
<td headers="Model C" class="gt_row gt_center"></td>
<td headers="Model D" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Between(Siblings, 3, 4)TRUE</td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center">0.0108</td>
<td headers="Model C" class="gt_row gt_center"></td>
<td headers="Model D" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center">(0.2100)</td>
<td headers="Model C" class="gt_row gt_center"></td>
<td headers="Model D" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Between(Siblings, 5, 6)TRUE</td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center">-0.4942</td>
<td headers="Model C" class="gt_row gt_center"></td>
<td headers="Model D" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center">(0.2545)</td>
<td headers="Model C" class="gt_row gt_center"></td>
<td headers="Model D" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Between(Siblings, 7, 8)TRUE</td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center">-0.7754</td>
<td headers="Model C" class="gt_row gt_center"></td>
<td headers="Model D" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center">(0.3437)</td>
<td headers="Model C" class="gt_row gt_center"></td>
<td headers="Model D" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Between(Siblings, 9, Inf)TRUE</td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center">-0.6585</td>
<td headers="Model C" class="gt_row gt_center"></td>
<td headers="Model D" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center">(0.3440)</td>
<td headers="Model C" class="gt_row gt_center"></td>
<td headers="Model D" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">(Siblings &gt;= 5)TRUE</td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center"></td>
<td headers="Model C" class="gt_row gt_center">-0.6108</td>
<td headers="Model D" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center"></td>
<td headers="Model C" class="gt_row gt_center">(0.1446)</td>
<td headers="Model D" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Poly(Siblings, 3, Raw = TRUE)1</td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center"></td>
<td headers="Model C" class="gt_row gt_center"></td>
<td headers="Model D" class="gt_row gt_center">-0.0375</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center"></td>
<td headers="Model C" class="gt_row gt_center"></td>
<td headers="Model D" class="gt_row gt_center">(0.0782)</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Poly(Siblings, 3, Raw = TRUE)2</td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center"></td>
<td headers="Model C" class="gt_row gt_center"></td>
<td headers="Model D" class="gt_row gt_center">-0.0109</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center"></td>
<td headers="Model C" class="gt_row gt_center"></td>
<td headers="Model D" class="gt_row gt_center">(0.0117)</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Poly(Siblings, 3, Raw = TRUE)3</td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center"></td>
<td headers="Model C" class="gt_row gt_center"></td>
<td headers="Model D" class="gt_row gt_center">0.0005</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="Model A" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="Model B" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="Model C" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="Model D" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;">(0.0004)</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Deviance</td>
<td headers="Model A" class="gt_row gt_center">4124.29</td>
<td headers="Model B" class="gt_row gt_center">4117.98</td>
<td headers="Model C" class="gt_row gt_center">4118.78</td>
<td headers="Model D" class="gt_row gt_center">4120.62</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">AIC</td>
<td headers="Model A" class="gt_row gt_center">4138.3</td>
<td headers="Model B" class="gt_row gt_center">4140.0</td>
<td headers="Model C" class="gt_row gt_center">4132.8</td>
<td headers="Model D" class="gt_row gt_center">4138.6</td>
</tr>
</tbody>
</table>
</div>
<p>Notice that the parameter estimates for the five
<code>siblings</code> dummy variables in Model B are not equidistant,
suggesting that Model A may be misleading due to the number of
<code>siblings</code> having a nonlinear effect on risk of depression.
Model C attempts to capture this nonlinear effect by splitting
<code>siblings</code> into two broad groups, based on the observation
that small- to mid-size families appear to have negligible influence on
risk of depression, whereas large families have much lower risk; and
Model D attempts to capture this nonlinear effect using a cubic
polynomial.</p>
<p>As Singer and Willett (2003) conclude, for the
<code>first_depression_1</code> data, the nonlinear effect of
<code>siblings</code> was jagged and disjunctive rather than smooth and
continuous; therefore, the categorical specification in Model C fit much
better than the continuous specification in Model D. However, they
caution against routinely categorizing continuous variables to capture
nonlinear effects. As usual, it is preferable to keep continuous
predictors continuous whenever possible, categorizing continuous
variables only as a last resort.</p>
</div>
</div>
<div class="section level2">
<h2 id="the-proportionality-assumption-uncovering-violations-and-simple-solutions">12.5 The proportionality assumption: Uncovering violations and
simple solutions<a class="anchor" aria-label="anchor" href="#the-proportionality-assumption-uncovering-violations-and-simple-solutions"></a>
</h2>
<p>In Section 12.5 Singer and Willett (2003) discuss strategies for
investigating and relaxing the the discrete-time hazard model’s
<strong>proportionality assumption</strong> using data from Graham
(1997), who measured the relation between mathematics course-taking and
gender identity in a sample of 3790 tenth grade high school students.
Students were followed for up to 5 terms (eleventh grade, twelfth grade,
and the first three semesters of college) or until they stopped
enrolling in mathematics courses.</p>
<p>For this example we use the <code>math_dropout</code> data set, a
person-period data frame with 9558 rows and 5 columns:</p>
<ul>
<li>
<code>id</code>: Participant ID.</li>
<li>
<code>term</code>: Academic term each record corresponds to.</li>
<li>
<code>event</code>: Binary indicator for whether the student stopped
enrolling in mathematics courses at a given term.</li>
<li>
<code>censor</code>: Censoring status.</li>
<li>
<code>woman</code>: Binary indicators for whether the student
identified as a woman.</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">math_dropout</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9,558 × 5</span></span></span>
<span><span class="co">#&gt;    id      term event censor woman</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 201303     1     0      0     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 201303     2     1      0     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 201304     1     0      0     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 201304     2     0      0     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 201304     3     1      0     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 201305     1     0      1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 201305     2     0      1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 201311     1     0      1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 201311     2     0      1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 201311     3     0      1     0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 9,548 more rows</span></span></span></code></pre></div>
<p>When introducing the basic discrete-time hazard model in Chapter 11,
and extending it in Section 12.2, Singer and Willett (2003) stipulated
discrete-time hazard models that assumed the effect of each predictor
was constant over time, resulting in logit or complementary log-log
hazard functions that have an identical distance between them in every
time period, and proportional odds or hazard ratios. However, there are
at least three ways in which a predictor’s <em>effect</em> may vary over
time:</p>
<ul>
<li>It may <em>increase</em> over time.</li>
<li>It may <em>decrease</em> over time.</li>
<li>It may be <em>particularly pronounced</em> in some time periods,
differing <em>erratically</em> over time.</li>
</ul>
<p>As Singer and Willett (2003) discuss, the existence of
<strong>time-dependent effects</strong> suggests the need for a
<strong>nonproportional odds model</strong> (or <strong>nonproportional
hazards model</strong>), that includes interactions between predictors
and <code>time</code>.</p>
<p>Here we will fit three models to the <code>math_dropout</code> data:
a proportional odds model that adds <code>woman</code> as a predictor
(Model A); a nonproportional odds model that adds a completely general
interaction between <code>woman</code> and <code>term</code>, allowing
the gender differential to differ in each term (Model B); and a
nonproportional odds model that adds a linear interaction between
<code>woman</code> and <code>term - 1</code>, allowing the gender
differential to smoothly increase or decrease over time (Model C).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit models ------------------------------------------------------------------</span></span>
<span><span class="va">math_dropout_fit_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span></span>
<span>  <span class="va">event</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">term</span><span class="op">)</span> <span class="op">+</span> <span class="va">woman</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">math_dropout</span></span>
<span><span class="op">)</span></span>
<span><span class="va">math_dropout_fit_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span></span>
<span>  <span class="va">event</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">term</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">term</span><span class="op">)</span><span class="op">:</span><span class="va">woman</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">math_dropout</span></span>
<span><span class="op">)</span></span>
<span><span class="va">math_dropout_fit_C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">math_dropout_fit_A</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">woman</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">term</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">math_dropout_fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Model A"</span> <span class="op">=</span> <span class="va">math_dropout_fit_A</span>,</span>
<span>  <span class="st">"Model B"</span> <span class="op">=</span> <span class="va">math_dropout_fit_B</span>,</span>
<span>  <span class="st">"Model C"</span> <span class="op">=</span> <span class="va">math_dropout_fit_C</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make table ------------------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># Table 12.5, page 459:</span></span>
<span><span class="va">math_dropout_fits</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://modelsummary.com/man/modelsummary.html" class="external-link">modelsummary</a></span><span class="op">(</span></span>
<span>    fmt <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    coef_rename <span class="op">=</span> \<span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="fu"><a href="https://modelsummary.com/man/coef_rename.html" class="external-link">coef_rename</a></span><span class="op">(</span><span class="va">.x</span>, factor_name <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    gof_map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"deviance"</span>, <span class="st">"AIC"</span><span class="op">)</span>,</span>
<span>    output <span class="op">=</span> <span class="st">"gt"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div id="eexombwkke" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#eexombwkke table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#eexombwkke thead, #eexombwkke tbody, #eexombwkke tfoot, #eexombwkke tr, #eexombwkke td, #eexombwkke th {
  border-style: none;
}

#eexombwkke p {
  margin: 0;
  padding: 0;
}

#eexombwkke .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#eexombwkke .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#eexombwkke .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#eexombwkke .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#eexombwkke .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#eexombwkke .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#eexombwkke .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#eexombwkke .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#eexombwkke .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#eexombwkke .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#eexombwkke .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#eexombwkke .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#eexombwkke .gt_spanner_row {
  border-bottom-style: hidden;
}

#eexombwkke .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#eexombwkke .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#eexombwkke .gt_from_md > :first-child {
  margin-top: 0;
}

#eexombwkke .gt_from_md > :last-child {
  margin-bottom: 0;
}

#eexombwkke .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#eexombwkke .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#eexombwkke .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#eexombwkke .gt_row_group_first td {
  border-top-width: 2px;
}

#eexombwkke .gt_row_group_first th {
  border-top-width: 2px;
}

#eexombwkke .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#eexombwkke .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#eexombwkke .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#eexombwkke .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#eexombwkke .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#eexombwkke .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#eexombwkke .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#eexombwkke .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#eexombwkke .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#eexombwkke .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#eexombwkke .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#eexombwkke .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#eexombwkke .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#eexombwkke .gt_left {
  text-align: left;
}

#eexombwkke .gt_center {
  text-align: center;
}

#eexombwkke .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#eexombwkke .gt_font_normal {
  font-weight: normal;
}

#eexombwkke .gt_font_bold {
  font-weight: bold;
}

#eexombwkke .gt_font_italic {
  font-style: italic;
}

#eexombwkke .gt_super {
  font-size: 65%;
}

#eexombwkke .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#eexombwkke .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#eexombwkke .gt_indent_1 {
  text-indent: 5px;
}

#eexombwkke .gt_indent_2 {
  text-indent: 10px;
}

#eexombwkke .gt_indent_3 {
  text-indent: 15px;
}

#eexombwkke .gt_indent_4 {
  text-indent: 20px;
}

#eexombwkke .gt_indent_5 {
  text-indent: 25px;
}

#eexombwkke .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#eexombwkke div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="table gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=" "> </th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Model A">Model A</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Model B">Model B</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Model C">Model C</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td headers=" " class="gt_row gt_left">Term 1</td>
<td headers="Model A" class="gt_row gt_center">-2.1308</td>
<td headers="Model B" class="gt_row gt_center">-2.0077</td>
<td headers="Model C" class="gt_row gt_center">-2.0459</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center">(0.0567)</td>
<td headers="Model B" class="gt_row gt_center">(0.0715)</td>
<td headers="Model C" class="gt_row gt_center">(0.0646)</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Term 2</td>
<td headers="Model A" class="gt_row gt_center">-0.9425</td>
<td headers="Model B" class="gt_row gt_center">-0.9643</td>
<td headers="Model C" class="gt_row gt_center">-0.9255</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center">(0.0479)</td>
<td headers="Model B" class="gt_row gt_center">(0.0585)</td>
<td headers="Model C" class="gt_row gt_center">(0.0482)</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Term 3</td>
<td headers="Model A" class="gt_row gt_center">-1.4495</td>
<td headers="Model B" class="gt_row gt_center">-1.4824</td>
<td headers="Model C" class="gt_row gt_center">-1.4966</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center">(0.0634)</td>
<td headers="Model B" class="gt_row gt_center">(0.0847)</td>
<td headers="Model C" class="gt_row gt_center">(0.0665)</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Term 4</td>
<td headers="Model A" class="gt_row gt_center">-0.6176</td>
<td headers="Model B" class="gt_row gt_center">-0.7100</td>
<td headers="Model C" class="gt_row gt_center">-0.7178</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center">(0.0757)</td>
<td headers="Model B" class="gt_row gt_center">(0.1007)</td>
<td headers="Model C" class="gt_row gt_center">(0.0861)</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Term 5</td>
<td headers="Model A" class="gt_row gt_center">-0.7716</td>
<td headers="Model B" class="gt_row gt_center">-0.8690</td>
<td headers="Model C" class="gt_row gt_center">-0.9166</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center">(0.1428)</td>
<td headers="Model B" class="gt_row gt_center">(0.1908)</td>
<td headers="Model C" class="gt_row gt_center">(0.1557)</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Woman</td>
<td headers="Model A" class="gt_row gt_center">0.3786</td>
<td headers="Model B" class="gt_row gt_center"></td>
<td headers="Model C" class="gt_row gt_center">0.2275</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center">(0.0501)</td>
<td headers="Model B" class="gt_row gt_center"></td>
<td headers="Model C" class="gt_row gt_center">(0.0774)</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Term 1:woman</td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center">0.1568</td>
<td headers="Model C" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center">(0.0978)</td>
<td headers="Model C" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Term 2:woman</td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center">0.4187</td>
<td headers="Model C" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center">(0.0792)</td>
<td headers="Model C" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Term 3:woman</td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center">0.4407</td>
<td headers="Model C" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center">(0.1158)</td>
<td headers="Model C" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Term 4:woman</td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center">0.5707</td>
<td headers="Model C" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center">(0.1445)</td>
<td headers="Model C" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Term 5:woman</td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center">0.6008</td>
<td headers="Model C" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left"></td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center">(0.2857)</td>
<td headers="Model C" class="gt_row gt_center"></td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Woman:(Term - 1)</td>
<td headers="Model A" class="gt_row gt_center"></td>
<td headers="Model B" class="gt_row gt_center"></td>
<td headers="Model C" class="gt_row gt_center">0.1198</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="Model A" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="Model B" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="Model C" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;">(0.0470)</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">Deviance</td>
<td headers="Model A" class="gt_row gt_center">9804.31</td>
<td headers="Model B" class="gt_row gt_center">9796.27</td>
<td headers="Model C" class="gt_row gt_center">9797.81</td>
</tr>
<tr>
<td headers=" " class="gt_row gt_left">AIC</td>
<td headers="Model A" class="gt_row gt_center">9816.3</td>
<td headers="Model B" class="gt_row gt_center">9816.3</td>
<td headers="Model C" class="gt_row gt_center">9811.8</td>
</tr>
</tbody>
</table>
</div>
<p>We can test the proportionality assumption by using likelihood ratio
tests to compare the deviance statistics between proportional odds
models and nonproportional odds models.</p>
<p>As Singer and Willett (2003) discuss, although Model B fits slightly
better than Model A, the likelihood ratio test suggests this improvement
is insufficient to justify four extra parameters. However, the
systematic increase in the <code>factor(term):woman</code> coefficients
of Model B suggests a more parsimonious that adds a linear interaction
between <code>woman</code> and <code>term</code>, Model C, which does
fit better than Model A (and no worse than Model B). We therefore choose
Model C as our “final” model, in lieu of Model A with its untenable
proportionality assumption.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">math_dropout_anovas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Model A vs Model B"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span></span>
<span>    <span class="va">math_dropout_fit_A</span>, <span class="va">math_dropout_fit_B</span>, test <span class="op">=</span> <span class="st">"LRT"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="st">"Model A vs Model C"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span></span>
<span>    <span class="va">math_dropout_fit_A</span>, <span class="va">math_dropout_fit_C</span>, test <span class="op">=</span> <span class="st">"LRT"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="st">"Model C vs Model B"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span></span>
<span>    <span class="va">math_dropout_fit_C</span>, <span class="va">math_dropout_fit_B</span>, test <span class="op">=</span> <span class="st">"LRT"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">math_dropout_anovas</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">tidy</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"test"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    term <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="va">term</span>, <span class="st">"0 \\+|- 1$"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">df.residual</span>, <span class="va">df</span><span class="op">)</span>, <span class="va">as.integer</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/gt.html" class="external-link">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/cols_label.html" class="external-link">cols_label</a></span><span class="op">(</span>term <span class="op">=</span> <span class="st">"comparison"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html" class="external-link">fmt_number</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.double</span><span class="op">)</span>, decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/sub_missing.html" class="external-link">sub_missing</a></span><span class="op">(</span>missing_text <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<div id="ulbfdpbcyv" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ulbfdpbcyv table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ulbfdpbcyv thead, #ulbfdpbcyv tbody, #ulbfdpbcyv tfoot, #ulbfdpbcyv tr, #ulbfdpbcyv td, #ulbfdpbcyv th {
  border-style: none;
}

#ulbfdpbcyv p {
  margin: 0;
  padding: 0;
}

#ulbfdpbcyv .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ulbfdpbcyv .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ulbfdpbcyv .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ulbfdpbcyv .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ulbfdpbcyv .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ulbfdpbcyv .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ulbfdpbcyv .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ulbfdpbcyv .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ulbfdpbcyv .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ulbfdpbcyv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ulbfdpbcyv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ulbfdpbcyv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ulbfdpbcyv .gt_spanner_row {
  border-bottom-style: hidden;
}

#ulbfdpbcyv .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ulbfdpbcyv .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ulbfdpbcyv .gt_from_md > :first-child {
  margin-top: 0;
}

#ulbfdpbcyv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ulbfdpbcyv .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ulbfdpbcyv .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ulbfdpbcyv .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ulbfdpbcyv .gt_row_group_first td {
  border-top-width: 2px;
}

#ulbfdpbcyv .gt_row_group_first th {
  border-top-width: 2px;
}

#ulbfdpbcyv .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ulbfdpbcyv .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ulbfdpbcyv .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ulbfdpbcyv .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ulbfdpbcyv .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ulbfdpbcyv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ulbfdpbcyv .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ulbfdpbcyv .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ulbfdpbcyv .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ulbfdpbcyv .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ulbfdpbcyv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ulbfdpbcyv .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ulbfdpbcyv .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ulbfdpbcyv .gt_left {
  text-align: left;
}

#ulbfdpbcyv .gt_center {
  text-align: center;
}

#ulbfdpbcyv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ulbfdpbcyv .gt_font_normal {
  font-weight: normal;
}

#ulbfdpbcyv .gt_font_bold {
  font-weight: bold;
}

#ulbfdpbcyv .gt_font_italic {
  font-style: italic;
}

#ulbfdpbcyv .gt_super {
  font-size: 65%;
}

#ulbfdpbcyv .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ulbfdpbcyv .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ulbfdpbcyv .gt_indent_1 {
  text-indent: 5px;
}

#ulbfdpbcyv .gt_indent_2 {
  text-indent: 10px;
}

#ulbfdpbcyv .gt_indent_3 {
  text-indent: 15px;
}

#ulbfdpbcyv .gt_indent_4 {
  text-indent: 20px;
}

#ulbfdpbcyv .gt_indent_5 {
  text-indent: 25px;
}

#ulbfdpbcyv .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ulbfdpbcyv div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="table gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="comparison">comparison</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="df.residual">df.residual</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="residual.deviance">residual.deviance</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="df">df</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="deviance">deviance</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="p.value">p.value</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row">
<th colspan="6" class="gt_group_heading" scope="colgroup" id="Model A vs Model B">Model A vs Model B</th>
    </tr>
<tr class="gt_row_group_first">
<td headers="Model A vs Model B  term" class="gt_row gt_left">event ~  factor(term) + woman</td>
<td headers="Model A vs Model B  df.residual" class="gt_row gt_right">9552</td>
<td headers="Model A vs Model B  residual.deviance" class="gt_row gt_right">9,804.31</td>
<td headers="Model A vs Model B  df" class="gt_row gt_right"><br></td>
<td headers="Model A vs Model B  deviance" class="gt_row gt_right"><br></td>
<td headers="Model A vs Model B  p.value" class="gt_row gt_right"><br></td>
</tr>
<tr>
<td headers="Model A vs Model B  term" class="gt_row gt_left">event ~  factor(term) + factor(term):woman</td>
<td headers="Model A vs Model B  df.residual" class="gt_row gt_right">9548</td>
<td headers="Model A vs Model B  residual.deviance" class="gt_row gt_right">9,796.27</td>
<td headers="Model A vs Model B  df" class="gt_row gt_right">4</td>
<td headers="Model A vs Model B  deviance" class="gt_row gt_right">8.04</td>
<td headers="Model A vs Model B  p.value" class="gt_row gt_right">0.09</td>
</tr>
<tr class="gt_group_heading_row">
<th colspan="6" class="gt_group_heading" scope="colgroup" id="Model A vs Model C">Model A vs Model C</th>
    </tr>
<tr class="gt_row_group_first">
<td headers="Model A vs Model C  term" class="gt_row gt_left">event ~  factor(term) + woman</td>
<td headers="Model A vs Model C  df.residual" class="gt_row gt_right">9552</td>
<td headers="Model A vs Model C  residual.deviance" class="gt_row gt_right">9,804.31</td>
<td headers="Model A vs Model C  df" class="gt_row gt_right"><br></td>
<td headers="Model A vs Model C  deviance" class="gt_row gt_right"><br></td>
<td headers="Model A vs Model C  p.value" class="gt_row gt_right"><br></td>
</tr>
<tr>
<td headers="Model A vs Model C  term" class="gt_row gt_left">event ~ factor(term) + woman + woman:I(term - 1) </td>
<td headers="Model A vs Model C  df.residual" class="gt_row gt_right">9551</td>
<td headers="Model A vs Model C  residual.deviance" class="gt_row gt_right">9,797.81</td>
<td headers="Model A vs Model C  df" class="gt_row gt_right">1</td>
<td headers="Model A vs Model C  deviance" class="gt_row gt_right">6.50</td>
<td headers="Model A vs Model C  p.value" class="gt_row gt_right">0.01</td>
</tr>
<tr class="gt_group_heading_row">
<th colspan="6" class="gt_group_heading" scope="colgroup" id="Model C vs Model B">Model C vs Model B</th>
    </tr>
<tr class="gt_row_group_first">
<td headers="Model C vs Model B  term" class="gt_row gt_left">event ~ factor(term) + woman + woman:I(term - 1) </td>
<td headers="Model C vs Model B  df.residual" class="gt_row gt_right">9551</td>
<td headers="Model C vs Model B  residual.deviance" class="gt_row gt_right">9,797.81</td>
<td headers="Model C vs Model B  df" class="gt_row gt_right"><br></td>
<td headers="Model C vs Model B  deviance" class="gt_row gt_right"><br></td>
<td headers="Model C vs Model B  p.value" class="gt_row gt_right"><br></td>
</tr>
<tr>
<td headers="Model C vs Model B  term" class="gt_row gt_left">event ~  factor(term) + factor(term):woman</td>
<td headers="Model C vs Model B  df.residual" class="gt_row gt_right">9548</td>
<td headers="Model C vs Model B  residual.deviance" class="gt_row gt_right">9,796.27</td>
<td headers="Model C vs Model B  df" class="gt_row gt_right">3</td>
<td headers="Model C vs Model B  deviance" class="gt_row gt_right">1.54</td>
<td headers="Model C vs Model B  p.value" class="gt_row gt_right">0.67</td>
</tr>
</tbody>
</table>
</div>
<p>Finally, we can plot fitted (logit) hazard functions, along with
sample (logit) hazard functions from the life table, from each of these
models to visualize their behaviour. Notice that the fitted (logit)
hazard functions of Model B are identical to the sample (logit) hazard
functions from the life table; as Singer and Willett (2003) explain, for
categorical predictors, fitted hazard functions from a general
interaction with time model reproduce within-group sample hazard
functions (just as fitted hazard functions from a model with no
substantive predictors reproduce sample hazard functions).</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make life table -------------------------------------------------------------</span></span>
<span><span class="va">math_dropout_lifetable</span> <span class="op">&lt;-</span> <span class="va">math_dropout</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>woman <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="va">woman</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">woman</span>, <span class="va">term</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="st">"Sample"</span>,</span>
<span>    n.risk <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    n.event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">event</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    n.censor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">event</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    haz.estimate <span class="op">=</span> <span class="va">n.event</span> <span class="op">/</span> <span class="va">n.risk</span>,</span>
<span>    haz.estimate <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">haz.estimate</span> <span class="op">==</span> <span class="fl">0</span>, <span class="cn">NA</span>, <span class="va">haz.estimate</span><span class="op">)</span>,</span>
<span>    log_odds.estimate <span class="op">=</span> <span class="fu">log_odds</span><span class="op">(</span><span class="va">haz.estimate</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop_last"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Make predictions ------------------------------------------------------------</span></span>
<span><span class="va">math_dropout_preds</span> <span class="op">&lt;-</span> <span class="va">math_dropout_fits</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>    \<span class="op">(</span><span class="va">.fit</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">.fit</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span></span>
<span>          newdata <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span>term <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, woman <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          type.predict <span class="op">=</span> <span class="st">"link"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"model"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>woman <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="va">woman</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>log_odds.estimate <span class="op">=</span> <span class="va">.fitted</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot ------------------------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># Figure 12.8, page 458:</span></span>
<span><span class="va">math_dropout_lifetable</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">math_dropout_preds</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">model</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">term</span>, y <span class="op">=</span> <span class="va">log_odds.estimate</span>, colour <span class="op">=</span> <span class="va">woman</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="chapter-12_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="the-no-unobserved-heterogeneity-assumption-no-simple-solution">12.6 The no unobserved heterogeneity assumption: No simple
solution<a class="anchor" aria-label="anchor" href="#the-no-unobserved-heterogeneity-assumption-no-simple-solution"></a>
</h2>
<p>In Section 12.6 Singer and Willett (2003) briefly discuss an
additional assumption common to all the discrete-time and
continuous-time hazard models presented throughout the book: That all
variation in hazard profiles across individuals is assumed to depend on
observed variation in the predictors, such that individuals who share
identical predictor profiles will have identical population hazard
functions. In other words, these models are assumed to have <strong>no
unobserved heterogeneity</strong>, and are conceptually similar to the
complete pooling model discussed in Section 3.2.</p>
<p>As Singer and Willett (2003) discuss, ignoring unobserved
heterogeneity can have the following consequences:</p>
<ul>
<li>It always leads to hazard functions that appear to decline over
time, due to the composition of the risk set changing over time as
high-risk populations experience the target event at high rates,
medium-risk populations at moderate rates, and low-risk at low rates.
Therefore, the shape of the population hazard function may fail to
describe the pattern of risk for the intended population under study,
due it being a blended average of the risk profiles of several
heterogeneous populations (whose shapes may be entirely different from
the blended average).</li>
<li>Parameter estimates can only be interpreted as <strong>population
averaged coefficients</strong>, and not as person-specific
coefficients.</li>
</ul>
<p>As with the multilevel model for change, a <strong>multilevel
discrete-time hazard model</strong> (or a multilevel continuous-time
hazard model) can be used to explicitly model heterogeneity by adding a
random effects term, such that each group has its own hazard function.
Note that the survival analysis literature often refers to multilevel
hazard models with only a person-specific random intercept as
<strong>frailty models</strong>, and with only a cluster-specific random
intercept as <strong>shared frailty models</strong>. For further
discussion of these models, see Tutz and Schmid (2016) and Austin
(2017).</p>
<p>For this example we return to the <code>teachers</code> data set
introduced in Chapter 9, a person-level data frame with 3941 rows and 3
columns:</p>
<ul>
<li>
<code>id</code>: Teacher ID.</li>
<li>
<code>years</code>: The number of years between a teacher’s dates of
hire and departure from the Michigan public schools.</li>
<li>
<code>censor</code>: Censoring status.</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">teachers</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3,941 × 3</span></span></span>
<span><span class="co">#&gt;    id    years censor</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1         1      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2         2      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 3         1      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 4         1      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 5        12      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 6         1      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 7        12      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 8         1      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 9         2      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 10        2      0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3,931 more rows</span></span></span></code></pre></div>
<p>We first need to convert the person-level <code>teachers</code> data
set to a person-period data set.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">teachers_pp</span> <span class="op">&lt;-</span> <span class="va">teachers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html" class="external-link">reframe</a></span><span class="op">(</span></span>
<span>    year <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">years</span>,</span>
<span>    event <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="va">years</span> <span class="op">&amp;</span> <span class="va">censor</span> <span class="op">==</span> <span class="fl">0</span>, true <span class="op">=</span> <span class="fl">1</span>, false <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">teachers_pp</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 24,875 × 3</span></span></span>
<span><span class="co">#&gt;    id     year event</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1         1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2         1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2         2     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 3         1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 4         1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 5         1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 5         2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 5         3     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 5         4     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 5         5     0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 24,865 more rows</span></span></span></code></pre></div>
<p>We can fit a multilevel discrete-time hazard model using either the
<code>glmer()</code> function from the <strong>lme4</strong> package or
the <code><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html" class="external-link">glmmTMB()</a></code> function from the <strong>glmmTMB</strong>
package, which are both functions for fitting <strong>generalized linear
mixed models</strong>. Here we will fit two models to the
<code>teachers_pp</code> person-period data set: a basic discrete-time
hazard model (Model A), and a frailty model (Model B).</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit models ------------------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># We are fitting this model with the glmmTMB() function instead of glm() so we</span></span>
<span><span class="co"># can compare its fit with the frailty model using the anova() function.</span></span>
<span><span class="va">teachers_fit_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html" class="external-link">glmmTMB</a></span><span class="op">(</span></span>
<span>  <span class="va">event</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">teachers_pp</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"cloglog"</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">teachers_fit_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html" class="external-link">glmmTMB</a></span><span class="op">(</span></span>
<span>  <span class="va">event</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">teachers_pp</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"cloglog"</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">teachers_fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Model A"</span> <span class="op">=</span> <span class="va">teachers_fit_A</span>,</span>
<span>  <span class="st">"Model B"</span> <span class="op">=</span> <span class="va">teachers_fit_B</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make table ------------------------------------------------------------------</span></span>
<span><span class="va">teachers_fits</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://modelsummary.com/man/modelsummary.html" class="external-link">modelsummary</a></span><span class="op">(</span></span>
<span>    fmt <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vcov"</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    coef_rename <span class="op">=</span> \<span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="fu"><a href="https://modelsummary.com/man/coef_rename.html" class="external-link">coef_rename</a></span><span class="op">(</span><span class="va">.x</span>, factor_name <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    gof_map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"logLik"</span>, <span class="st">"deviance"</span>, <span class="st">"AIC"</span>, <span class="st">"BIC"</span><span class="op">)</span>,</span>
<span>    output <span class="op">=</span> <span class="st">"gt"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_row_group.html" class="external-link">tab_row_group</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"Goodness-of-Fit"</span>, rows <span class="op">=</span> <span class="fl">26</span><span class="op">:</span><span class="fl">29</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_row_group.html" class="external-link">tab_row_group</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"Variance Components"</span>, rows <span class="op">=</span> <span class="fl">25</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_row_group.html" class="external-link">tab_row_group</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"Fixed Effects"</span>, rows <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">24</span><span class="op">)</span></span></code></pre></div>
<div id="kgufivjubq" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#kgufivjubq table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#kgufivjubq thead, #kgufivjubq tbody, #kgufivjubq tfoot, #kgufivjubq tr, #kgufivjubq td, #kgufivjubq th {
  border-style: none;
}

#kgufivjubq p {
  margin: 0;
  padding: 0;
}

#kgufivjubq .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#kgufivjubq .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#kgufivjubq .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kgufivjubq .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kgufivjubq .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kgufivjubq .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kgufivjubq .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kgufivjubq .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kgufivjubq .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kgufivjubq .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kgufivjubq .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kgufivjubq .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kgufivjubq .gt_spanner_row {
  border-bottom-style: hidden;
}

#kgufivjubq .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#kgufivjubq .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kgufivjubq .gt_from_md > :first-child {
  margin-top: 0;
}

#kgufivjubq .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kgufivjubq .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kgufivjubq .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#kgufivjubq .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#kgufivjubq .gt_row_group_first td {
  border-top-width: 2px;
}

#kgufivjubq .gt_row_group_first th {
  border-top-width: 2px;
}

#kgufivjubq .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kgufivjubq .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#kgufivjubq .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#kgufivjubq .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kgufivjubq .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kgufivjubq .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kgufivjubq .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#kgufivjubq .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#kgufivjubq .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kgufivjubq .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kgufivjubq .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kgufivjubq .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kgufivjubq .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kgufivjubq .gt_left {
  text-align: left;
}

#kgufivjubq .gt_center {
  text-align: center;
}

#kgufivjubq .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kgufivjubq .gt_font_normal {
  font-weight: normal;
}

#kgufivjubq .gt_font_bold {
  font-weight: bold;
}

#kgufivjubq .gt_font_italic {
  font-style: italic;
}

#kgufivjubq .gt_super {
  font-size: 65%;
}

#kgufivjubq .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#kgufivjubq .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#kgufivjubq .gt_indent_1 {
  text-indent: 5px;
}

#kgufivjubq .gt_indent_2 {
  text-indent: 10px;
}

#kgufivjubq .gt_indent_3 {
  text-indent: 15px;
}

#kgufivjubq .gt_indent_4 {
  text-indent: 20px;
}

#kgufivjubq .gt_indent_5 {
  text-indent: 25px;
}

#kgufivjubq .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#kgufivjubq div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="table gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=" "> </th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Model A">Model A</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Model B">Model B</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row">
<th colspan="3" class="gt_group_heading" scope="colgroup" id="Fixed Effects">Fixed Effects</th>
    </tr>
<tr class="gt_row_group_first">
<td headers="Fixed Effects   " class="gt_row gt_left">Year 1</td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">-2.0958</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">-2.6822</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left"></td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">(0.0469)</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">(0.0821)</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left">Year 2</td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">-2.1478</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">-2.5142</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left"></td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">(0.0511)</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">(0.0667)</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left">Year 3</td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">-2.0953</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">-2.2858</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left"></td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">(0.0528)</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">(0.0608)</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left">Year 4</td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">-2.1731</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">-2.2137</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left"></td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">(0.0583)</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">(0.0635)</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left">Year 5</td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">-2.3718</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">-2.2948</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left"></td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">(0.0678)</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">(0.0727)</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left">Year 6</td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">-2.4516</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">-2.2805</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left"></td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">(0.0737)</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">(0.0794)</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left">Year 7</td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">-2.7801</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">-2.5357</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left"></td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">(0.0902)</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">(0.0960)</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left">Year 8</td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">-3.0097</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">-2.7126</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left"></td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">(0.1125)</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">(0.1184)</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left">Year 9</td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">-3.1439</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">-2.8045</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left"></td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">(0.1374)</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">(0.1434)</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left">Year 10</td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">-3.2802</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">-2.9046</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left"></td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">(0.1690)</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">(0.1751)</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left">Year 11</td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">-3.6889</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">-3.2857</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left"></td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">(0.2500)</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">(0.2552)</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left">Year 12</td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">-4.3529</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">-3.9332</td>
</tr>
<tr>
<td headers="Fixed Effects   " class="gt_row gt_left"></td>
<td headers="Fixed Effects  Model A" class="gt_row gt_center">(0.4472)</td>
<td headers="Fixed Effects  Model B" class="gt_row gt_center">(0.4512)</td>
</tr>
<tr class="gt_group_heading_row">
<th colspan="3" class="gt_group_heading" scope="colgroup" id="Variance Components">Variance Components</th>
    </tr>
<tr class="gt_row_group_first">
<td headers="Variance Components   " class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;">Var  (Intercept)</td>
<td headers="Variance Components  Model A" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="Variance Components  Model B" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;">1.4420</td>
</tr>
<tr class="gt_group_heading_row">
<th colspan="3" class="gt_group_heading" scope="colgroup" id="Goodness-of-Fit">Goodness-of-Fit</th>
    </tr>
<tr class="gt_row_group_first">
<td headers="Goodness-of-Fit   " class="gt_row gt_left">Log.Lik.</td>
<td headers="Goodness-of-Fit  Model A" class="gt_row gt_center">-7291.871</td>
<td headers="Goodness-of-Fit  Model B" class="gt_row gt_center">-7248.334</td>
</tr>
<tr>
<td headers="Goodness-of-Fit   " class="gt_row gt_left">Deviance</td>
<td headers="Goodness-of-Fit  Model A" class="gt_row gt_center">14583.74</td>
<td headers="Goodness-of-Fit  Model B" class="gt_row gt_center">11044.42</td>
</tr>
<tr>
<td headers="Goodness-of-Fit   " class="gt_row gt_left">AIC</td>
<td headers="Goodness-of-Fit  Model A" class="gt_row gt_center">14607.7</td>
<td headers="Goodness-of-Fit  Model B" class="gt_row gt_center">14522.7</td>
</tr>
<tr>
<td headers="Goodness-of-Fit   " class="gt_row gt_left">BIC</td>
<td headers="Goodness-of-Fit  Model A" class="gt_row gt_center">14705.2</td>
<td headers="Goodness-of-Fit  Model B" class="gt_row gt_center">14628.2</td>
</tr>
</tbody>
</table>
</div>
<p>Comparing goodness-of-fit statistics between the nested models
suggests that the frailty model may be closer to the underlying
data-generating process, and that the monotonically decreasing sample
hazard function for the <code>teachers</code> data observed in Chapter
10 (Figure 10.1) may have been an artifact of unobserved
heterogeneity.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">teachers_fit_A</span>, <span class="va">teachers_fit_B</span><span class="op">)</span></span>
<span><span class="co">#&gt; Data: teachers_pp</span></span>
<span><span class="co">#&gt; Models:</span></span>
<span><span class="co">#&gt; teachers_fit_A: event ~ 0 + factor(year), zi=~0, disp=~1</span></span>
<span><span class="co">#&gt; teachers_fit_B: event ~ 0 + factor(year) + (1 | id), zi=~0, disp=~1</span></span>
<span><span class="co">#&gt;                Df   AIC   BIC  logLik deviance  Chisq Chi Df Pr(&gt;Chisq)    </span></span>
<span><span class="co">#&gt; teachers_fit_A 12 14608 14705 -7291.9    14584                             </span></span>
<span><span class="co">#&gt; teachers_fit_B 13 14523 14628 -7248.3    14497 87.074      1  &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>Plotting <strong>coincident hazard functions</strong>—which are
simply individual hazard functions summarized by the number of
individuals with the hazard profile—from the frailty model seems to
support this assertion. Notice that (1) the individual hazard functions
do not follow a monotonically decreasing pattern, and (2) the
composition of the risk set changes over time, with high risk teachers
leaving early and low risk teachers either leaving much later (or not at
all).</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make predictions</span></span>
<span><span class="va">teachers_preds</span> <span class="op">&lt;-</span> <span class="va">teachers_fit_B</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">teachers_pp</span>, type.predict <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>haz.estimate <span class="op">=</span> <span class="va">.fitted</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Wrangle</span></span>
<span><span class="va">teachers_cotraj</span> <span class="op">&lt;-</span> <span class="va">teachers_preds</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">year</span>, <span class="va">haz.estimate</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">year</span>,</span>
<span>    names_prefix <span class="op">=</span> <span class="st">"year_"</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">haz.estimate</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pick.html" class="external-link">pick</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>coincident_trajectories <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>trajectory_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, .before <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>    names_prefix <span class="op">=</span> <span class="st">"year_"</span>,</span>
<span>    names_transform <span class="op">=</span> <span class="va">as.integer</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"haz.estimate"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">teachers_cotraj</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">haz.estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">trajectory_id</span>, linewidth <span class="op">=</span> <span class="va">coincident_trajectories</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_linewidth.html" class="external-link">scale_linewidth_continuous</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.25</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">13</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.21</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="chapter-12_files/figure-html/unnamed-chunk-33-1.png" width="700"></p>
<p>Although this does not wholly rebuke Singer and Willett’s (2003)
original conclusion that novice teachers (or those with only a few years
of experience) are at greatest risk of leaving teaching, but that risk
of leaving declines once they gain experience; it adds an additional
layer of nuance not captured by the basic discrete-time hazard model,
which we can see by plotting the population hazard functions from both
models.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make predictions</span></span>
<span><span class="va">teachers_haz</span> <span class="op">&lt;-</span> <span class="va">teachers_fits</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>    \<span class="op">(</span><span class="va">.fit</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span></span>
<span>        <span class="va">.fit</span>,</span>
<span>        newdata <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>,</span>
<span>        type.predict <span class="op">=</span> <span class="st">"response"</span>,</span>
<span>        re.form <span class="op">=</span> <span class="cn">NA</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"model"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>haz.estimate <span class="op">=</span> <span class="va">.fitted</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">teachers_haz</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">haz.estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">13</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="chapter-12_files/figure-html/unnamed-chunk-34-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="residual-analysis">12.7 Residual analysis<a class="anchor" aria-label="anchor" href="#residual-analysis"></a>
</h2>
<p>In Section 12.7 Singer and Willett (2003) return to the
<code>first_sex</code> data to discuss two strategies for examining
<strong>deviance residuals</strong> of the discrete-time hazard
model:</p>
<ul>
<li>Using <strong>index plots</strong> (sequential plots by ID) to
examine deviance residuals on a case-by-case basis.</li>
<li>Summarizing each individual’s deviance residuals into a <strong>sum
of squared deviance residuals</strong> to examine their contribution to
the model’s deviance statistic.</li>
</ul>
<p>When examining index plots like these, Singer and Willett (2003) note
that most of the deviance residuals will be negative—except for those
records where the target event occurred—and suggest looking for
observations with extreme residuals, which suggest poor model fit. Index
plots of the sum of squared deviance individuals can be used to identify
individuals whose outcomes are poorly predicted, again by looking for
individuals with extreme aggregated residuals.</p>
<p>Here we will fit a basic discrete-time hazard model to the
<code>first_sex_pp</code> person-period data, which follows the same
specification as Model D of Table 11.3.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_sex_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span></span>
<span>  <span class="va">event</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">grade</span><span class="op">)</span> <span class="op">+</span> <span class="va">parental_transition</span> <span class="op">+</span> <span class="va">parental_antisociality</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">first_sex_pp</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">first_sex_fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = event ~ 0 + factor(grade) + parental_transition + </span></span>
<span><span class="co">#&gt;     parental_antisociality, family = binomial(link = "logit"), </span></span>
<span><span class="co">#&gt;     data = first_sex_pp)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                        Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; factor(grade)7          -2.8932     0.3206  -9.024  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; factor(grade)8          -3.5848     0.4230  -8.474  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; factor(grade)9          -2.1502     0.2775  -7.750 9.20e-15 ***</span></span>
<span><span class="co">#&gt; factor(grade)10         -1.6932     0.2646  -6.398 1.58e-10 ***</span></span>
<span><span class="co">#&gt; factor(grade)11         -1.5177     0.2757  -5.504 3.71e-08 ***</span></span>
<span><span class="co">#&gt; factor(grade)12         -1.0099     0.2811  -3.592 0.000328 ***</span></span>
<span><span class="co">#&gt; parental_transition      0.6605     0.2367   2.790 0.005266 ** </span></span>
<span><span class="co">#&gt; parental_antisociality   0.2964     0.1254   2.364 0.018089 *  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 1139.53  on 822  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance:  629.15  on 814  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 645.15</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 5</span></span></code></pre></div>
<p>We can use the <code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code> function from the
<strong>broom</strong> package to get deviance residuals for each
person-period observation by setting the <code>type.residuals</code>
argument to <code>"deviance"</code>.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_sex_fit_residuals</span> <span class="op">&lt;-</span> <span class="va">first_sex_fit</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">first_sex_pp</span>, type.residuals <span class="op">=</span> <span class="st">"deviance"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ss.deviance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">.resid</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>    censor <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">event</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="va">id</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span><span class="op">:</span><span class="va">parental_antisociality</span>, <span class="va">censor</span>, deviance <span class="op">=</span> <span class="va">.resid</span>, <span class="va">ss.deviance</span>, <span class="op">-</span><span class="va">event</span><span class="op">)</span></span>
<span></span>
<span><span class="va">first_sex_fit_residuals</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 822 × 7</span></span></span>
<span><span class="co">#&gt;    id    grade parental_transition parental_antisociality censor deviance</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1         7                   0                  1.98       0   -<span style="color: #BB0000;">0.436</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1         8                   0                  1.98       0   -<span style="color: #BB0000;">0.312</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1         9                   0                  1.98       0    1.87 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2         7                   1                 -<span style="color: #BB0000;">0.545</span>      1   -<span style="color: #BB0000;">0.418</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2         8                   1                 -<span style="color: #BB0000;">0.545</span>      1   -<span style="color: #BB0000;">0.299</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2         9                   1                 -<span style="color: #BB0000;">0.545</span>      1   -<span style="color: #BB0000;">0.592</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2        10                   1                 -<span style="color: #BB0000;">0.545</span>      1   -<span style="color: #BB0000;">0.727</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2        11                   1                 -<span style="color: #BB0000;">0.545</span>      1   -<span style="color: #BB0000;">0.785</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2        12                   1                 -<span style="color: #BB0000;">0.545</span>      1   -<span style="color: #BB0000;">0.969</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 3         7                   0                 -<span style="color: #BB0000;">1.40</span>       1   -<span style="color: #BB0000;">0.268</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 812 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: ss.deviance &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Following Singer and Willett (2003), we begin by presenting deviance
residuals for eight adolescents from the <code>first_sex_fit</code>
model.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Table 12.6, page 465:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22</span>, <span class="fl">112</span>, <span class="fl">166</span>, <span class="fl">89</span>, <span class="fl">102</span>, <span class="fl">87</span>, <span class="fl">67</span>, <span class="fl">212</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">.id</span><span class="op">)</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">first_sex_fit_residuals</span>, <span class="va">id</span> <span class="op">==</span> <span class="va">.id</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">grade</span>,</span>
<span>    names_prefix <span class="op">=</span> <span class="st">"grade_"</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">deviance</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">ss.deviance</span>, .after <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/gt.html" class="external-link">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/sub_missing.html" class="external-link">sub_missing</a></span><span class="op">(</span>missing_text <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<div id="txvafbsnay" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#txvafbsnay table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#txvafbsnay thead, #txvafbsnay tbody, #txvafbsnay tfoot, #txvafbsnay tr, #txvafbsnay td, #txvafbsnay th {
  border-style: none;
}

#txvafbsnay p {
  margin: 0;
  padding: 0;
}

#txvafbsnay .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#txvafbsnay .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#txvafbsnay .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#txvafbsnay .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#txvafbsnay .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#txvafbsnay .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#txvafbsnay .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#txvafbsnay .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#txvafbsnay .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#txvafbsnay .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#txvafbsnay .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#txvafbsnay .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#txvafbsnay .gt_spanner_row {
  border-bottom-style: hidden;
}

#txvafbsnay .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#txvafbsnay .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#txvafbsnay .gt_from_md > :first-child {
  margin-top: 0;
}

#txvafbsnay .gt_from_md > :last-child {
  margin-bottom: 0;
}

#txvafbsnay .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#txvafbsnay .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#txvafbsnay .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#txvafbsnay .gt_row_group_first td {
  border-top-width: 2px;
}

#txvafbsnay .gt_row_group_first th {
  border-top-width: 2px;
}

#txvafbsnay .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#txvafbsnay .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#txvafbsnay .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#txvafbsnay .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#txvafbsnay .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#txvafbsnay .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#txvafbsnay .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#txvafbsnay .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#txvafbsnay .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#txvafbsnay .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#txvafbsnay .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#txvafbsnay .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#txvafbsnay .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#txvafbsnay .gt_left {
  text-align: left;
}

#txvafbsnay .gt_center {
  text-align: center;
}

#txvafbsnay .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#txvafbsnay .gt_font_normal {
  font-weight: normal;
}

#txvafbsnay .gt_font_bold {
  font-weight: bold;
}

#txvafbsnay .gt_font_italic {
  font-style: italic;
}

#txvafbsnay .gt_super {
  font-size: 65%;
}

#txvafbsnay .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#txvafbsnay .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#txvafbsnay .gt_indent_1 {
  text-indent: 5px;
}

#txvafbsnay .gt_indent_2 {
  text-indent: 10px;
}

#txvafbsnay .gt_indent_3 {
  text-indent: 15px;
}

#txvafbsnay .gt_indent_4 {
  text-indent: 20px;
}

#txvafbsnay .gt_indent_5 {
  text-indent: 25px;
}

#txvafbsnay .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#txvafbsnay div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="table gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="id">id</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="parental_transition">parental_transition</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="parental_antisociality">parental_antisociality</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="censor">censor</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="grade_7">grade_7</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="grade_8">grade_8</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="grade_9">grade_9</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="grade_10">grade_10</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="grade_11">grade_11</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="grade_12">grade_12</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="ss.deviance">ss.deviance</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td headers="id" class="gt_row gt_center">22</td>
<td headers="parental_transition" class="gt_row gt_right">1</td>
<td headers="parental_antisociality" class="gt_row gt_right">-0.64964826</td>
<td headers="censor" class="gt_row gt_right">0</td>
<td headers="grade_7" class="gt_row gt_right">-0.4117311</td>
<td headers="grade_8" class="gt_row gt_right">-0.2944395</td>
<td headers="grade_9" class="gt_row gt_right">-0.5840395</td>
<td headers="grade_10" class="gt_row gt_right">-0.7176492</td>
<td headers="grade_11" class="gt_row gt_right">-0.7747741</td>
<td headers="grade_12" class="gt_row gt_right">1.4144633</td>
<td headers="ss.deviance" class="gt_row gt_right">3.713321</td>
</tr>
<tr>
<td headers="id" class="gt_row gt_center">112</td>
<td headers="parental_transition" class="gt_row gt_right">1</td>
<td headers="parental_antisociality" class="gt_row gt_right">-0.66093105</td>
<td headers="censor" class="gt_row gt_right">1</td>
<td headers="grade_7" class="gt_row gt_right">-0.4110716</td>
<td headers="grade_8" class="gt_row gt_right">-0.2939581</td>
<td headers="grade_9" class="gt_row gt_right">-0.5831423</td>
<td headers="grade_10" class="gt_row gt_right">-0.7165919</td>
<td headers="grade_11" class="gt_row gt_right">-0.7736556</td>
<td headers="grade_12" class="gt_row gt_right">-0.9562858</td>
<td headers="ss.deviance" class="gt_row gt_right">2.621976</td>
</tr>
<tr>
<td headers="id" class="gt_row gt_center">166</td>
<td headers="parental_transition" class="gt_row gt_right">1</td>
<td headers="parental_antisociality" class="gt_row gt_right">2.78141260</td>
<td headers="censor" class="gt_row gt_right">0</td>
<td headers="grade_7" class="gt_row gt_right">-0.6614533</td>
<td headers="grade_8" class="gt_row gt_right">-0.4806816</td>
<td headers="grade_9" class="gt_row gt_right">-0.9108230</td>
<td headers="grade_10" class="gt_row gt_right">-1.0903113</td>
<td headers="grade_11" class="gt_row gt_right">1.1913978</td>
<td headers="grade_12" class="gt_row gt_right"><br></td>
<td headers="ss.deviance" class="gt_row gt_right">4.106381</td>
</tr>
<tr>
<td headers="id" class="gt_row gt_center">89</td>
<td headers="parental_transition" class="gt_row gt_right">0</td>
<td headers="parental_antisociality" class="gt_row gt_right">-0.07515719</td>
<td headers="censor" class="gt_row gt_right">0</td>
<td headers="grade_7" class="gt_row gt_right">-0.3248377</td>
<td headers="grade_8" class="gt_row gt_right">-0.2313901</td>
<td headers="grade_9" class="gt_row gt_right">-0.4644566</td>
<td headers="grade_10" class="gt_row gt_right">-0.5751775</td>
<td headers="grade_11" class="gt_row gt_right">1.8623690</td>
<td headers="grade_12" class="gt_row gt_right"><br></td>
<td headers="ss.deviance" class="gt_row gt_right">4.174028</td>
</tr>
<tr>
<td headers="id" class="gt_row gt_center">102</td>
<td headers="parental_transition" class="gt_row gt_right">1</td>
<td headers="parental_antisociality" class="gt_row gt_right">0.60493168</td>
<td headers="censor" class="gt_row gt_right">0</td>
<td headers="grade_7" class="gt_row gt_right">-0.4913390</td>
<td headers="grade_8" class="gt_row gt_right">2.3694820</td>
<td headers="grade_9" class="gt_row gt_right"><br></td>
<td headers="grade_10" class="gt_row gt_right"><br></td>
<td headers="grade_11" class="gt_row gt_right"><br></td>
<td headers="grade_12" class="gt_row gt_right"><br></td>
<td headers="ss.deviance" class="gt_row gt_right">5.855859</td>
</tr>
<tr>
<td headers="id" class="gt_row gt_center">87</td>
<td headers="parental_transition" class="gt_row gt_right">1</td>
<td headers="parental_antisociality" class="gt_row gt_right">2.67790076</td>
<td headers="censor" class="gt_row gt_right">0</td>
<td headers="grade_7" class="gt_row gt_right">1.8176297</td>
<td headers="grade_8" class="gt_row gt_right"><br></td>
<td headers="grade_9" class="gt_row gt_right"><br></td>
<td headers="grade_10" class="gt_row gt_right"><br></td>
<td headers="grade_11" class="gt_row gt_right"><br></td>
<td headers="grade_12" class="gt_row gt_right"><br></td>
<td headers="ss.deviance" class="gt_row gt_right">3.303778</td>
</tr>
<tr>
<td headers="id" class="gt_row gt_center">67</td>
<td headers="parental_transition" class="gt_row gt_right">1</td>
<td headers="parental_antisociality" class="gt_row gt_right">2.27465175</td>
<td headers="censor" class="gt_row gt_right">0</td>
<td headers="grade_7" class="gt_row gt_right">-0.6180257</td>
<td headers="grade_8" class="gt_row gt_right">-0.4476515</td>
<td headers="grade_9" class="gt_row gt_right">-0.8559141</td>
<td headers="grade_10" class="gt_row gt_right">-1.0294308</td>
<td headers="grade_11" class="gt_row gt_right">-1.1007321</td>
<td headers="grade_12" class="gt_row gt_right">1.0429686</td>
<td headers="ss.deviance" class="gt_row gt_right">4.674059</td>
</tr>
<tr>
<td headers="id" class="gt_row gt_center">212</td>
<td headers="parental_transition" class="gt_row gt_right">0</td>
<td headers="parental_antisociality" class="gt_row gt_right">-0.96179113</td>
<td headers="censor" class="gt_row gt_right">1</td>
<td headers="grade_7" class="gt_row gt_right">-0.2857033</td>
<td headers="grade_8" class="gt_row gt_right">-0.2032141</td>
<td headers="grade_9" class="gt_row gt_right">-0.4097550</td>
<td headers="grade_10" class="gt_row gt_right">-0.5090181</td>
<td headers="grade_11" class="gt_row gt_right">-0.5524318</td>
<td headers="grade_12" class="gt_row gt_right">-0.6958426</td>
<td headers="ss.deviance" class="gt_row gt_right">1.339299</td>
</tr>
</tbody>
</table>
</div>
<p>Finally, we can examine (sum of squared) deviance residuals using
index plots. Note that we only convert <code>id</code> from a factor to
numeric for a cleaner looking x-axis.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_sex_fit_ss.deviance</span> <span class="op">&lt;-</span> <span class="va">first_sex_fit_residuals</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">id</span>, y <span class="op">=</span> <span class="va">ss.deviance</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">220</span>, by <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">220</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">first_sex_fit_deviance</span> <span class="op">&lt;-</span> <span class="va">first_sex_fit_ss.deviance</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">deviance</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, alpha <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">220</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Figure 12.8, page 467:</span></span>
<span><span class="va">first_sex_fit_deviance</span> <span class="op">/</span> <span class="va">first_sex_fit_ss.deviance</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>axes <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span></span></code></pre></div>
<p><img src="chapter-12_files/figure-html/unnamed-chunk-38-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael McCarthy.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
