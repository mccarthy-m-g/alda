<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 14: Fitting the Cox regression model • alda</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 14: Fitting the Cox regression model">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">alda</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tips-tricks" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tips &amp; Tricks</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tips-tricks">
<li><a class="dropdown-item" href="../articles/longitudinal-data-organization.html">Longitudinal data organization</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-textbook-examples" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Textbook examples</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-textbook-examples">
<li><h6 class="dropdown-header" data-toc-skip>Longitudinal mixed effects modelling</h6></li>
    <li><a class="dropdown-item" href="../articles/chapter-2.html">Chapter 2</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-3.html">Chapter 3</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-4.html">Chapter 4</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-5.html">Chapter 5</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-6.html">Chapter 6</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-7.html">Chapter 7</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Longitudinal structural equation modelling</h6></li>
    <li><a class="dropdown-item" href="../articles/chapter-8.html">Chapter 8</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Survival analysis</h6></li>
    <li><a class="dropdown-item" href="../articles/chapter-9.html">Chapter 9</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-10.html">Chapter 10</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-11.html">Chapter 11</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-12.html">Chapter 12</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-13.html">Chapter 13</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-14.html">Chapter 14</a></li>
    <li><a class="dropdown-item" href="../articles/chapter-15.html">Chapter 15</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mccarthy-m-g/alda/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Chapter 14: Fitting the Cox regression model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mccarthy-m-g/alda/blob/main/vignettes/articles/chapter-14.Rmd" class="external-link"><code>vignettes/articles/chapter-14.Rmd</code></a></small>
      <div class="d-none name"><code>chapter-14.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mccarthy-m-g.github.io/alda/">alda</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">muhaz</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/" class="external-link">car</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/" class="external-link">broom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modelsummary.com" class="external-link">modelsummary</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gt.rstudio.com" class="external-link">gt</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="toward-a-statistical-model-for-continuous-time-hazard">14.1 Toward a statistical model for continuous-time hazard<a class="anchor" aria-label="anchor" href="#toward-a-statistical-model-for-continuous-time-hazard"></a>
</h2>
<p>In Chapter 14 Singer and Willett (2003) develop and explain the
<strong>Cox regression model</strong> (often labelled the
<strong>proportional hazards model</strong>) using data from Henning and
Frueh (1996), who measured days to rearrest in a sample of 194 inmates
recently released from a medium security prison. Inmates were followed
for up to three years or until they were rearrested.</p>
<p>For this example we use the <code>rearrest</code> data set, a
person-level data frame with 194 rows and 7 columns:</p>
<ul>
<li>
<code>id</code>: Participant ID.</li>
<li>
<code>days</code>: Number of days to rearrest.</li>
<li>
<code>months</code>: Number of months to rearrest, on the scale of
an “average” month (with 30.4375 days).</li>
<li>
<code>censor</code>: Censoring status.</li>
<li>
<code>person_crime</code>: Committed a person-related crime</li>
<li>
<code>property_crime</code>: Binary indicator for whether the inmate
committed a property crime.</li>
<li>
<code>age</code>: Centred age at time of release.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rearrest</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 194 × 7</span></span></span>
<span><span class="co">#&gt;    id     days months censor person_crime property_crime    age</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1         2 0.065<span style="text-decoration: underline;">7</span>      0            1              1  -<span style="color: #BB0000;">1.68</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2         4 0.131       0            0              1 -<span style="color: #BB0000;">10.5</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 3         7 0.230       0            1              1  -<span style="color: #BB0000;">4.43</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 4         9 0.296       0            0              1 -<span style="color: #BB0000;">11.3</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 5         9 0.296       0            1              1  -<span style="color: #BB0000;">7.16</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 6        10 0.329       0            1              0  -<span style="color: #BB0000;">2.87</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 7        15 0.493       0            0              1  -<span style="color: #BB0000;">6.43</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 8        19 0.624       1            1              1  22.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 9        21 0.690       0            1              1 -<span style="color: #BB0000;">12.5</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 10       22 0.723       0            1              1  -<span style="color: #BB0000;">9.41</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 184 more rows</span></span></span></code></pre></div>
<p>To inform specification of the Cox regression model we will fit in
subsequent sections, we begin with some basic exploration and
description of the <code>rearrest</code> data using the descriptive
methods introduced in Chapter 13. Following Singer and Willett (2003),
our research question centres on the effect of the
<code>person_crime</code> predictor.</p>
<div class="section level3">
<h3 id="plots-of-within-group-sample-functions">Plots of within-group sample functions<a class="anchor" aria-label="anchor" href="#plots-of-within-group-sample-functions"></a>
</h3>
<p>Here we will plot within-group sample functions of survival,
cumulative hazard, and kernel-smoothed hazard estimates for the
<code>person_crime</code> predictor. Notice that former inmates who
committed a person-related crime are consistently at higher risk of
rearrest than those who committed other types of crime.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate survival and cumulative hazard functions ---------------------------</span></span>
<span><span class="va">rearrest_survfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">months</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">censor</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">rearrest</span><span class="op">)</span></span>
<span><span class="va">person_crime_0_survfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">rearrest_survfit</span>, subset <span class="op">=</span> <span class="va">person_crime</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">person_crime_1_survfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">rearrest_survfit</span>, subset <span class="op">=</span> <span class="va">person_crime</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">person_crime_survfits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  person_crime_0 <span class="op">=</span> <span class="va">person_crime_0_survfit</span>,</span>
<span>  person_crime_1 <span class="op">=</span> <span class="va">person_crime_1_survfit</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">person_crime_lifetables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>  <span class="va">person_crime_survfits</span>,</span>
<span>  \<span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">.x</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit0.html" class="external-link">survfit0</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cumhaz.estimate <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">time</span>, surv.estimate <span class="op">=</span> <span class="va">estimate</span>, <span class="va">cumhaz.estimate</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate kernel-smoothed hazard functions -----------------------------------</span></span>
<span><span class="va">person_crime_smoothhaz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    person_crime_0 <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rearrest</span>, <span class="va">person_crime</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">$</span><span class="va">months</span>,</span>
<span>    person_crime_1 <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rearrest</span>, <span class="va">person_crime</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">months</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rearrest</span>, <span class="va">person_crime</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">$</span><span class="va">censor</span>,</span>
<span>    <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rearrest</span>, <span class="va">person_crime</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">censor</span></span>
<span>  <span class="op">)</span>,</span>
<span>  \<span class="op">(</span><span class="va">.time</span>, <span class="va">.event</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">kernel_smoothed_hazard</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/muhaz/man/muhaz.html" class="external-link">muhaz</a></span><span class="op">(</span></span>
<span>      <span class="va">.time</span>,</span>
<span>      <span class="va">.event</span>,</span>
<span>      min.time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">.time</span><span class="op">[</span><span class="fl">1</span> <span class="op">-</span> <span class="va">.event</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fl">8</span>,</span>
<span>      max.time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">.time</span><span class="op">[</span><span class="fl">1</span> <span class="op">-</span> <span class="va">.event</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fl">8</span>,</span>
<span>      bw.grid <span class="op">=</span> <span class="fl">8</span>,</span>
<span>      bw.method <span class="op">=</span> <span class="st">"global"</span>,</span>
<span>      b.cor <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>      kern <span class="op">=</span> <span class="st">"epanechnikov"</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">kernel_smoothed_hazard</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>smoothhaz.estimate <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Join estimates --------------------------------------------------------------</span></span>
<span><span class="va">person_crime_functions</span> <span class="op">&lt;-</span> <span class="va">person_crime_lifetables</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span></span>
<span>    <span class="va">person_crime_smoothhaz</span>,</span>
<span>    \<span class="op">(</span><span class="va">.x</span>, <span class="va">.y</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">.x</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">.y</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>months <span class="op">=</span> <span class="va">time</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"person_crime"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>person_crime <span class="op">=</span> <span class="va">person_crime</span> <span class="op">==</span> <span class="st">"person_crime_1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot ------------------------------------------------------------------------</span></span>
<span><span class="va">person_crime_surv</span> <span class="op">&lt;-</span> <span class="va">person_crime_functions</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">months</span>, <span class="va">surv.estimate</span>, <span class="va">person_crime</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">months</span>, y <span class="op">=</span> <span class="va">surv.estimate</span>, colour <span class="op">=</span> <span class="va">person_crime</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_colour_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">36</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">person_crime_cumhaz</span> <span class="op">&lt;-</span> <span class="va">person_crime_functions</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">months</span>, <span class="va">cumhaz.estimate</span>, <span class="va">person_crime</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">months</span>, y <span class="op">=</span> <span class="va">cumhaz.estimate</span>, colour <span class="op">=</span> <span class="va">person_crime</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_colour_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">36</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">person_crime_smoothhaz</span> <span class="op">&lt;-</span> <span class="va">person_crime_functions</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">months</span>, <span class="va">smoothhaz.estimate</span>, <span class="va">person_crime</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">months</span>, y <span class="op">=</span> <span class="va">smoothhaz.estimate</span>, colour <span class="op">=</span> <span class="va">person_crime</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_colour_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">36</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.08</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Figure 14.1, page 505:</span></span>
<span><span class="va">person_crime_surv</span> <span class="op">/</span> <span class="va">person_crime_cumhaz</span> <span class="op">/</span> <span class="va">person_crime_smoothhaz</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span>, axes <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span></span></code></pre></div>
<p><img src="chapter-14_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="what-kind-of-statistical-model-do-these-plots-suggest">What kind of statistical model do these plots suggest?<a class="anchor" aria-label="anchor" href="#what-kind-of-statistical-model-do-these-plots-suggest"></a>
</h3>
<p>In specifying a suitable statistical model to represent the
relationship between the population continuous-time hazard function and
predictors, Singer and Willett (2003) begin by developing a cumulative
hazard formulation of the Cox regression model, which has two
complications we must deal with.</p>
<p>First, the model must respect the semi-bounded nature of the
cumulative hazard, precluding impossible values below the 0. This
complication can be dealt with using a logarithmic transformation on the
cumulative hazard function, yielding the unbounded <strong>the log
cumulative hazard function</strong>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">person_crime_lifetable</span> <span class="op">&lt;-</span> <span class="va">person_crime_lifetables</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"person_crime"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    logcumhaz.estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">cumhaz.estimate</span><span class="op">)</span>,</span>
<span>    person_crime <span class="op">=</span> <span class="va">person_crime</span> <span class="op">==</span> <span class="st">"person_crime_1"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>months <span class="op">=</span> <span class="va">time</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Figure 14.2, page 508 (top):</span></span>
<span><span class="va">person_crime_lifetable</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.infinite</a></span><span class="op">(</span><span class="va">logcumhaz.estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">months</span>, y <span class="op">=</span> <span class="va">logcumhaz.estimate</span>, colour <span class="op">=</span> <span class="va">person_crime</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, alpha <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_colour_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">36</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="chapter-14_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>Second, the model must describe the shape of the entire log
cumulative hazard function over time. Similar to discrete time, this
complication can be dealt with by expressing the entire log cumulative
hazard function as the sum of a baseline function and a weighted linear
combination of predictors; however, unlike the discrete-time hazard
model, we do not specify its shape, only that it has <em>some shape</em>
and is a continuous function.</p>
<p>Following the same logic when we developed discrete-time hazard
models in Chapter 11, we can express a Cox regression model for the
<code>rearrest</code> data as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mi>H</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><msub><mi>H</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>β</mi><mn>1</mn></msub><msub><mtext mathvariant="normal">person_crime</mtext><mi>i</mi></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">
\log H(t_{ij}) = \log H_0(t_{j}) + \beta_1 \text{person_crime}_i,
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><msub><mi>H</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\log H_0(t_{j})</annotation></semantics></math>
represents the completely general baseline log cumulative hazard
function.</p>
<p>This model can also be expressed in terms of (raw) cumulative hazard
by antilogging both sides of the equation:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>H</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><msup><mi>e</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>β</mi><mn>1</mn></msub><msub><mtext mathvariant="normal">person_crime</mtext><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>,</mo></mrow><annotation encoding="application/x-tex">
H(t_{ij}) = H_0(t_{j}) e^{(\beta_1 \text{person_crime}_i)},
</annotation></semantics></math></p>
<p>Note that that this transformation converts the vertical distances
between the (log) cumulative hazard functions from a constant
<em>absolute</em> amount,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\beta_1</annotation></semantics></math>,
to a constant <em>relative</em> amount,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>e</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>β</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">e^{(\beta_1)}</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="a-hazard-function-representation-for-the-cox-model">A hazard function representation for the Cox model<a class="anchor" aria-label="anchor" href="#a-hazard-function-representation-for-the-cox-model"></a>
</h3>
<p>Thanks to mathematical identities, the Cox model takes on an
identical form when expressed in terms of hazard directly, substituting
the outcome (and baseline) hazard function,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h(t_{j})</annotation></semantics></math>,
for the outcome (and baseline) cumulative hazard function,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">H(t_{j})</annotation></semantics></math>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><msub><mi>h</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>β</mi><mn>1</mn></msub><msub><mtext mathvariant="normal">person_crime</mtext><mi>i</mi></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">
\log h(t_{ij}) = \log h_0(t_{j}) + \beta_1 \text{person_crime}_i.
</annotation></semantics></math></p>
<p>Antilogging both sides, we can also write this model as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>h</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><msup><mi>e</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>β</mi><mn>1</mn></msub><msub><mtext mathvariant="normal">person_crime</mtext><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></msup><mi>.</mi></mrow><annotation encoding="application/x-tex">
h(t_{ij}) = h_0(t_{j}) e^{(\beta_1 \text{person_crime}_i)}.
</annotation></semantics></math> These representations allow us to
articulate the assumptions of the Cox model using the intuitively
appealing metric of hazard, instead of cumulative hazard. Singer and
Willett (2003) identify three assumptions highlighted in these
representations that are inherent to basic Cox regression models:</p>
<ul>
<li>There is a postulated log hazard function for each value of the
predictor (or for each combination of predictor levels for models with
more than one predictor).</li>
<li>The postulated log hazard functions have an identical shape for all
predictor values. We do not place any constraints on the specification
of that shape, and the function can take on any form necessary to
adequately describe the distribution of event occurrence in the
population.</li>
<li>The postulated log hazard functions have an identical distance
between them at every possible instant.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="fitting-the-cox-regression-model-to-data">14.2 Fitting the Cox regression model to data<a class="anchor" aria-label="anchor" href="#fitting-the-cox-regression-model-to-data"></a>
</h2>
<p>In Section 14.2 Singer and Willett (2003) discuss how the Cox
regression model is fit to data using <strong>partial maximum
likelihood</strong> estimation, which has three practical consequences
for data analysis:</p>
<ul>
<li>
<strong>The shape of the baseline hazard function is
irrelevant</strong>: Partial maximum likelihood estimation invokes a
conditioning argument that eliminates the baseline hazard function
entirely from consideration. The consequence of this is that fitted
models do not provide provide predicted values of hazard, and
nonparametric strategies must be used to “recover” survivor and
cumulative hazard functions.</li>
<li>
<strong>The precise event times are irrelevant</strong>: Only the
rank order of event times matter. The consequence of this is that
neither the exact timing of events nor their metric for clocking time
influence model results, so long as the relative ranking of event times
is preserved.</li>
<li>
<strong>Ties can create analytic difficulties</strong>: Each tied
observation’s contribution to the partial likelihood must be evaluated,
with the required number of additional calculations increasing as a
function of the the number of people tied at any specific event time.
The consequence of this is that ties can be computationally expensive,
and a method for dealing with them must be selected before model
fitting. Singer and Willett (2003) suggest using the <strong>exact
method</strong> whenever computationally feasible, and <strong>Efron’s
approximation</strong> whenever not. For data with many ties,
discrete-time methods are likely more appropriate.</li>
</ul>
<p>For mathematical details of partial maximum likelihood estimation,
consult the textbook.</p>
</div>
<div class="section level2">
<h2 id="interpreting-the-results-of-fitting-the-cox-regression-model-to-data">14.3 Interpreting the results of fitting the Cox regression model to
data<a class="anchor" aria-label="anchor" href="#interpreting-the-results-of-fitting-the-cox-regression-model-to-data"></a>
</h2>
<p>In Section 14.3 Singer and Willett (2003) discuss how to interpret
parameter estimates, evaluate goodness-of-fit, test statistical
hypotheses, and summarize the effects of several predictors
simultaneously using risk scores for the Cox regression model:</p>
<ul>
<li>
<strong>Interpreting parameter estimates</strong>: Each regression
coefficient describes the effect of a one-unit difference in the
associated predictor on either log hazard (raw coefficients) or raw
hazard (antilogged coefficients). Antilogged coefficients are
<strong>hazard ratios</strong> that allow us to make
<em>comparative</em> statements about hazard; because the Cox regression
model does not estimate the baseline hazard function, we cannot make
<em>absolute</em> statements. Similar to odds ratios, hazard ratios can
be expressed as percentages, and the reference group for a hazard ratio
can be swapped by taking its reciprocal.</li>
<li>
<strong>Evaluating goodness-of-fit</strong>: As usual, likelihood
ratio tests can be used to compare the −2LL statistics between null or
nested models, and AIC/BIC statistics between non-nested models (in
addition to using a combination of logic, theory, and prior
research).</li>
<li>
<strong>Testing statistical hypotheses</strong>: Statistical
hypotheses about the effects of predictors can be tested by comparing
−2LL statistics for nested models (recommended) or Wald tests (not
recommended). Asymptotic confidence intervals can be constructed using
asymptotic standard errors associated with Wald tests.</li>
<li>
<strong>Using risk scores</strong>: The simultaneous effects of
several predictors can be summarized using <strong>risk scores</strong>,
which are model-based predictions that compare each individual’s risk of
event occurrence <em>relative</em> to that of a “baseline individual”
who has value 0 for every predictor in the model. Individuals who face
higher relative risk will have scores greater than 1, those who face
lower relative risk will have scores less than 1, and those who face no
higher or lesser relative risk will have scores of approximately 1.</li>
</ul>
<p>Here we will fit four Cox regression models to the
<code>rearrest</code> data using the <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph()</a></code> function from
the <strong>survival</strong> package: A model that includes
<code>person_crime</code> as a predictor (Model A), a model that
includes <code>property_crime</code> as a predictor (Model B), a model
that includes <code>age</code> as a predictor (Model C), and a model
that includes all three of these predictors (Model D).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit models ------------------------------------------------------------------</span></span>
<span><span class="va">rearrest_fit_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">months</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">censor</span><span class="op">)</span> <span class="op">~</span> <span class="va">person_crime</span>, data <span class="op">=</span> <span class="va">rearrest</span></span>
<span><span class="op">)</span></span>
<span><span class="va">rearrest_fit_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">rearrest_fit_A</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">property_crime</span><span class="op">)</span></span>
<span><span class="va">rearrest_fit_C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">rearrest_fit_A</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">age</span><span class="op">)</span></span>
<span><span class="va">rearrest_fit_D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">rearrest_fit_A</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">person_crime</span> <span class="op">+</span> <span class="va">property_crime</span> <span class="op">+</span> <span class="va">age</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rearrest_fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Model A"</span> <span class="op">=</span> <span class="va">rearrest_fit_A</span>,</span>
<span>  <span class="st">"Model B"</span> <span class="op">=</span> <span class="va">rearrest_fit_B</span>,</span>
<span>  <span class="st">"Model C"</span> <span class="op">=</span> <span class="va">rearrest_fit_C</span>,</span>
<span>  <span class="st">"Model D"</span> <span class="op">=</span> <span class="va">rearrest_fit_D</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Test hypotheses -------------------------------------------------------------</span></span>
<span><span class="va">rearrest_fits_htests</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>LR <span class="op">=</span> <span class="st">"LR"</span>, Wald <span class="op">=</span> <span class="st">"Wald"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>    \<span class="op">(</span><span class="va">.test</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">rearrest_fits</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>          \<span class="op">(</span><span class="va">.fit</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">.fit</span> <span class="op">|&gt;</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html" class="external-link">Anova</a></span><span class="op">(</span>type <span class="op">=</span> <span class="fl">2</span>, test.statistic <span class="op">=</span> <span class="va">.test</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>              <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">!=</span> <span class="st">"NULL"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>term <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">term</span>, <span class="st">" = 0"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">statistic</span><span class="op">)</span></span>
<span>          <span class="op">}</span></span>
<span>        <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"model"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">model</span>, values_from <span class="op">=</span> <span class="va">statistic</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make table ------------------------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>modelsummary_get <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Table 14.1, page 525:</span></span>
<span><span class="va">rearrest_fits</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># {modelsummary} doesn't have a built-in way to include raw and exponentiated</span></span>
<span>  <span class="co"># coefficients in a table at the same time, so we will use the</span></span>
<span>  <span class="co"># `modelsummary_list` approach to customize model output. See:</span></span>
<span>  <span class="co"># https://modelsummary.com/vignettes/modelsummary_extension.html</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>    \<span class="op">(</span><span class="va">.fit</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">ms_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        tidy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">.fit</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">.fit</span>, exponentiate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, term <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"exp("</span>, <span class="va">term</span>, <span class="st">")"</span><span class="op">)</span></span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        glance <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/glance.html" class="external-link">glance</a></span><span class="op">(</span><span class="va">.fit</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">ms_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"modelsummary_list"</span></span>
<span>      <span class="va">ms_list</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://modelsummary.com/man/modelsummary.html" class="external-link">modelsummary</a></span><span class="op">(</span></span>
<span>    fmt <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    coef_map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"person_crime"</span>,</span>
<span>      <span class="st">"property_crime"</span>,</span>
<span>      <span class="st">"age"</span>,</span>
<span>      <span class="st">"exp(person_crime)"</span>,</span>
<span>      <span class="st">"exp(property_crime)"</span>,</span>
<span>      <span class="st">"exp(age)"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    gof_map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        raw <span class="op">=</span> <span class="st">"logLik"</span>,</span>
<span>        clean <span class="op">=</span> <span class="st">"-2LL"</span>,</span>
<span>        fmt <span class="op">=</span> \<span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="fu"><a href="https://gt.rstudio.com/reference/vec_fmt_number.html" class="external-link">vec_fmt_number</a></span><span class="op">(</span></span>
<span>          <span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>, decimals <span class="op">=</span> <span class="fl">2</span>, sep_mark <span class="op">=</span> <span class="st">""</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        raw <span class="op">=</span> <span class="st">"statistic.log"</span>,</span>
<span>        clean <span class="op">=</span> <span class="st">"LR statistic"</span>,</span>
<span>        fmt <span class="op">=</span> <span class="fu"><a href="https://modelsummary.com/man/fmt_decimal.html" class="external-link">fmt_decimal</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        raw <span class="op">=</span> <span class="st">"p.value.log"</span>,</span>
<span>        clean <span class="op">=</span> <span class="st">"P"</span>,</span>
<span>        fmt <span class="op">=</span> <span class="fu"><a href="https://modelsummary.com/man/fmt_decimal.html" class="external-link">fmt_decimal</a></span><span class="op">(</span>pdigits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        raw <span class="op">=</span> <span class="st">"AIC"</span>,</span>
<span>        clean <span class="op">=</span> <span class="st">"AIC"</span>,</span>
<span>        fmt <span class="op">=</span> <span class="fu"><a href="https://modelsummary.com/man/fmt_decimal.html" class="external-link">fmt_decimal</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        raw <span class="op">=</span> <span class="st">"BIC"</span>,</span>
<span>        clean <span class="op">=</span> <span class="st">"BIC"</span>,</span>
<span>        fmt <span class="op">=</span> <span class="fu"><a href="https://modelsummary.com/man/fmt_decimal.html" class="external-link">fmt_decimal</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    add_rows <span class="op">=</span> <span class="va">rearrest_fits_htests</span>,</span>
<span>    output <span class="op">=</span> <span class="st">"gt"</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_row_group.html" class="external-link">tab_row_group</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"Wald Hypothesis Tests"</span>, rows <span class="op">=</span> <span class="fl">21</span><span class="op">:</span><span class="fl">23</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_row_group.html" class="external-link">tab_row_group</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"Likelihood-Ratio Hypothesis Tests"</span>, rows <span class="op">=</span> <span class="fl">18</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_row_group.html" class="external-link">tab_row_group</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"Goodness-of-Fit"</span>, rows <span class="op">=</span> <span class="fl">13</span><span class="op">:</span><span class="fl">17</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_row_group.html" class="external-link">tab_row_group</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"Hazard Ratios"</span>, rows <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/tab_row_group.html" class="external-link">tab_row_group</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"Parameter Estimates"</span>, rows <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<div id="mwlefoodfi" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#mwlefoodfi table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#mwlefoodfi thead, #mwlefoodfi tbody, #mwlefoodfi tfoot, #mwlefoodfi tr, #mwlefoodfi td, #mwlefoodfi th {
  border-style: none;
}

#mwlefoodfi p {
  margin: 0;
  padding: 0;
}

#mwlefoodfi .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mwlefoodfi .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#mwlefoodfi .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mwlefoodfi .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mwlefoodfi .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mwlefoodfi .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mwlefoodfi .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mwlefoodfi .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mwlefoodfi .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mwlefoodfi .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mwlefoodfi .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mwlefoodfi .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mwlefoodfi .gt_spanner_row {
  border-bottom-style: hidden;
}

#mwlefoodfi .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#mwlefoodfi .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mwlefoodfi .gt_from_md > :first-child {
  margin-top: 0;
}

#mwlefoodfi .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mwlefoodfi .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mwlefoodfi .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#mwlefoodfi .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#mwlefoodfi .gt_row_group_first td {
  border-top-width: 2px;
}

#mwlefoodfi .gt_row_group_first th {
  border-top-width: 2px;
}

#mwlefoodfi .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwlefoodfi .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#mwlefoodfi .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#mwlefoodfi .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mwlefoodfi .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwlefoodfi .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mwlefoodfi .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#mwlefoodfi .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mwlefoodfi .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mwlefoodfi .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mwlefoodfi .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwlefoodfi .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mwlefoodfi .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwlefoodfi .gt_left {
  text-align: left;
}

#mwlefoodfi .gt_center {
  text-align: center;
}

#mwlefoodfi .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mwlefoodfi .gt_font_normal {
  font-weight: normal;
}

#mwlefoodfi .gt_font_bold {
  font-weight: bold;
}

#mwlefoodfi .gt_font_italic {
  font-style: italic;
}

#mwlefoodfi .gt_super {
  font-size: 65%;
}

#mwlefoodfi .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#mwlefoodfi .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#mwlefoodfi .gt_indent_1 {
  text-indent: 5px;
}

#mwlefoodfi .gt_indent_2 {
  text-indent: 10px;
}

#mwlefoodfi .gt_indent_3 {
  text-indent: 15px;
}

#mwlefoodfi .gt_indent_4 {
  text-indent: 20px;
}

#mwlefoodfi .gt_indent_5 {
  text-indent: 25px;
}

#mwlefoodfi .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#mwlefoodfi div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="table gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=" "> </th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Model A">Model A</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Model B">Model B</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Model C">Model C</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Model D">Model D</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row">
<th colspan="5" class="gt_group_heading" scope="colgroup" id="Parameter Estimates">Parameter Estimates</th>
    </tr>
<tr class="gt_row_group_first">
<td headers="Parameter Estimates   " class="gt_row gt_left">person_crime</td>
<td headers="Parameter Estimates  Model A" class="gt_row gt_center">0.4787</td>
<td headers="Parameter Estimates  Model B" class="gt_row gt_center"></td>
<td headers="Parameter Estimates  Model C" class="gt_row gt_center"></td>
<td headers="Parameter Estimates  Model D" class="gt_row gt_center">0.5691</td>
</tr>
<tr>
<td headers="Parameter Estimates   " class="gt_row gt_left"></td>
<td headers="Parameter Estimates  Model A" class="gt_row gt_center">(0.2025)</td>
<td headers="Parameter Estimates  Model B" class="gt_row gt_center"></td>
<td headers="Parameter Estimates  Model C" class="gt_row gt_center"></td>
<td headers="Parameter Estimates  Model D" class="gt_row gt_center">(0.2052)</td>
</tr>
<tr>
<td headers="Parameter Estimates   " class="gt_row gt_left">property_crime</td>
<td headers="Parameter Estimates  Model A" class="gt_row gt_center"></td>
<td headers="Parameter Estimates  Model B" class="gt_row gt_center">1.1946</td>
<td headers="Parameter Estimates  Model C" class="gt_row gt_center"></td>
<td headers="Parameter Estimates  Model D" class="gt_row gt_center">0.9358</td>
</tr>
<tr>
<td headers="Parameter Estimates   " class="gt_row gt_left"></td>
<td headers="Parameter Estimates  Model A" class="gt_row gt_center"></td>
<td headers="Parameter Estimates  Model B" class="gt_row gt_center">(0.3493)</td>
<td headers="Parameter Estimates  Model C" class="gt_row gt_center"></td>
<td headers="Parameter Estimates  Model D" class="gt_row gt_center">(0.3509)</td>
</tr>
<tr>
<td headers="Parameter Estimates   " class="gt_row gt_left">age</td>
<td headers="Parameter Estimates  Model A" class="gt_row gt_center"></td>
<td headers="Parameter Estimates  Model B" class="gt_row gt_center"></td>
<td headers="Parameter Estimates  Model C" class="gt_row gt_center">-0.0681</td>
<td headers="Parameter Estimates  Model D" class="gt_row gt_center">-0.0667</td>
</tr>
<tr>
<td headers="Parameter Estimates   " class="gt_row gt_left"></td>
<td headers="Parameter Estimates  Model A" class="gt_row gt_center"></td>
<td headers="Parameter Estimates  Model B" class="gt_row gt_center"></td>
<td headers="Parameter Estimates  Model C" class="gt_row gt_center">(0.0156)</td>
<td headers="Parameter Estimates  Model D" class="gt_row gt_center">(0.0168)</td>
</tr>
<tr class="gt_group_heading_row">
<th colspan="5" class="gt_group_heading" scope="colgroup" id="Hazard Ratios">Hazard Ratios</th>
    </tr>
<tr class="gt_row_group_first">
<td headers="Hazard Ratios   " class="gt_row gt_left">exp(person_crime)</td>
<td headers="Hazard Ratios  Model A" class="gt_row gt_center">1.6140</td>
<td headers="Hazard Ratios  Model B" class="gt_row gt_center"></td>
<td headers="Hazard Ratios  Model C" class="gt_row gt_center"></td>
<td headers="Hazard Ratios  Model D" class="gt_row gt_center">1.7667</td>
</tr>
<tr>
<td headers="Hazard Ratios   " class="gt_row gt_left"></td>
<td headers="Hazard Ratios  Model A" class="gt_row gt_center">(0.2025)</td>
<td headers="Hazard Ratios  Model B" class="gt_row gt_center"></td>
<td headers="Hazard Ratios  Model C" class="gt_row gt_center"></td>
<td headers="Hazard Ratios  Model D" class="gt_row gt_center">(0.2052)</td>
</tr>
<tr>
<td headers="Hazard Ratios   " class="gt_row gt_left">exp(property_crime)</td>
<td headers="Hazard Ratios  Model A" class="gt_row gt_center"></td>
<td headers="Hazard Ratios  Model B" class="gt_row gt_center">3.3022</td>
<td headers="Hazard Ratios  Model C" class="gt_row gt_center"></td>
<td headers="Hazard Ratios  Model D" class="gt_row gt_center">2.5492</td>
</tr>
<tr>
<td headers="Hazard Ratios   " class="gt_row gt_left"></td>
<td headers="Hazard Ratios  Model A" class="gt_row gt_center"></td>
<td headers="Hazard Ratios  Model B" class="gt_row gt_center">(0.3493)</td>
<td headers="Hazard Ratios  Model C" class="gt_row gt_center"></td>
<td headers="Hazard Ratios  Model D" class="gt_row gt_center">(0.3509)</td>
</tr>
<tr>
<td headers="Hazard Ratios   " class="gt_row gt_left">exp(age)</td>
<td headers="Hazard Ratios  Model A" class="gt_row gt_center"></td>
<td headers="Hazard Ratios  Model B" class="gt_row gt_center"></td>
<td headers="Hazard Ratios  Model C" class="gt_row gt_center">0.9341</td>
<td headers="Hazard Ratios  Model D" class="gt_row gt_center">0.9355</td>
</tr>
<tr>
<td headers="Hazard Ratios   " class="gt_row gt_left" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="Hazard Ratios  Model A" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="Hazard Ratios  Model B" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;"></td>
<td headers="Hazard Ratios  Model C" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;">(0.0156)</td>
<td headers="Hazard Ratios  Model D" class="gt_row gt_center" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000;">(0.0168)</td>
</tr>
<tr class="gt_group_heading_row">
<th colspan="5" class="gt_group_heading" scope="colgroup" id="Goodness-of-Fit">Goodness-of-Fit</th>
    </tr>
<tr class="gt_row_group_first">
<td headers="Goodness-of-Fit   " class="gt_row gt_left">-2LL</td>
<td headers="Goodness-of-Fit  Model A" class="gt_row gt_center">984.08</td>
<td headers="Goodness-of-Fit  Model B" class="gt_row gt_center">973.20</td>
<td headers="Goodness-of-Fit  Model C" class="gt_row gt_center">966.43</td>
<td headers="Goodness-of-Fit  Model D" class="gt_row gt_center">950.44</td>
</tr>
<tr>
<td headers="Goodness-of-Fit   " class="gt_row gt_left">LR statistic</td>
<td headers="Goodness-of-Fit  Model A" class="gt_row gt_center">5.32</td>
<td headers="Goodness-of-Fit  Model B" class="gt_row gt_center">16.20</td>
<td headers="Goodness-of-Fit  Model C" class="gt_row gt_center">22.97</td>
<td headers="Goodness-of-Fit  Model D" class="gt_row gt_center">38.96</td>
</tr>
<tr>
<td headers="Goodness-of-Fit   " class="gt_row gt_left">P</td>
<td headers="Goodness-of-Fit  Model A" class="gt_row gt_center">0.021</td>
<td headers="Goodness-of-Fit  Model B" class="gt_row gt_center">0.000</td>
<td headers="Goodness-of-Fit  Model C" class="gt_row gt_center">0.000</td>
<td headers="Goodness-of-Fit  Model D" class="gt_row gt_center">0.000</td>
</tr>
<tr>
<td headers="Goodness-of-Fit   " class="gt_row gt_left">AIC</td>
<td headers="Goodness-of-Fit  Model A" class="gt_row gt_center">986.08</td>
<td headers="Goodness-of-Fit  Model B" class="gt_row gt_center">975.20</td>
<td headers="Goodness-of-Fit  Model C" class="gt_row gt_center">968.43</td>
<td headers="Goodness-of-Fit  Model D" class="gt_row gt_center">956.44</td>
</tr>
<tr>
<td headers="Goodness-of-Fit   " class="gt_row gt_left">BIC</td>
<td headers="Goodness-of-Fit  Model A" class="gt_row gt_center">988.74</td>
<td headers="Goodness-of-Fit  Model B" class="gt_row gt_center">977.86</td>
<td headers="Goodness-of-Fit  Model C" class="gt_row gt_center">971.10</td>
<td headers="Goodness-of-Fit  Model D" class="gt_row gt_center">964.43</td>
</tr>
<tr class="gt_group_heading_row">
<th colspan="5" class="gt_group_heading" scope="colgroup" id="Likelihood-Ratio Hypothesis Tests">Likelihood-Ratio Hypothesis Tests</th>
    </tr>
<tr class="gt_row_group_first">
<td headers="Likelihood-Ratio Hypothesis Tests   " class="gt_row gt_left">person_crime = 0</td>
<td headers="Likelihood-Ratio Hypothesis Tests  Model A" class="gt_row gt_center">5.3237</td>
<td headers="Likelihood-Ratio Hypothesis Tests  Model B" class="gt_row gt_center"></td>
<td headers="Likelihood-Ratio Hypothesis Tests  Model C" class="gt_row gt_center"></td>
<td headers="Likelihood-Ratio Hypothesis Tests  Model D" class="gt_row gt_center">7.2760</td>
</tr>
<tr>
<td headers="Likelihood-Ratio Hypothesis Tests   " class="gt_row gt_left">property_crime = 0</td>
<td headers="Likelihood-Ratio Hypothesis Tests  Model A" class="gt_row gt_center"></td>
<td headers="Likelihood-Ratio Hypothesis Tests  Model B" class="gt_row gt_center">16.2050</td>
<td headers="Likelihood-Ratio Hypothesis Tests  Model C" class="gt_row gt_center"></td>
<td headers="Likelihood-Ratio Hypothesis Tests  Model D" class="gt_row gt_center">9.1493</td>
</tr>
<tr>
<td headers="Likelihood-Ratio Hypothesis Tests   " class="gt_row gt_left">age = 0</td>
<td headers="Likelihood-Ratio Hypothesis Tests  Model A" class="gt_row gt_center"></td>
<td headers="Likelihood-Ratio Hypothesis Tests  Model B" class="gt_row gt_center"></td>
<td headers="Likelihood-Ratio Hypothesis Tests  Model C" class="gt_row gt_center">22.9688</td>
<td headers="Likelihood-Ratio Hypothesis Tests  Model D" class="gt_row gt_center">18.3234</td>
</tr>
<tr class="gt_group_heading_row">
<th colspan="5" class="gt_group_heading" scope="colgroup" id="Wald Hypothesis Tests">Wald Hypothesis Tests</th>
    </tr>
<tr class="gt_row_group_first">
<td headers="Wald Hypothesis Tests   " class="gt_row gt_left">person_crime = 0</td>
<td headers="Wald Hypothesis Tests  Model A" class="gt_row gt_center">5.5894</td>
<td headers="Wald Hypothesis Tests  Model B" class="gt_row gt_center"></td>
<td headers="Wald Hypothesis Tests  Model C" class="gt_row gt_center"></td>
<td headers="Wald Hypothesis Tests  Model D" class="gt_row gt_center">7.6920</td>
</tr>
<tr>
<td headers="Wald Hypothesis Tests   " class="gt_row gt_left">property_crime = 0</td>
<td headers="Wald Hypothesis Tests  Model A" class="gt_row gt_center"></td>
<td headers="Wald Hypothesis Tests  Model B" class="gt_row gt_center">11.6970</td>
<td headers="Wald Hypothesis Tests  Model C" class="gt_row gt_center"></td>
<td headers="Wald Hypothesis Tests  Model D" class="gt_row gt_center">7.1129</td>
</tr>
<tr>
<td headers="Wald Hypothesis Tests   " class="gt_row gt_left">age = 0</td>
<td headers="Wald Hypothesis Tests  Model A" class="gt_row gt_center"></td>
<td headers="Wald Hypothesis Tests  Model B" class="gt_row gt_center"></td>
<td headers="Wald Hypothesis Tests  Model C" class="gt_row gt_center">19.0014</td>
<td headers="Wald Hypothesis Tests  Model D" class="gt_row gt_center">15.8094</td>
</tr>
</tbody>
</table>
</div>
<p>The <code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code> function from the <strong>broom</strong>
package can be used to get the predicted risk scores for each individual
from the fitted Cox regression model by setting the
<code>type.predict</code> argument to <code>"risk"</code>. Following
Singer and Willett (2003), here we display predictions for a subset of
individuals with risk scores of varying size.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter by ID order to match the textbook table.</span></span>
<span><span class="va">rearrest_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22</span>, <span class="fl">8</span>, <span class="fl">187</span>, <span class="fl">26</span>, <span class="fl">5</span>, <span class="fl">130</span>, <span class="fl">106</span>, <span class="fl">33</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">.id</span><span class="op">)</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rearrest</span>, <span class="va">id</span> <span class="op">==</span> <span class="va">.id</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Table 14.2, page 533:</span></span>
<span><span class="va">rearrest_fit_D</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">rearrest_subset</span>, type.predict <span class="op">=</span> <span class="st">"risk"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>risk_score <span class="op">=</span> <span class="va">.fitted</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">.se.fit</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">days</span><span class="op">:</span><span class="va">censor</span>, .after <span class="op">=</span> <span class="va">risk_score</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/gt.html" class="external-link">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html" class="external-link">fmt_number</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="va">age</span>, decimals <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html" class="external-link">fmt_number</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="va">risk_score</span>, decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://gt.rstudio.com/reference/fmt_number.html" class="external-link">fmt_number</a></span><span class="op">(</span>columns <span class="op">=</span> <span class="va">months</span>, decimals <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div id="eexombwkke" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#eexombwkke table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#eexombwkke thead, #eexombwkke tbody, #eexombwkke tfoot, #eexombwkke tr, #eexombwkke td, #eexombwkke th {
  border-style: none;
}

#eexombwkke p {
  margin: 0;
  padding: 0;
}

#eexombwkke .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#eexombwkke .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#eexombwkke .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#eexombwkke .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#eexombwkke .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#eexombwkke .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#eexombwkke .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#eexombwkke .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#eexombwkke .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#eexombwkke .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#eexombwkke .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#eexombwkke .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#eexombwkke .gt_spanner_row {
  border-bottom-style: hidden;
}

#eexombwkke .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#eexombwkke .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#eexombwkke .gt_from_md > :first-child {
  margin-top: 0;
}

#eexombwkke .gt_from_md > :last-child {
  margin-bottom: 0;
}

#eexombwkke .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#eexombwkke .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#eexombwkke .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#eexombwkke .gt_row_group_first td {
  border-top-width: 2px;
}

#eexombwkke .gt_row_group_first th {
  border-top-width: 2px;
}

#eexombwkke .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#eexombwkke .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#eexombwkke .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#eexombwkke .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#eexombwkke .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#eexombwkke .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#eexombwkke .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#eexombwkke .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#eexombwkke .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#eexombwkke .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#eexombwkke .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#eexombwkke .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#eexombwkke .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#eexombwkke .gt_left {
  text-align: left;
}

#eexombwkke .gt_center {
  text-align: center;
}

#eexombwkke .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#eexombwkke .gt_font_normal {
  font-weight: normal;
}

#eexombwkke .gt_font_bold {
  font-weight: bold;
}

#eexombwkke .gt_font_italic {
  font-style: italic;
}

#eexombwkke .gt_super {
  font-size: 65%;
}

#eexombwkke .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#eexombwkke .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#eexombwkke .gt_indent_1 {
  text-indent: 5px;
}

#eexombwkke .gt_indent_2 {
  text-indent: 10px;
}

#eexombwkke .gt_indent_3 {
  text-indent: 15px;
}

#eexombwkke .gt_indent_4 {
  text-indent: 20px;
}

#eexombwkke .gt_indent_5 {
  text-indent: 25px;
}

#eexombwkke .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#eexombwkke div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="table gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="id">id</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="person_crime">person_crime</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="property_crime">property_crime</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="age">age</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="risk_score">risk_score</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="days">days</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="months">months</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="censor">censor</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td headers="id" class="gt_row gt_center">22</td>
<td headers="person_crime" class="gt_row gt_right">0</td>
<td headers="property_crime" class="gt_row gt_right">0</td>
<td headers="age" class="gt_row gt_right">0.258</td>
<td headers="risk_score" class="gt_row gt_right">0.98</td>
<td headers="days" class="gt_row gt_right">52</td>
<td headers="months" class="gt_row gt_right">1.7084</td>
<td headers="censor" class="gt_row gt_right">1</td>
</tr>
<tr>
<td headers="id" class="gt_row gt_center">8</td>
<td headers="person_crime" class="gt_row gt_right">1</td>
<td headers="property_crime" class="gt_row gt_right">1</td>
<td headers="age" class="gt_row gt_right">22.451</td>
<td headers="risk_score" class="gt_row gt_right">1.01</td>
<td headers="days" class="gt_row gt_right">19</td>
<td headers="months" class="gt_row gt_right">0.6242</td>
<td headers="censor" class="gt_row gt_right">1</td>
</tr>
<tr>
<td headers="id" class="gt_row gt_center">187</td>
<td headers="person_crime" class="gt_row gt_right">1</td>
<td headers="property_crime" class="gt_row gt_right">0</td>
<td headers="age" class="gt_row gt_right">−7.200</td>
<td headers="risk_score" class="gt_row gt_right">2.86</td>
<td headers="days" class="gt_row gt_right">1095</td>
<td headers="months" class="gt_row gt_right">36.0000</td>
<td headers="censor" class="gt_row gt_right">1</td>
</tr>
<tr>
<td headers="id" class="gt_row gt_center">26</td>
<td headers="person_crime" class="gt_row gt_right">0</td>
<td headers="property_crime" class="gt_row gt_right">1</td>
<td headers="age" class="gt_row gt_right">−7.301</td>
<td headers="risk_score" class="gt_row gt_right">4.15</td>
<td headers="days" class="gt_row gt_right">72</td>
<td headers="months" class="gt_row gt_right">2.3655</td>
<td headers="censor" class="gt_row gt_right">0</td>
</tr>
<tr>
<td headers="id" class="gt_row gt_center">5</td>
<td headers="person_crime" class="gt_row gt_right">1</td>
<td headers="property_crime" class="gt_row gt_right">1</td>
<td headers="age" class="gt_row gt_right">−7.165</td>
<td headers="risk_score" class="gt_row gt_right">7.26</td>
<td headers="days" class="gt_row gt_right">9</td>
<td headers="months" class="gt_row gt_right">0.2957</td>
<td headers="censor" class="gt_row gt_right">0</td>
</tr>
<tr>
<td headers="id" class="gt_row gt_center">130</td>
<td headers="person_crime" class="gt_row gt_right">0</td>
<td headers="property_crime" class="gt_row gt_right">1</td>
<td headers="age" class="gt_row gt_right">22.391</td>
<td headers="risk_score" class="gt_row gt_right">0.57</td>
<td headers="days" class="gt_row gt_right">486</td>
<td headers="months" class="gt_row gt_right">15.9671</td>
<td headers="censor" class="gt_row gt_right">1</td>
</tr>
<tr>
<td headers="id" class="gt_row gt_center">106</td>
<td headers="person_crime" class="gt_row gt_right">0</td>
<td headers="property_crime" class="gt_row gt_right">0</td>
<td headers="age" class="gt_row gt_right">16.203</td>
<td headers="risk_score" class="gt_row gt_right">0.34</td>
<td headers="days" class="gt_row gt_right">356</td>
<td headers="months" class="gt_row gt_right">11.6961</td>
<td headers="censor" class="gt_row gt_right">0</td>
</tr>
<tr>
<td headers="id" class="gt_row gt_center">33</td>
<td headers="person_crime" class="gt_row gt_right">1</td>
<td headers="property_crime" class="gt_row gt_right">0</td>
<td headers="age" class="gt_row gt_right">27.061</td>
<td headers="risk_score" class="gt_row gt_right">0.29</td>
<td headers="days" class="gt_row gt_right">85</td>
<td headers="months" class="gt_row gt_right">2.7926</td>
<td headers="censor" class="gt_row gt_right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="nonparametric-strategies-for-displaying-the-results-of-model-fitting">14.4 Nonparametric strategies for displaying the results of model
fitting<a class="anchor" aria-label="anchor" href="#nonparametric-strategies-for-displaying-the-results-of-model-fitting"></a>
</h2>
<p>In Section 14.4 Singer and Willett (2003) discuss nonparametric
methods for <em>recovering</em> the baseline cumulative hazard function
from a fitted Cox regression model, allowing for the plotting of
survival and cumulative hazard functions for both “baseline” and
prototypical individuals.</p>
<p>The baseline cumulative hazard function can be recovered from a
fitted Cox regression model using the <code><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit()</a></code> function
from the <strong>survival</strong> package. Here we will plot recovered
baseline survival and cumulative hazard functions from two Cox
regression models: a model whose “baseline” individual is a former
inmate of average age upon release who had no history of either property
or personal crime (Model D), and a model whose “baseline” individual is
a former inmate of average age upon release who had an “average” history
of both property and personal crime (Model E).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit model -------------------------------------------------------------------</span></span>
<span><span class="va">rearrest_fit_E</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span></span>
<span>  <span class="va">rearrest_fit_A</span>,</span>
<span>  <span class="va">.</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">person_crime</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">property_crime</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="op">+</span> <span class="va">age</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">rearrest_fits_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Model D"</span> <span class="op">=</span> <span class="va">rearrest_fit_D</span>,</span>
<span>  <span class="st">"Model E"</span> <span class="op">=</span> <span class="va">rearrest_fit_E</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make plots ------------------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># Figure 14.4, page 538:</span></span>
<span><span class="va">rearrest_fits_2</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>    \<span class="op">(</span><span class="va">.fit</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">rearrest_survfit</span> <span class="op">&lt;-</span> <span class="va">.fit</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit0.html" class="external-link">survfit0</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="co"># Filter out censored tail rows for display purposes.</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="va">estimate</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">n.event</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span></span>
<span>        <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cumhaz.estimate <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>surv.estimate <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">rearrest_surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">rearrest_survfit</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">surv.estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">36</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">36</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">rearrest_cumhaz</span> <span class="op">&lt;-</span> <span class="va">rearrest_surv</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">cumhaz.estimate</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">36</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">rearrest_surv</span> <span class="op">/</span> <span class="va">rearrest_cumhaz</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>axes <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="chapter-14_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Finally, fitted survival and cumulative hazard functions at selected
predictor values can be obtained using the <code>newdata</code> argument
of the <code><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit()</a></code> function. Here we will plot fitted
functions for all possible combinations of <code>person_crime</code> and
<code>property_crime</code>, with <code>age</code> set to its sample
mean.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit functions ---------------------------------------------------------------</span></span>
<span><span class="va">rearrest_ptypes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  neither       <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>person_crime <span class="op">=</span> <span class="fl">0</span>, property_crime <span class="op">=</span> <span class="fl">0</span>, age <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>  personal_only <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>person_crime <span class="op">=</span> <span class="fl">1</span>, property_crime <span class="op">=</span> <span class="fl">0</span>, age <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>  property_only <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>person_crime <span class="op">=</span> <span class="fl">0</span>, property_crime <span class="op">=</span> <span class="fl">1</span>, age <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>  both          <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>person_crime <span class="op">=</span> <span class="fl">1</span>, property_crime <span class="op">=</span> <span class="fl">1</span>, age <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">rearrest_ptype_funs</span> <span class="op">&lt;-</span> <span class="va">rearrest_ptypes</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>    \<span class="op">(</span><span class="va">.newdata</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">rearrest_fit_D</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html" class="external-link">survfit</a></span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">.newdata</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit0.html" class="external-link">survfit0</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="co"># Filter out censored tail rows for display purposes.</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="va">estimate</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">n.event</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span></span>
<span>        <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>          cumhaz.estimate <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span>,</span>
<span>          logcumhaz.estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">cumhaz.estimate</span><span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>surv.estimate <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"crime"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make plots ------------------------------------------------------------------</span></span>
<span><span class="va">rearrest_ptype_surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">rearrest_ptype_funs</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">surv.estimate</span>, colour <span class="op">=</span> <span class="va">crime</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">36</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">36</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rearrest_ptype_cumhaz</span> <span class="op">&lt;-</span> <span class="va">rearrest_ptype_surv</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">cumhaz.estimate</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">36</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rearrest_ptype_logcumhaz</span> <span class="op">&lt;-</span> <span class="va">rearrest_ptype_surv</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">logcumhaz.estimate</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="op">-</span><span class="fl">7</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">36</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">7</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Figure 14.5, page 541:</span></span>
<span><span class="va">rearrest_ptype_surv</span> <span class="op">/</span> <span class="va">rearrest_ptype_cumhaz</span> <span class="op">/</span> <span class="va">rearrest_ptype_logcumhaz</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span>, axes <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span></span></code></pre></div>
<p><img src="chapter-14_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael McCarthy.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
